"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8174],{987531:(e,t,n)=>{var a;n.d(t,{Z:()=>i}),e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const o=function(e,t){let n,a;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=a=t):(n>t&&(n=t),a<t&&(a=t)));else{let o=-1;for(let i of e)null!=(i=t(i,++o,e))&&(void 0===n?i>=i&&(n=a=i):(n>i&&(n=i),a<i&&(a=i)))}return[n,a]},i=o;var r,s;(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&r.register(o,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/extent.js"),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)},649985:(e,t,n)=>{var a;n.d(t,{Z:()=>i}),e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const o=function(e,t,n){e=+e,t=+t,n=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+n;for(var a=-1,o=0|Math.max(0,Math.ceil((t-e)/n)),i=new Array(o);++a<o;)i[a]=e+a*n;return i},i=o;var r,s;(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&r.register(o,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/range.js"),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)},569441:(e,t,n)=>{n.d(t,{Z:()=>g});var a,o=n(45697),i=n.n(o),r=n(987531),s=n(649985),l=n(694017),u=n(45511),c=n(351058);e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const d={data:i().shape({data:i().object,domain:i().string,range:i().number,start:i().number,subdomain:i().string}),height:i().number,cellPadding:i().number,cellRadius:i().number,cellSize:i().number,linearColorScheme:i().string,showLegend:i().bool,showMetricName:i().bool,showValues:i().bool,steps:i().number,timeFormatter:i().func,valueFormatter:i().func,verboseMap:i().object};function m(e,t){const{data:n,height:a,cellPadding:o=3,cellRadius:i=0,cellSize:d=10,domainGranularity:m,linearColorScheme:h,showLegend:g,showMetricName:p,showValues:f,steps:D,subdomainGranularity:y,timeFormatter:b,valueFormatter:w,verboseMap:v}=t,M=(0,l.Z)(e).classed("superset-legacy-chart-calendar",!0).style("height",a);M.selectAll("*").remove();const _=M.append("div"),L=f?(e,t)=>w(t):null,x=n.data;Object.keys(x).forEach((e=>{const t=_.append("div");p&&t.text(`Metric: ${v[e]||e}`);const a=x[e],l=(0,r.Z)(Object.keys(a),(e=>a[e])),f=(l[1]-l[0])/(D-1),M=(0,u.Z)().get(h).createLinearScale(l),P=(0,s.Z)(D).map((e=>l[0]+f*e)),T=P.map((e=>M(e)));(new c.Z).init({start:n.start,data:a,itemSelector:t.node(),legendVerticalPosition:"top",cellSize:d,cellPadding:o,cellRadius:i,legendCellSize:d,legendCellPadding:2,legendCellRadius:i,tooltip:!0,domain:m,subDomain:y,range:n.range,browsing:!0,legend:P,legendColors:{colorScale:M,min:T[0],max:T[T.length-1],empty:"white"},displayLegend:g,itemName:"",valueFormatter:w,timeFormatter:b,subDomainTextFormat:L})}))}m.displayName="Calendar",m.propTypes=d;const h=m,g=h;var p,f;(p="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(p.register(d,"propTypes","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js"),p.register(m,"Calendar","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js"),p.register(h,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js")),(f="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&f(e)},388174:(e,t,n)=>{n.r(t),n.d(t,{default:()=>h}),n(667294);var a,o=n(45697),i=n.n(o),r=n(943323),s=n(751995),l=n(569441),u=n(211965);e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const c=(0,r.Z)(l.Z),d=({className:e,...t})=>(0,u.tZ)("div",{className:e},(0,u.tZ)(c,t));d.defaultProps={otherProps:{}},d.propTypes={className:i().string.isRequired,otherProps:i().objectOf(i().any)};const m=(0,s.iK)(d)`
  .superset-legacy-chart-calendar {
    padding: 10px;
    position: static !important;
    overflow: auto !important;
  }

  .superset-legacy-chart-calendar .ch-tooltip {
    margin-left: 20px;
    margin-top: 5px;
  }
`,h=m;var g,p;(g="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(g.register(c,"ReactComponent","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx"),g.register(d,"Calender","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx"),g.register(m,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx")),(p="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&p(e)},351058:(e,t,n)=>{n.d(t,{Z:()=>h}),n(115306);var a,o=n(132383),i=n(25130);e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;var r=n(615078),s=(r=n(615078),function(){var e=this;for(var t in e.tip=(0,o.Z)().attr("class","d3-tip").direction("n").offset([-5,0]).html((t=>`\n      ${e.options.timeFormatter(t.t)}: <strong>${e.options.valueFormatter(t.v)}</strong>\n    `)),e.legendTip=(0,o.Z)().attr("class","d3-tip").direction("n").offset([-5,0]).html((t=>e.options.valueFormatter(t))),this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],valueFormatter:e=>e,timeFormatter:e=>e,domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,dataRequestHeaders:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData:function(e){return e},afterUpdate:null,onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){return Math.floor(t.getMinutes()/e._domainType.min.row(t))},y:function(t){return t.getMinutes()%e._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(t){switch(e.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(e.options.domainDynamicDimension?e.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber:function(t){switch(e.options.domain){case"day":return 4;case"week":return 28;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31}},row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){return"month"===e.options.domain?e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getHours()+24*(t.getDate()-1))/e._domainType.hour.row(t)):Math.floor(t.getHours()/e._domainType.hour.row(t))+4*(t.getDate()-1):"week"===e.options.domain?e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getHours()+24*e.getWeekDay(t))/e._domainType.hour.row(t)):Math.floor(t.getHours()/e._domainType.hour.row(t))+4*e.getWeekDay(t):Math.floor(t.getHours()/e._domainType.hour.row(t))},y:function(t){var n=t.getHours();if(e.options.colLimit>0||e.options.rowLimit>0)switch(e.options.domain){case"month":n+=24*(t.getDate()-1);break;case"week":n+=24*e.getWeekDay(t)}return Math.floor(n%e._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function(t){switch(e.options.domain){case"week":return 7;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31;case"year":return e.options.domainDynamicDimension?e.getDayCountInYear(t):366}},defaultColumnNumber:function(t){switch(t=new Date(t),e.options.domain){case"week":return 1;case"month":return e.options.domainDynamicDimension&&!e.options.verticalOrientation?e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t)+1:6;case"year":return e.options.domainDynamicDimension?e.getWeekNumber(new Date(t.getFullYear(),11,31))-e.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"week":return Math.floor(e.getWeekDay(t)/e._domainType.day.row(t));case"month":return e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getDate()-1)/e._domainType.day.row(t)):e.getWeekNumber(t)-e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":return e.options.colLimit>0||e.options.rowLimit>0?Math.floor((e.getDayOfYear(t)-1)/e._domainType.day.row(t)):e.getWeekNumber(t)}},y:function(t){var n=e.getWeekDay(t);if(e.options.colLimit>0||e.options.rowLimit>0)switch(e.options.domain){case"year":n=e.getDayOfYear(t)-1;break;case"week":n=e.getWeekDay(t);break;case"month":n=t.getDate()-1}return Math.floor(n%e._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(t){switch(t=new Date(t),e.options.domain){case"year":return e._domainType.week.maxItemNumber;case"month":return e.options.domainDynamicDimension?e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t):5}},defaultRowNumber:1,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"year":return Math.floor(e.getWeekNumber(t)/e._domainType.week.row(t));case"month":return Math.floor(e.getMonthWeekNumber(t)/e._domainType.week.row(t))}},y:function(t){return e.getWeekNumber(t)%e._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=n.getDay()-(e.options.weekStartOnMonday?1:0);return a<0&&(a=6),n.setDate(n.getDate()-a),n.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return e.getSubDomainRowNumber()},column:function(){return e.getSubDomainColumnNumber()},position:{x:function(t){return Math.floor(t.getMonth()/e._domainType.month.row(t))},y:function(t){return t.getMonth()%e._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(e){return new Date(e.getFullYear(),e.getMonth()).getTime()}},year:{name:"year",level:60,row:function(){return e.options.rowLimit||1},column:function(){return e.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(e){return new Date(e.getFullYear()).getTime()}}},this._domainType)if(this._domainType.hasOwnProperty(t)){var n=this._domainType[t];this._domainType["x_"+t]={name:"x_"+t,level:n.type,maxItemNumber:n.maxItemNumber,defaultRowNumber:n.defaultRowNumber,defaultColumnNumber:n.defaultColumnNumber,row:n.column,column:n.row,position:{x:n.position.y,y:n.position.x},format:n.format,extractUnit:n.extractUnit}}function a(t,n){var a=e.options.cellSize*e._domainType[e.options.subDomain].column(t)+e.options.cellPadding*e._domainType[e.options.subDomain].column(t);return 2===arguments.length&&!0===n?a+(e.domainHorizontalLabelWidth+e.options.domainGutter+e.options.domainMargin[1]+e.options.domainMargin[3]):a}function i(t,n){var a=e.options.cellSize*e._domainType[e.options.subDomain].row(t)+e.options.cellPadding*e._domainType[e.options.subDomain].row(t);return 2===arguments.length&&!0===n&&(a+=e.options.domainGutter+e.domainVerticalLabelHeight+e.options.domainMargin[0]+e.options.domainMargin[2]),a}this.lastInsertedSvg=null,this._completed=!1,this._domains=r.map(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new l,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return e.getDomain(e.options.start).map((function(e){return e.getTime()})).map((function(t){e._domains.set(t,e.getSubDomain(t).map((function(t){return{t:e._domainType[e.options.subDomain].extractUnit(t),v:null}})))})),e.root=r.select(e.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),e.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),e.Legend=new u(e),e.options.paintOnLoad&&function(){e.verticalDomainLabel="top"===e.options.label.position||"bottom"===e.options.label.position,e.domainVerticalLabelHeight=null===e.options.label.height?Math.max(25,2*e.options.cellSize):e.options.label.height,e.domainHorizontalLabelWidth=0,""===e.options.domainLabelFormat&&null===e.options.label.height&&(e.domainVerticalLabelHeight=0),e.verticalDomainLabel||(e.domainVerticalLabelHeight=0,e.domainHorizontalLabelWidth=e.options.label.width),e.paint(),!1!==e.options.nextSelector&&r.select(e.options.nextSelector).on("click."+e.options.itemNamespace,(function(){return r.event.preventDefault(),e.loadNextDomain(1)})),!1!==e.options.previousSelector&&r.select(e.options.previousSelector).on("click."+e.options.itemNamespace,(function(){return r.event.preventDefault(),e.loadPreviousDomain(1)})),e.Legend.redraw(e.graphDim.width-e.options.domainGutter-e.options.cellPadding),e.afterLoad();var t=e.getDomainKeys();e.options.loadOnInit?e.getDatas(e.options.data,new Date(t[0]),e.getSubDomain(t[t.length-1]).pop(),(function(){e.fill(),e.onComplete()})):e.onComplete(),e.checkIfMinDomainIsReached(t[0]),e.checkIfMaxDomainIsReached(e.getNextDomain().getTime())}(),e.root.call(e.tip),e.root.call(e.legendTip),!0},this.paint=function(t){var o=e.options;0===arguments.length&&(t=!1);var r=e.root.select(".graph").selectAll(".graph-domain").data((function(){var n=e.getDomainKeys();return t===e.NAVIGATE_LEFT?n.reverse():n}),(function(e){return e})),s=0,l=0,u=r.enter().append("svg").attr("width",(function(e){return a(e,!0)})).attr("height",(function(e){return i(e,!0)})).attr("x",(function(t){return o.verticalOrientation?(e.graphDim.width=Math.max(e.graphDim.width,a(t,!0)),0):c(t,e.graphDim,"width",a(t,!0))})).attr("y",(function(t){return o.verticalOrientation?c(t,e.graphDim,"height",i(t,!0)):(e.graphDim.height=Math.max(e.graphDim.height,i(t,!0)),0)})).attr("class",(function(t){var n="graph-domain",a=new Date(t);switch(o.domain){case"hour":n+=" h_"+a.getHours();case"day":n+=" d_"+a.getDate()+" dy_"+a.getDay();case"week":n+=" w_"+e.getWeekNumber(a);case"month":n+=" m_"+(a.getMonth()+1);case"year":n+=" y_"+a.getFullYear()}return n}));function c(n,a,o,i){var r=0;switch(t){case!1:return r=a[o],a[o]+=i,e.domainPosition.setPosition(n,r),r;case e.NAVIGATE_RIGHT:return e.domainPosition.setPosition(n,a[o]),s=i,l=e.domainPosition.getPositionFromIndex(1),e.domainPosition.shiftRightBy(l),a[o];case e.NAVIGATE_LEFT:return s=-(r=-i),l=a[o]-e.domainPosition.getLast(),e.domainPosition.setPosition(n,r),e.domainPosition.shiftLeftBy(s),r}}e.lastInsertedSvg=u,u.append("rect").attr("width",(function(e){return a(e,!0)-o.domainGutter-o.cellPadding})).attr("height",(function(e){return i(e,!0)-o.domainGutter-o.cellPadding})).attr("class","domain-background");var d=u.append("svg").attr("x",(function(){return"left"===o.label.position?e.domainHorizontalLabelWidth+o.domainMargin[3]:o.domainMargin[3]})).attr("y",(function(){return"top"===o.label.position?e.domainVerticalLabelHeight+o.domainMargin[0]:o.domainMargin[0]})).attr("class","graph-subdomain-group"),m=d.selectAll("g").data((function(t){return e._domains.get(t)})).enter().append("g");function h(t){switch(o.label.rotate){case"right":t.attr("transform",(function(t){var n="rotate(90), ";switch(o.label.position){case"right":n+="translate(-"+a(t)+" , -"+a(t)+")";break;case"left":n+="translate(0, -"+e.domainHorizontalLabelWidth+")"}return n}));break;case"left":t.attr("transform",(function(t){var n="rotate(270), ";switch(o.label.position){case"right":n+="translate(-"+(a(t)+e.domainHorizontalLabelWidth)+" , "+a(t)+")";break;case"left":n+="translate(-"+e.domainHorizontalLabelWidth+" , "+e.domainHorizontalLabelWidth+")"}return n}))}}m.append("rect").attr("class",(function(t){return"graph-rect"+e.getHighlightClassName(t.t)+(null!==o.onClick?" hover_cursor":"")})).attr("width",o.cellSize).attr("height",o.cellSize).attr("x",(function(t){return e.positionSubDomainX(t.t)})).attr("y",(function(t){return e.positionSubDomainY(t.t)})).on("click",(function(t){if(null!==o.onClick)return e.onClick(new Date(t.t),t.v)})).call((function(t){o.cellRadius>0&&t.attr("rx",o.cellRadius).attr("ry",o.cellRadius),null!==e.legendScale&&null!==o.legendColors&&o.legendColors.hasOwnProperty("base")&&t.attr("fill",o.legendColors.base),o.tooltip&&t.on("mouseover",(function(t){e.tip.show(t,this)})).on("mouseout",(function(){e.tip.hide(n)}))})),o.tooltip||m.append("title").text((function(t){return e.formatDate(new Date(t.t),o.subDomainDateFormat)})),""!==o.domainLabelFormat&&u.append("text").attr("class","graph-label").attr("y",(function(t){var n=o.domainMargin[0];switch(o.label.position){case"top":n+=e.domainVerticalLabelHeight/2;break;case"bottom":n+=i(t)+e.domainVerticalLabelHeight/2}return n+o.label.offset.y*("right"===o.label.rotate&&"right"===o.label.position||"left"===o.label.rotate&&"left"===o.label.position?-1:1)})).attr("x",(function(t){var n=o.domainMargin[3];switch(o.label.position){case"right":n+=a(t);break;case"bottom":case"top":n+=a(t)/2}return"right"===o.label.align?n+e.domainHorizontalLabelWidth-o.label.offset.x*("right"===o.label.rotate?-1:1):n+o.label.offset.x})).attr("text-anchor",(function(){switch(o.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}})).attr("dominant-baseline",(function(){return e.verticalDomainLabel?"middle":"top"})).text((function(t){return e.formatDate(new Date(t),o.domainLabelFormat)})).call(h),null!==o.subDomainTextFormat&&m.append("text").attr("class",(function(t){return"subdomain-text"+e.getHighlightClassName(t.t)})).attr("x",(function(t){return e.positionSubDomainX(t.t)+o.cellSize/2})).attr("y",(function(t){return e.positionSubDomainY(t.t)+o.cellSize/2})).attr("text-anchor","middle").attr("dominant-baseline","central").text((function(t){return e.formatDate(new Date(t.t),o.subDomainTextFormat)})),!1!==t&&r.transition().duration(o.animationDuration).attr("x",(function(t){return o.verticalOrientation?0:e.domainPosition.getPosition(t)})).attr("y",(function(t){return o.verticalOrientation?e.domainPosition.getPosition(t):0}));var g=e.graphDim.width,p=e.graphDim.height;o.verticalOrientation?e.graphDim.height+=s-l:e.graphDim.width+=s-l,r.exit().transition().duration(o.animationDuration).attr("x",(function(n){if(o.verticalOrientation)return 0;switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.width,g);case e.NAVIGATE_RIGHT:return-a(n,!0)}})).attr("y",(function(n){if(!o.verticalOrientation)return 0;switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.height,p);case e.NAVIGATE_RIGHT:return-i(n,!0)}})).remove(),e.resize()}});s.prototype={init:function(e){var t=this,n=t.options=c(t.options,e);if(function(){if(!t._domainType.hasOwnProperty(n.domain)||"min"===n.domain||"x_"===n.domain.substring(0,2))throw new Error("The domain '"+n.domain+"' is not valid");if(!t._domainType.hasOwnProperty(n.subDomain)||"year"===n.subDomain)throw new Error("The subDomain '"+n.subDomain+"' is not valid");if(t._domainType[n.domain].level<=t._domainType[n.subDomain].level)throw new Error("'"+n.subDomain+"' is not a valid subDomain to '"+n.domain+"'")}(),s(n.itemSelector,!1,"itemSelector"),-1===t.allowedDataType.indexOf(n.dataType))throw new Error("The data type '"+n.dataType+"' is not valid data type");if(null===r.select(n.itemSelector)[0][0])throw new Error("The node '"+n.itemSelector+"' specified in itemSelector does not exists");try{s(n.nextSelector,!0,"nextSelector"),s(n.previousSelector,!0,"previousSelector")}catch(e){return console.log(e.message),!1}e.hasOwnProperty("subDomain")||(this.options.subDomain=function(e){switch(e){case"year":return"month";case"month":case"week":return"day";case"day":return"hour";default:return"min"}}(e.domain)),"string"==typeof n.itemNamespace&&""!==n.itemNamespace||(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),n.itemNamespace="cal-heatmap");var a,o=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var i in o)e.hasOwnProperty(o[i])&&(n[o[i]]=e[o[i]]);function s(e,t,n){if((t&&!1===e||e instanceof Element||"string"==typeof e)&&""!==e)return!0;throw new Error("The "+n+" is not valid")}function l(e){switch("number"==typeof e&&(e=[e]),Array.isArray(e)||(console.log("Margin only takes an integer or an array of integers"),e=[0]),e.length){case 1:return[e[0],e[0],e[0],e[0]];case 2:return[e[0],e[1],e[0],e[1]];case 3:return[e[0],e[1],e[2],e[1]];case 4:return e;default:return e.slice(0,4)}}return n.subDomainDateFormat="string"==typeof n.subDomainDateFormat||"function"==typeof n.subDomainDateFormat?n.subDomainDateFormat:this._domainType[n.subDomain].format.date,n.domainLabelFormat="string"==typeof n.domainLabelFormat||"function"==typeof n.domainLabelFormat?n.domainLabelFormat:this._domainType[n.domain].format.legend,n.subDomainTextFormat="string"==typeof n.subDomainTextFormat&&""!==n.subDomainTextFormat||"function"==typeof n.subDomainTextFormat?n.subDomainTextFormat:null,n.domainMargin=l(n.domainMargin),n.legendMargin=l(n.legendMargin),n.highlight=t.expandDateSetting(n.highlight),n.itemName=function(e){return"string"==typeof e?[e,e+(""!==e?"s":"")]:Array.isArray(e)?1===e.length?[e[0],e[0]+"s"]:e.length>2?e.slice(0,2):e:["item","items"]}(n.itemName),n.colLimit=(a=n.colLimit)>0?a:null,n.rowLimit=function(e){return e>0&&n.colLimit>0?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):e>0?e:null}(n.rowLimit),e.hasOwnProperty("legendMargin")||function(){switch(n.legendVerticalPosition){case"top":n.legendMargin[2]=t.DEFAULT_LEGEND_MARGIN;break;case"bottom":n.legendMargin[0]=t.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":n.legendMargin["right"===n.legendHorizontalPosition?3:1]=t.DEFAULT_LEGEND_MARGIN}}(),function(){if(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("align")){switch(n.label.position){case"left":n.label.align="right";break;case"right":n.label.align="left";break;default:n.label.align="center"}"left"===n.label.rotate?n.label.align="right":"right"===n.label.rotate&&(n.label.align="left")}(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("offset"))&&("left"!==n.label.position&&"right"!==n.label.position||(n.label.offset={x:10,y:15}))}(),this._init()},expandDateSetting:function(e){return Array.isArray(e)||(e=[e]),e.map((function(e){return"now"===e?new Date:e instanceof Date&&e})).filter((function(e){return!1!==e}))},fill:function(e){var t=this,n=t.options;0===arguments.length&&(e=t.root.selectAll(".graph-domain"));var a=e.selectAll("svg").selectAll("g").data((function(e){return t._domains.get(e)}));function o(e){if(null===t.legendScale)return!1;e.attr("fill",(function(e){return null===e.v&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero&&n.legendColors.hasOwnProperty("base")?n.legendColors.base:null!==n.legendColors&&n.legendColors.hasOwnProperty("empty")&&(0===e.v||null===e.v&&n.hasOwnProperty("considerMissingDataAsZero")&&n.considerMissingDataAsZero)?n.legendColors.empty:e.v<0&&n.legend[0]>0&&null!==n.legendColors&&n.legendColors.hasOwnProperty("overflow")?n.legendColors.overflow:t.legendScale(Math.min(e.v,n.legend[n.legend.length-1]))}))}function r(e){"function"==typeof n.subDomainTextFormat&&e.text((function(e){return n.subDomainTextFormat(e.t,e.v)}))}a.transition().duration(n.animationDuration).select("rect").attr("class",(function(e){var a=t.getHighlightClassName(e.t).trim().split(" "),o=t.dateIsLessThan(e.t,new Date),i=t.dateIsEqual(e.t,new Date);return(null===t.legendScale||null===e.v&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero&&!n.legendColors.hasOwnProperty("base"))&&a.push("graph-rect"),i?a.push("now"):o||a.push("future"),null!==e.v?a.push(t.Legend.getClass(e.v,null===t.legendScale)):n.considerMissingDataAsZero&&o&&a.push(t.Legend.getClass(0,null===t.legendScale)),null!==n.onClick&&a.push("hover_cursor"),a.join(" ")})).call(o),a.transition().duration(n.animationDuration).select("title").text((function(e){return t.getSubDomainTitle(e)})),a.transition().duration(n.animationDuration).select("text").attr("class",(function(e){return"subdomain-text"+t.getHighlightClassName(e.t)})).call(r).attr("fill",(e=>{if(!e.v)return"#000";const a=t.legendScale(Math.min(e.v,n.legend[n.legend.length-1]));return(0,i.Q)(a,135)}))},formatStringWithObject:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var a=new RegExp("\\{"+n+"\\}","gi");e=e.replace(a,t[n])}return e},triggerEvent:function(e,t,n){return!!(3===arguments.length&&n||null===this.options[e])||("function"==typeof this.options[e]?("function"==typeof t&&(t=t()),this.options[e].apply(this,t)):(console.log("Provided callback for "+e+" is not a function."),!1))},onClick:function(e,t){return this.triggerEvent("onClick",[e,t])},afterLoad:function(){return this.triggerEvent("afterLoad")},onComplete:function(){var e=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,e},afterLoadPreviousDomain:function(e){var t=this;return this.triggerEvent("afterLoadPreviousDomain",(function(){var n=t.getSubDomain(e);return[n.shift(),n.pop()]}))},afterLoadNextDomain:function(e){var t=this;return this.triggerEvent("afterLoadNextDomain",(function(){var n=t.getSubDomain(e);return[n.shift(),n.pop()]}))},onMinDomainReached:function(e){return this._minDomainReached=e,this.triggerEvent("onMinDomainReached",[e])},onMaxDomainReached:function(e){return this._maxDomainReached=e,this.triggerEvent("onMaxDomainReached",[e])},checkIfMinDomainIsReached:function(e,t){this.minDomainIsReached(e)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(t)&&this.onMaxDomainReached(!1)},checkIfMaxDomainIsReached:function(e,t){this.maxDomainIsReached(e)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(t)&&this.onMinDomainReached(!1)},afterUpdate:function(){return this.triggerEvent("afterUpdate")},formatNumber:r.format(",g"),formatDate:function(e,t){if(arguments.length<2&&(t="title"),"function"==typeof t)return t(e);var n=r.time.format(t);return n(e)},getSubDomainTitle:function(e){if(null!==e.v||this.options.considerMissingDataAsZero){var t=e.v;return null===t&&this.options.considerMissingDataAsZero&&(t=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(t),name:this.options.itemName[1!==t?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})}return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})},loadNextDomain:function(e){if(this._maxDomainReached||0===e)return!1;var t=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),e));return this.afterLoadNextDomain(t.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),t.start),!0},loadPreviousDomain:function(e){if(this._minDomainReached||0===e)return!1;var t=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-e).reverse());return this.afterLoadPreviousDomain(t.start),this.checkIfMinDomainIsReached(t.start,t.end),!0},loadNewDomains:function(e,t){var n=this,a=e===this.NAVIGATE_LEFT,o=-1,i=t.length,r=this.getDomainKeys();function s(e){return{t:n._domainType[n.options.subDomain].extractUnit(e),v:null}}for(;++o<i;){if(a&&this.minDomainIsReached(t[o])){t=t.slice(0,o+1);break}if(!a&&this.maxDomainIsReached(t[o])){t=t.slice(0,o);break}}for(o=0,i=(t=t.slice(-this.options.range)).length;o<i;o+=1)this._domains.set(t[o].getTime(),this.getSubDomain(t[o]).map(s)),this._domains.remove(a?r.pop():r.shift());return r=this.getDomainKeys(),a&&(t=t.reverse()),this.paint(e),this.getDatas(this.options.data,t[0],this.getSubDomain(t[t.length-1]).pop(),(function(){n.fill(n.lastInsertedSvg)})),{start:t[a?0:1],end:r[r.length-1]}},maxDomainIsReached:function(e){return null!==this.options.maxDate&&this.options.maxDate.getTime()<e},minDomainIsReached:function(e){return null!==this.options.minDate&&this.options.minDate.getTime()>=e},getDomainKeys:function(){return this._domains.keys().map((function(e){return parseInt(e,10)})).sort((function(e,t){return e-t}))},positionSubDomainX:function(e){var t=this._domainType[this.options.subDomain].position.x(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},positionSubDomainY:function(e){var t=this._domainType[this.options.subDomain].position.y(new Date(e));return t*this.options.cellSize+t*this.options.cellPadding},getSubDomainColumnNumber:function(e){if(this.options.rowLimit>0){var t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.rowLimit)}var n=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof n&&(n=n(e)),this.options.colLimit||n},getSubDomainRowNumber:function(e){if(this.options.colLimit>0){var t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.colLimit)}var n=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof n&&(n=n(e)),this.options.rowLimit||n},getHighlightClassName:function(e){if(e=new Date(e),this.options.highlight.length>0)for(var t in this.options.highlight)if(this.dateIsEqual(this.options.highlight[t],e))return this.isNow(this.options.highlight[t])?" highlight-now":" highlight";return""},isNow:function(e){return this.dateIsEqual(e,new Date)},dateIsEqual:function(e,t){switch(e instanceof Date||(e=new Date(e)),t instanceof Date||(t=new Date(t)),this.options.subDomain){case"x_min":case"min":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours()&&e.getMinutes()===t.getMinutes();case"x_hour":case"hour":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()&&e.getHours()===t.getHours();case"x_day":case"day":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate();case"x_week":case"week":return e.getFullYear()===t.getFullYear()&&this.getWeekNumber(e)===this.getWeekNumber(t);case"x_month":case"month":return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth();default:return!1}},dateIsLessThan:function(e,t){function n(e,t){switch(t){case"x_min":case"min":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()).getTime();case"x_hour":case"hour":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()).getTime();case"x_day":case"day":return new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(e.getFullYear(),e.getMonth()).getTime();default:return e.getTime()}}return e instanceof Date||(e=new Date(e)),t instanceof Date||(t=new Date(t)),n(e,this.options.subDomain)<n(t,this.options.subDomain)},getDayOfYear:r.time.format("%j"),getWeekNumber:function(e){return(!0===this.options.weekStartOnMonday?r.time.format("%W"):r.time.format("%U"))(e)},getMonthWeekNumber:function(e){"number"==typeof e&&(e=new Date(e));var t=this.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));return this.getWeekNumber(e)-t-1},getWeekNumberInYear:function(e){"number"==typeof e&&(e=new Date(e))},getDayCountInMonth:function(e){return this.getEndOfMonth(e).getDate()},getDayCountInYear:function(e){return"number"==typeof e&&(e=new Date(e)),1===new Date(e.getFullYear(),1,29).getMonth()?366:365},getWeekDay:function(e){return!1===this.options.weekStartOnMonday?e.getDay():0===e.getDay()?6:e.getDay()-1},getEndOfMonth:function(e){return"number"==typeof e&&(e=new Date(e)),new Date(e.getFullYear(),e.getMonth()+1,0)},jumpDate:function(e,t,n){var a=new Date(e);switch(n){case"hour":a.setHours(a.getHours()+t);break;case"day":a.setHours(a.getHours()+24*t);break;case"week":a.setHours(a.getHours()+24*t*7);break;case"month":a.setMonth(a.getMonth()+t);break;case"year":a.setFullYear(a.getFullYear()+t)}return new Date(a)},getMinuteDomain:function(e,t){var n,a=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());return n=t instanceof Date?new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()):new Date(+a+1e3*t*60),r.time.minutes(Math.min(a,n),Math.max(a,n))},getHourDomain:function(e,t){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),a=null;t instanceof Date?a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()):(a=new Date(n)).setHours(a.getHours()+t);var o=r.time.hours(Math.min(n,a),Math.max(n,a)),i=0,s=o.length;for(i=0;i<s;i+=1)if(i>0&&o[i].getHours()===o[i-1].getHours()){this.DSTDomain.push(o[i].getTime()),o.splice(i,1);break}return"number"==typeof t&&o.length>Math.abs(t)&&o.splice(o.length-1,1),o},getDayDomain:function(e,t){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=null;return t instanceof Date?a=new Date(t.getFullYear(),t.getMonth(),t.getDate()):(a=new Date(n),a=new Date(a.setDate(a.getDate()+parseInt(t,10)))),r.time.days(Math.min(n,a),Math.max(n,a))},getWeekDomain:function(e,t){var n;!1===this.options.weekStartOnMonday?n=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()):1===e.getDay()?n=new Date(e.getFullYear(),e.getMonth(),e.getDate()):0===e.getDay()?(n=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(n.getDate()-6):n=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+1);var a=new Date(n),o=t;return"object"!=typeof t&&(o=new Date(a.setDate(a.getDate()+7*t))),!0===this.options.weekStartOnMonday?r.time.mondays(Math.min(n,o),Math.max(n,o)):r.time.sundays(Math.min(n,o),Math.max(n,o))},getMonthDomain:function(e,t){var n=new Date(e.getFullYear(),e.getMonth()),a=null;return a=t instanceof Date?new Date(t.getFullYear(),t.getMonth()):(a=new Date(n)).setMonth(a.getMonth()+t),r.time.months(Math.min(n,a),Math.max(n,a))},getYearDomain:function(e,t){var n,a=new Date(e.getFullYear(),0);return n=t instanceof Date?new Date(t.getFullYear(),0):new Date(e.getFullYear()+t,0),r.time.years(Math.min(a,n),Math.max(a,n))},getDomain:function(e,t){switch("number"==typeof e&&(e=new Date(e)),arguments.length<2&&(t=this.options.range),this.options.domain){case"hour":var n=this.getHourDomain(e,t);return"number"==typeof t&&n.length<t&&(t>0?n.push(this.getHourDomain(n[n.length-1],2)[1]):n.shift(this.getHourDomain(n[0],-2)[0])),n;case"day":return this.getDayDomain(e,t);case"week":return this.getWeekDomain(e,t);case"month":return this.getMonthDomain(e,t);case"year":return this.getYearDomain(e,t)}},getSubDomain:function(e){"number"==typeof e&&(e=new Date(e));var t=this;switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(e,function(e,t){switch(t){case"hour":return 60;case"day":return 1440;case"week":return 10080}}(0,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(e,function(e,n){switch(n){case"day":return 24;case"week":return 168;case"month":return 24*t.getDayCountInMonth(e)}}(e,this.options.domain));case"x_day":case"day":return this.getDayDomain(e,function(e,n){switch(n){case"year":return t.getDayCountInYear(e);case"month":return t.getDayCountInMonth(e);case"week":return 7}}(e,this.options.domain));case"x_week":case"week":return this.getWeekDomain(e,function(e,n){if("month"===n){var a=new Date(e.getFullYear(),e.getMonth()+1,0),o=t.getWeekNumber(a),i=t.getWeekNumber(new Date(e.getFullYear(),e.getMonth()));return i>o&&(i=0,o+=1),o-i+1}if("year"===n)return t.getWeekNumber(new Date(e.getFullYear(),11,31))}(e,this.options.domain));case"x_month":case"month":return this.getMonthDomain(e,12)}},getNextDomain:function(e){return 0===arguments.length&&(e=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),e,this.options.domain),1)[0]},getPreviousDomain:function(e){return 0===arguments.length&&(e=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-e,this.options.domain),1)[0]},getDatas:function(e,t,n,a,o,i){var s=this;arguments.length<5&&(o=!0),arguments.length<6&&(i=this.APPEND_ON_UPDATE);var l=function(e,r){!1!==o?"function"==typeof o?r=o(r):"function"==typeof s.options.afterLoadData?r=s.options.afterLoadData(r):console.log("Provided callback for afterLoadData is not a function."):"csv"!==s.options.dataType&&"tsv"!==s.options.dataType||(r=this.interpretCSV(r)),s.parseDatas(r,i,t,n),"function"==typeof a&&a()};switch(typeof e){case"string":if(""===e)return l(null,{}),!0;var u=this.parseURI(e,t,n),c="GET";null!==s.options.dataPostPayload&&(c="POST");var d=null;null!==s.options.dataPostPayload&&(d=this.parseURI(s.options.dataPostPayload,t,n));var m=null;switch(this.options.dataType){case"json":m=r.json(u);break;case"csv":m=r.csv(u);break;case"tsv":m=r.tsv(u);break;case"txt":m=r.text(u,"text/plain")}if(null!==s.options.dataRequestHeaders)for(var h in s.options.dataRequestHeaders)s.options.dataRequestHeaders.hasOwnProperty(h)&&m.header(h,s.options.dataRequestHeaders[h]);return m.send(c,d,l),!1;case"object":if(e===Object(e))return l(null,e),!1;default:return l(null,{}),!0}},parseDatas:function(e,t,n,a){t===this.RESET_ALL_ON_UPDATE&&this._domains.forEach((function(e,t){t.forEach((function(e,t,n){n[t].v=null}))}));var o={},i=function(e){return e.t};for(var r in e){var s=new Date(1e3*r),l=this.getDomain(s)[0].getTime();if(this.DSTDomain.indexOf(l)>=0&&this._domains.has(l-36e5)&&(l-=36e5),!isNaN(r)&&e.hasOwnProperty(r)&&this._domains.has(l)&&l>=+n&&l<+a){var u=this._domains.get(l);o.hasOwnProperty(l)||(o[l]=u.map(i));var c=o[l].indexOf(this._domainType[this.options.subDomain].extractUnit(s));t===this.RESET_SINGLE_ON_UPDATE||isNaN(u[c].v)?u[c].v=e[r]:u[c].v+=e[r]}}},parseURI:function(e,t,n){return(e=(e=(e=e.replace(/\{\{t:start\}\}/g,t.getTime()/1e3)).replace(/\{\{t:end\}\}/g,n.getTime()/1e3)).replace(/\{\{d:start\}\}/g,t.toISOString())).replace(/\{\{d:end\}\}/g,n.toISOString())},interpretCSV:function(e){var t,n,a={},o=Object.keys(e[0]);for(t=0,n=e.length;t<n;t+=1)a[e[t][o[0]]]=+e[t][o[1]];return a},resize:function(){var e=this,t=e.options,n=t.displayLegend?e.Legend.getDim("width")+t.legendMargin[1]+t.legendMargin[3]:0,a=t.displayLegend?e.Legend.getDim("height")+t.legendMargin[0]+t.legendMargin[2]:0,o=e.graphDim.width-t.domainGutter-t.cellPadding,i=e.graphDim.height-t.domainGutter-t.cellPadding;this.root.transition().duration(t.animationDuration).attr("width",(function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?o+n:Math.max(o,n)})).attr("height",(function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?Math.max(i,a):i+a})),this.root.select(".graph").transition().duration(t.animationDuration).attr("y",(function(){return"top"===t.legendVerticalPosition?a:0})).attr("x",(function(){return"middle"!==t.legendVerticalPosition&&"center"!==t.legendVerticalPosition||"left"!==t.legendHorizontalPosition?0:n}))},next:function(e){return 0===arguments.length&&(e=1),this.loadNextDomain(e)},previous:function(e){return 0===arguments.length&&(e=1),this.loadPreviousDomain(e)},jumpTo:function(e,t){arguments.length<2&&(t=!1);var n=this.getDomainKeys(),a=n[0],o=n[n.length-1];return e<a?this.loadPreviousDomain(this.getDomain(a,e).length):t?this.loadNextDomain(this.getDomain(a,e).length):e>o&&this.loadNextDomain(this.getDomain(o,e).length)},rewind:function(){this.jumpTo(this.options.start,!0)},update:function(e,t,n){0===arguments.length&&(e=this.options.data),arguments.length<2&&(t=!0),arguments.length<3&&(n=this.RESET_ALL_ON_UPDATE);var a=this.getDomainKeys(),o=this;this.getDatas(e,new Date(a[0]),this.getSubDomain(a[a.length-1]).pop(),(function(){o.fill(),o.afterUpdate()}),t,n)},setLegend:function(){var e=this.options.legend.slice(0);arguments.length>=1&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),arguments.length>=2&&(Array.isArray(arguments[1])&&arguments[1].length>=2?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(arguments.length>0&&!d(e,this.options.legend)||arguments.length>=2)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function(){return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)},showLegend:function(){return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)},highlight:function(e){return(this.options.highlight=this.expandDateSetting(e)).length>0&&(this.fill(),!0)},destroy:function(e){return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each("end",(function(){"function"==typeof e?e():void 0!==e&&console.log("Provided callback for destroy() is not a function.")})),null},getSVG:function(){for(var e={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},t=1,n=this.options.legend.length+1;t<=n;t+=1)e[".q"+t]={};var a,o=this.root,i=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],r=function(t,n,a){-1!==i.indexOf(n)&&(e[t][n]=a)};for(var s in e)if(e.hasOwnProperty(s)){var l=(a=s,o.select(a)[0][0]);if(null!==l)if("getComputedStyle"in window){var u=getComputedStyle(l,null);if(0!==u.length)for(var c=0;c<u.length;c+=1)r(s,u.item(c),u.getPropertyValue(u.item(c)));else for(var d in u)u.hasOwnProperty(d)&&r(s,d,u[d])}else if("currentStyle"in l){var m=l.currentStyle;for(var h in m)r(s,h,m[h])}}var g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var p in e){for(var f in g+=p+" {\n",e[p])g+="\t"+f+":"+e[p][f]+";\n";g+="}\n"}return g+="]]></style>",(g+=(new XMLSerializer).serializeToString(this.root[0][0]))+"</svg>"}};var l=function(){this.positions=r.map()};l.prototype.getPosition=function(e){return this.positions.get(e)},l.prototype.getPositionFromIndex=function(e){var t=this.getKeys();return this.positions.get(t[e])},l.prototype.getLast=function(){var e=this.getKeys();return this.positions.get(e[e.length-1])},l.prototype.setPosition=function(e,t){this.positions.set(e,t)},l.prototype.shiftRightBy=function(e){this.positions.forEach((function(t,n){this.set(t,n-e)}));var t=this.getKeys();this.positions.remove(t[0])},l.prototype.shiftLeftBy=function(e){this.positions.forEach((function(t,n){this.set(t,n+e)}));var t=this.getKeys();this.positions.remove(t[t.length-1])},l.prototype.getKeys=function(){return this.positions.keys().sort((function(e,t){return parseInt(e,10)-parseInt(t,10)}))};var u=function(e){this.calendar=e,this.computeDim(),null!==e.options.legendColors&&this.buildColors()};function c(e,t){for(var n in t)try{t[n].constructor===Object?e[n]=c(e[n],t[n]):e[n]=t[n]}catch(a){e[n]=t[n]}return e}function d(e,t){if(!t||!e)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(e[n]instanceof Array&&t[n]instanceof Array){if(!d(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}u.prototype.computeDim=function(){var e=this.calendar.options;this.dim={width:e.legendCellSize*(e.legend.length+1)+e.legendCellPadding*e.legend.length,height:e.legendCellSize}},u.prototype.remove=function(){this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()},u.prototype.redraw=function(e){if(!this.calendar.options.displayLegend)return!1;var t,n=this,a=this.calendar,o=a.root,i=a.options;this.computeDim();var r=i.legend.slice(0);r.push(r[r.length-1]+1);var s=a.root.select(".graph-legend");function l(e){e.attr("width",i.legendCellSize).attr("height",i.legendCellSize).attr("rx",i.legendCellRadius).attr("ry",i.legendCellRadius).attr("x",(function(e,t){return t*(i.legendCellSize+i.legendCellPadding)}))}function u(){switch(i.legendHorizontalPosition){case"right":return"center"===i.legendVerticalPosition||"middle"===i.legendVerticalPosition?e+i.legendMargin[3]:e-n.getDim("width")-i.legendMargin[1];case"middle":case"center":return Math.round(e/2-n.getDim("width")/2);default:return i.legendMargin[3]}}function c(){return"bottom"===i.legendVerticalPosition?a.graphDim.height+i.legendMargin[0]-i.domainGutter-i.cellPadding:i.legendMargin[0]}null!==s[0][0]?t=(o=s).select("g").selectAll("rect").data(r):((o="top"===i.legendVerticalPosition?o.insert("svg",".graph"):o.append("svg")).attr("x",u()).attr("y",c()),t=o.attr("class","graph-legend").attr("height",n.getDim("height")).attr("width",n.getDim("width")).append("g").selectAll().data(r)),t.enter().append("rect").call(l).attr("class",(function(e){return a.Legend.getClass(e,null===a.legendScale)})).attr("fill-opacity",0).call((function(e){null!==a.legendScale&&null!==i.legendColors&&i.legendColors.hasOwnProperty("base")&&e.attr("fill",i.legendColors.base)})).append("title"),t.exit().transition().duration(i.animationDuration).attr("fill-opacity",0).remove(),t.transition().delay((function(e,t){return i.animationDuration*t/10})).call(l).attr("fill-opacity",1).call((function(e){e.attr("fill",(function(e,t){return null===a.legendScale?"":0===t?a.legendScale(e-1):a.legendScale(i.legend[t-1])})),e.attr("class",(function(e){return a.Legend.getClass(e,null===a.legendScale)}))})),t.select("title").text((function(e,t){return 0===t?a.formatStringWithObject(i.legendTitleFormat.lower,{min:i.legend[t],name:i.itemName[1]}):t===r.length-1?a.formatStringWithObject(i.legendTitleFormat.upper,{max:i.legend[t-1],name:i.itemName[1]}):a.formatStringWithObject(i.legendTitleFormat.inner,{down:i.legend[t-1],up:i.legend[t],name:i.itemName[1]})})),t.on("mouseover",(function(e){a.legendTip.show(e,this)})).on("mouseout",(function(){a.legendTip.hide()})),o.transition().duration(i.animationDuration).attr("x",u()).attr("y",c()).attr("width",n.getDim("width")).attr("height",n.getDim("height")),o.select("g").transition().duration(i.animationDuration).attr("transform",(function(){return"vertical"===i.legendOrientation?"rotate(90 "+i.legendCellSize/2+" "+i.legendCellSize/2+")":""})),a.resize()},u.prototype.getDim=function(e){var t="horizontal"===this.calendar.options.legendOrientation;switch(e){case"width":return this.dim[t?"width":"height"];case"height":return this.dim[t?"height":"width"]}},u.prototype.buildColors=function(){var e=this.calendar.options;if(null===e.legendColors)return this.calendar.legendScale=null,!1;var t=[];if(Array.isArray(e.legendColors))t=e.legendColors;else{if(!e.legendColors.hasOwnProperty("min")||!e.legendColors.hasOwnProperty("max"))return e.legendColors=null,!1;t=[e.legendColors.min,e.legendColors.max]}var n,a=e.legend.slice(0);a[0]>0?a.unshift(0):a[0]<=0&&a.unshift(a[0]-(a[a.length-1]-a[0])/a.length),n=e.legendColors.hasOwnProperty("colorScale")?e.legendColors.colorScale:r.scale.linear().range(t).interpolate(r.interpolateHcl).domain([r.min(a),r.max(a)]);var o=a.map((function(e){return n(e)}));return this.calendar.legendScale=r.scale.threshold().domain(e.legend).range(o),!0},u.prototype.getClass=function(e,t){if(null===e||isNaN(e))return"";for(var n=[this.calendar.options.legend.length+1],a=0,o=this.calendar.options.legend.length-1;a<=o;a+=1){if(this.calendar.options.legend[0]>0&&e<0){n=["1","i"];break}if(e<=this.calendar.options.legend[a]){n=[a+1];break}}return 0===e&&n.push(0),n.unshift(""),(n.join(" r")+(t?n.join(" q"):"")).trim()};const m=s,h=m;var g,p;(g="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(g.register(r,"d3","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(s,"CalHeatMap","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(l,"DomainPosition","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(u,"Legend","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(c,"mergeRecursive","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(d,"arrayEquals","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js"),g.register(m,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js")),(p="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&p(e)},943323:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>reactify});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(667294),_emotion_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},reactHotLoader,leaveModule;function reactify(renderFn,callbacks){class ReactifiedComponent extends react__WEBPACK_IMPORTED_MODULE_0__.Component{constructor(e){super(e),this.container=void 0,this.setContainerRef=this.setContainerRef.bind(this)}componentDidMount(){this.execute()}componentDidUpdate(){this.execute()}componentWillUnmount(){this.container=void 0,null!=callbacks&&callbacks.componentWillUnmount&&callbacks.componentWillUnmount.bind(this)()}setContainerRef(e){this.container=e}execute(){this.container&&renderFn(this.container,this.props)}render(){const{id:e,className:t}=this.props;return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_1__.tZ)("div",{ref:this.setContainerRef,id:e,className:t})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}const ReactifiedClass=ReactifiedComponent;return renderFn.displayName&&(ReactifiedClass.displayName=renderFn.displayName),renderFn.propTypes&&(ReactifiedClass.propTypes={...ReactifiedClass.propTypes,...renderFn.propTypes}),renderFn.defaultProps&&(ReactifiedClass.defaultProps=renderFn.defaultProps),ReactifiedComponent}reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&reactHotLoader.register(reactify,"reactify","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/packages/superset-ui-core/src/chart/components/reactify.tsx"),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},25130:(e,t,n)=>{var a;n.d(t,{Q:()=>i}),e=n.hmd(e),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&a(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const o=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/;function i(e,t=186){let n=0,a=0,i=0;if(e.length>7){const t=o.exec(e);if(!t)throw new Error(`Invalid color: ${e}`);n=parseInt(t[1],10),a=parseInt(t[2],10),i=parseInt(t[3],10)}else{let t=e;if(t.startsWith("#")&&(t=t.substring(1)),3===t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]].join("")),6!==t.length)throw new Error(`Invalid color: ${e}`);n=parseInt(t.slice(0,2),16),a=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16)}return.299*n+.587*a+.114*i>t?"#000":"#FFF"}var r,s;(r="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(r.register(o,"rgbRegex","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/packages/superset-ui-core/src/color/utils.ts"),r.register(i,"getContrastingColor","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/packages/superset-ui-core/src/color/utils.ts")),(s="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&s(e)}}]);