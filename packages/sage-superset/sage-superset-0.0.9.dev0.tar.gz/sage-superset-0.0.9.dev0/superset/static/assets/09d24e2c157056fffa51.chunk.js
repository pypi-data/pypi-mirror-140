"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[6089],{96089:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DEFAULT_MAX_ZOOM:()=>DEFAULT_MAX_ZOOM,DEFAULT_POINT_RADIUS:()=>DEFAULT_POINT_RADIUS,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_corejs3_helpers_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(205872),_babel_runtime_corejs3_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_corejs3_helpers_extends__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(667294),prop_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_2__),react_map_gl__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(998601),viewport_mercator_project__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(511569),_ScatterPlotGlowOverlay__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(644711),_MapBox_css__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(299262),_emotion_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const NOOP=()=>{},DEFAULT_MAX_ZOOM=16,DEFAULT_POINT_RADIUS=60,propTypes={width:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,height:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,aggregatorName:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,clusterer:prop_types__WEBPACK_IMPORTED_MODULE_2___default().object,globalOpacity:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,hasCustomMetric:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,mapStyle:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,mapboxApiKey:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string.isRequired,onViewportChange:prop_types__WEBPACK_IMPORTED_MODULE_2___default().func,pointRadius:prop_types__WEBPACK_IMPORTED_MODULE_2___default().number,pointRadiusUnit:prop_types__WEBPACK_IMPORTED_MODULE_2___default().string,renderWhileDragging:prop_types__WEBPACK_IMPORTED_MODULE_2___default().bool,rgb:prop_types__WEBPACK_IMPORTED_MODULE_2___default().array,bounds:prop_types__WEBPACK_IMPORTED_MODULE_2___default().array},defaultProps={width:400,height:400,globalOpacity:1,onViewportChange:NOOP,pointRadius:DEFAULT_POINT_RADIUS,pointRadiusUnit:"Pixels"};class MapBox extends react__WEBPACK_IMPORTED_MODULE_1__.Component{constructor(e){super(e);const{width:_,height:r,bounds:t}=this.props,o=new viewport_mercator_project__WEBPACK_IMPORTED_MODULE_5__.Z({width:_,height:r}).fitBounds(t),{latitude:a,longitude:s,zoom:l}=o;this.state={viewport:{longitude:s,latitude:a,zoom:l}},this.handleViewportChange=this.handleViewportChange.bind(this)}handleViewportChange(e){this.setState({viewport:e});const{onViewportChange:_}=this.props;_(e)}render(){const{width:e,height:_,aggregatorName:r,clusterer:t,globalOpacity:o,mapStyle:a,mapboxApiKey:s,pointRadius:l,pointRadiusUnit:n,renderWhileDragging:i,rgb:p,hasCustomMetric:u,bounds:c}=this.props,{viewport:d}=this.state,E=void 0!==d.isDragging&&d.isDragging,P=.5*e/100,g=.5*_/100,M=[c[0][0]-P,c[0][1]-g,c[1][0]+P,c[1][1]+g],O=t.getClusters(M,Math.round(d.zoom));return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_6__.tZ)(react_map_gl__WEBPACK_IMPORTED_MODULE_3__.ZP,_babel_runtime_corejs3_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},d,{mapStyle:a,width:e,height:_,mapboxApiAccessToken:s,onViewportChange:this.handleViewportChange,preserveDrawingBuffer:!0}),(0,_emotion_react__WEBPACK_IMPORTED_MODULE_6__.tZ)(_ScatterPlotGlowOverlay__WEBPACK_IMPORTED_MODULE_7__.Z,_babel_runtime_corejs3_helpers_extends__WEBPACK_IMPORTED_MODULE_0___default()({},d,{isDragging:E,locations:O,dotRadius:l,pointRadiusUnit:n,rgb:p,globalOpacity:o,compositeOperation:"screen",renderWhileDragging:i,aggregation:u?r:null,lngLatAccessor:e=>{const{coordinates:_}=e.geometry;return[_[0],_[1]]}})))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}MapBox.propTypes=propTypes,MapBox.defaultProps=defaultProps;const _default=MapBox,__WEBPACK_DEFAULT_EXPORT__=_default;var reactHotLoader,leaveModule;reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(NOOP,"NOOP","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(DEFAULT_MAX_ZOOM,"DEFAULT_MAX_ZOOM","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(DEFAULT_POINT_RADIUS,"DEFAULT_POINT_RADIUS","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(propTypes,"propTypes","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(MapBox,"MapBox","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx"),reactHotLoader.register(_default,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/MapBox.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},644711:(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var prop_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45697),prop_types__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(667294),react_map_gl__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(998601),_utils_geo__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(943892),_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(399782),_utils_luminanceFromRGB__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(515269),_emotion_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(211965),enterModule;module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const propTypes={aggregation:prop_types__WEBPACK_IMPORTED_MODULE_0___default().string,compositeOperation:prop_types__WEBPACK_IMPORTED_MODULE_0___default().string,dotRadius:prop_types__WEBPACK_IMPORTED_MODULE_0___default().number,lngLatAccessor:prop_types__WEBPACK_IMPORTED_MODULE_0___default().func,locations:prop_types__WEBPACK_IMPORTED_MODULE_0___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_0___default().object).isRequired,pointRadiusUnit:prop_types__WEBPACK_IMPORTED_MODULE_0___default().string,renderWhileDragging:prop_types__WEBPACK_IMPORTED_MODULE_0___default().bool,rgb:prop_types__WEBPACK_IMPORTED_MODULE_0___default().arrayOf(prop_types__WEBPACK_IMPORTED_MODULE_0___default().oneOfType([prop_types__WEBPACK_IMPORTED_MODULE_0___default().string,prop_types__WEBPACK_IMPORTED_MODULE_0___default().number])),zoom:prop_types__WEBPACK_IMPORTED_MODULE_0___default().number},defaultProps={compositeOperation:"source-over",dotRadius:4,lngLatAccessor:e=>[e[0],e[1]],renderWhileDragging:!0},computeClusterLabel=(e,_)=>{const r=e.point_count;if(!_)return r;if("sum"===_||"min"===_||"max"===_)return e[_];const{sum:t}=e,o=t/r;if("mean"===_)return Math.round(100*o)/100;const{squaredSum:a}=e,s=a/r-(t/r)**2;return"var"===_?Math.round(100*s)/100:"stdev"===_?Math.round(100*Math.sqrt(s))/100:r};class ScatterPlotGlowOverlay extends react__WEBPACK_IMPORTED_MODULE_1__.PureComponent{constructor(e){super(e),this.redraw=this.redraw.bind(this)}drawText(e,_,r={}){const{fontHeight:t=0,label:o="",radius:a=0,rgb:s=[0,0,0],shadow:l=!1}=r,n=1.8*a,i=(0,_utils_luminanceFromRGB__WEBPACK_IMPORTED_MODULE_3__.ZP)(s[1],s[2],s[3]);e.globalCompositeOperation="source-over",e.fillStyle=i<=110?"white":"black",e.font=`${t}px sans-serif`,e.textAlign="center",e.textBaseline="middle",l&&(e.shadowBlur=15,e.shadowColor=i<=110?"black":"");const p=e.measureText(o).width;if(p>n){const _=t/p;e.font=_*n+"px sans-serif"}const{compositeOperation:u}=this.props;e.fillText(o,_[0],_[1]),e.globalCompositeOperation=u,e.shadowBlur=0,e.shadowColor=""}redraw({width:e,height:_,ctx:r,isDragging:t,project:o}){const{aggregation:a,compositeOperation:s,dotRadius:l,lngLatAccessor:n,locations:i,pointRadiusUnit:p,renderWhileDragging:u,rgb:c,zoom:d}=this.props,E=l,P=[];i.forEach(((e,_)=>{e.properties.cluster&&(P[_]=computeClusterLabel(e.properties,a))}),this);const g=Math.max(...P.filter((e=>!Number.isNaN(e))));r.clearRect(0,0,e,_),r.globalCompositeOperation=s,!u&&t||!i||i.forEach((function(t,a){const s=o(n(t)),l=[(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s[0],1),(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s[1],1)];if(l[0]+E>=0&&l[0]-E<e&&l[1]+E>=0&&l[1]-E<_)if(r.beginPath(),t.properties.cluster){let e=P[a];const _=(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)((e/g)**.5*E,1),t=(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(.5*_,1),[o,s]=l,n=r.createRadialGradient(o,s,_,o,s,0);n.addColorStop(1,`rgba(${c[1]}, ${c[2]}, ${c[3]}, 0.8)`),n.addColorStop(0,`rgba(${c[1]}, ${c[2]}, ${c[3]}, 0)`),r.arc(l[0],l[1],_,0,2*Math.PI),r.fillStyle=n,r.fill(),Number.isFinite(parseFloat(e))&&(e>=1e4?e=`${Math.round(e/1e3)}k`:e>=1e3&&(e=Math.round(e/100)/10+"k"),this.drawText(r,l,{fontHeight:t,label:e,radius:_,rgb:c,shadow:!0}))}else{const e=E/6,_=t.properties.radius,o=t.properties.metric;let a,s=null===_?e:_;if(null!==_){const e=n(t)[1];"Kilometers"===p?(a=`${(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s,2)}km`,s=(0,_utils_geo__WEBPACK_IMPORTED_MODULE_5__.uS)(s,e,d)):"Miles"===p&&(a=`${(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s,2)}mi`,s=(0,_utils_geo__WEBPACK_IMPORTED_MODULE_5__.uS)(s*_utils_geo__WEBPACK_IMPORTED_MODULE_5__.Dq,e,d))}null!==o&&(a=Number.isFinite(parseFloat(o))?(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(o,2):o),s||(s=e),r.arc(l[0],l[1],(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s,1),0,2*Math.PI),r.fillStyle=`rgb(${c[1]}, ${c[2]}, ${c[3]})`,r.fill(),void 0!==a&&this.drawText(r,l,{fontHeight:(0,_utils_roundDecimal__WEBPACK_IMPORTED_MODULE_4__.Z)(s,1),label:a,radius:s,rgb:c,shadow:!1})}}),this)}render(){return(0,_emotion_react__WEBPACK_IMPORTED_MODULE_6__.tZ)(react_map_gl__WEBPACK_IMPORTED_MODULE_2__.s0,{redraw:this.redraw})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}ScatterPlotGlowOverlay.propTypes=propTypes,ScatterPlotGlowOverlay.defaultProps=defaultProps;const _default=ScatterPlotGlowOverlay,__WEBPACK_DEFAULT_EXPORT__=_default;var reactHotLoader,leaveModule;reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(propTypes,"propTypes","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/ScatterPlotGlowOverlay.jsx"),reactHotLoader.register(defaultProps,"defaultProps","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/ScatterPlotGlowOverlay.jsx"),reactHotLoader.register(computeClusterLabel,"computeClusterLabel","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/ScatterPlotGlowOverlay.jsx"),reactHotLoader.register(ScatterPlotGlowOverlay,"ScatterPlotGlowOverlay","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/ScatterPlotGlowOverlay.jsx"),reactHotLoader.register(_default,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/ScatterPlotGlowOverlay.jsx")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)},943892:(e,_,r)=>{r.d(_,{Dq:()=>s,uS:()=>l});var t,o=r(399782);e=r.hmd(e),(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const a=40075.16,s=1.60934;function l(e,_,r){const t=_*(Math.PI/180),s=a*Math.cos(t)/2**(r+9);return(0,o.Z)(e/s,2)}var n,i;(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(n.register(a,"EARTH_CIRCUMFERENCE_KM","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/geo.js"),n.register(s,"MILES_PER_KM","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/geo.js"),n.register(l,"kmToPixels","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/geo.js")),(i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&i(e)},515269:(e,_,r)=>{var t;r.d(_,{ZP:()=>l}),e=r.hmd(e),(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const o=.2126,a=.7152,s=.0722;function l(e,_,r){return o*e+a*_+s*r}var n,i;(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(n.register(o,"LUMINANCE_RED_WEIGHT","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/luminanceFromRGB.js"),n.register(a,"LUMINANCE_GREEN_WEIGHT","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/luminanceFromRGB.js"),n.register(s,"LUMINANCE_BLUE_WEIGHT","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/luminanceFromRGB.js"),n.register(l,"luminanceFromRGB","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/luminanceFromRGB.js")),(i="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&i(e)},399782:(e,_,r)=>{var t,o,a;function s(e,_){let r,t=_;return r=_?Math.round(e*(t=10**t))/t:Math.round(e),r}r.d(_,{Z:()=>s}),e=r.hmd(e),(t="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&t(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature,(o="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&o.register(s,"roundDecimal","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/utils/roundDecimal.js"),(a="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&a(e)},299262:()=>{}}]);