"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7982],{73995:(e,t,a)=>{a.d(t,{Z:()=>y});var n,s=a(667294),o=a(751995),r=a(431069),l=a(455867),c=a(115926),d=a.n(c),i=a(104715),u=a(737921),b=a(558347),m=a(940277),h=a(414114),p=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var f="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const v=o.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .select {\n      width: calc(100% - 30px - ${e.gridUnit}px);\n      flex: 1;\n    }\n\n    & > div {\n      margin-bottom: ${4*e.gridUnit}px;\n    }\n  `}
`,g=o.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-left: ${({theme:e})=>e.gridUnit-2}px;

  .backend {
    overflow: visible;
  }

  .name {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`,S=({backend:e,databaseName:t})=>(0,p.tZ)(g,null,(0,p.tZ)(u.Z,{className:"backend"},e),(0,p.tZ)("span",{className:"name",title:t},t));function y({db:e,formMode:t=!1,getDbList:a,handleError:n,isDatabaseSelectEnabled:o=!0,onDbChange:c,onSchemaChange:u,onSchemasLoad:f,readOnly:g=!1,schema:y,sqlLabMode:L=!1}){const[x,Z]=(0,s.useState)(!1),[w,_]=(0,s.useState)([]),[C,T]=(0,s.useState)(e?{label:(0,p.tZ)(S,{backend:e.backend,databaseName:e.database_name}),value:e.id,...e}:void 0),[P,G]=(0,s.useState)(y?{label:y,value:y}:void 0),[H,k]=(0,s.useState)(0),{addSuccessToast:D}=(0,h.e)(),U=(0,s.useMemo)((()=>async(e,s,o)=>{const c=`/api/v1/database/?q=${d().encode({order_columns:"database_name",order_direction:"asc",page:s,page_size:o,...t||!L?{filters:[{col:"database_name",opr:"ct",value:e}]}:{filters:[{col:"database_name",opr:"ct",value:e},{col:"expose_in_sqllab",opr:"eq",value:!0}]}})}`;return r.Z.get({endpoint:c}).then((({json:e})=>{const{result:t}=e;a&&a(t),0===t.length&&n((0,l.t)("It seems you don't have access to any database"));const s=t.map((e=>({label:(0,p.tZ)(S,{backend:e.backend,databaseName:e.database_name}),value:e.id,id:e.id,database_name:e.database_name,backend:e.backend,allow_multi_schema_metadata_fetch:e.allow_multi_schema_metadata_fetch})));return{data:s,totalCount:s.length}}))}),[t,a,n,L]);function $(e,t){return(0,p.tZ)("div",{className:"section"},(0,p.tZ)("span",{className:"select"},e),(0,p.tZ)("span",{className:"refresh"},t))}return(0,s.useEffect)((()=>{if(C){Z(!0);const e=d().encode({force:H>0}),t=`/api/v1/database/${C.value}/schemas/?q=${e}`;r.Z.get({endpoint:t}).then((({json:e})=>{const t=e.result.map((e=>({value:e,label:e,title:e})));f&&f(t),_(t),Z(!1),H>0&&D("List refreshed")})).catch((()=>{Z(!1),n((0,l.t)("There was an error loading the schemas"))}))}}),[C,f,H]),(0,p.tZ)(v,{"data-test":"DatabaseSelector"},$((0,p.tZ)(i.P,{ariaLabel:(0,l.t)("Select database or type database name"),optionFilterProps:["database_name","value"],"data-test":"select-database",header:(0,p.tZ)(b.lX,null,(0,l.t)("Database")),lazyLoading:!1,onChange:function(e,t){T(t),G(void 0),c&&c(t),u&&u(void 0)},value:C,placeholder:(0,l.t)("Select database or type database name"),disabled:!o||g,options:U}),null),function(){const e=!t&&!g&&(0,p.tZ)(m.Z,{onClick:()=>k(H+1),tooltipContent:(0,l.t)("Force refresh schema list")});return $((0,p.tZ)(i.P,{ariaLabel:(0,l.t)("Select schema or type schema name"),disabled:g,header:(0,p.tZ)(b.lX,null,(0,l.t)("Schema")),labelInValue:!0,lazyLoading:!1,loading:x,name:"select-schema",placeholder:(0,l.t)("Select schema or type schema name"),onChange:e=>function(e){G(e),u&&u(e.value)}(e),options:w,showSearch:!0,value:P}),e)}())}var L,x;f(y,"useState{[loadingSchemas, setLoadingSchemas](false)}\nuseState{[schemaOptions, setSchemaOptions]([])}\nuseState{[currentDb, setCurrentDb](db\n        ? {\n            label: (<SelectLabel backend={db.backend} databaseName={db.database_name}/>),\n            value: db.id,\n            ...db,\n        }\n        : undefined)}\nuseState{[currentSchema, setCurrentSchema](schema ? { label: schema, value: schema } : undefined)}\nuseState{[refresh, setRefresh](0)}\nuseToasts{{ addSuccessToast }}\nuseMemo{loadDatabases}\nuseEffect{}",(()=>[h.e])),(L="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(L.register(v,"DatabaseSelectorWrapper","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),L.register(g,"LabelStyle","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),L.register(S,"SelectLabel","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/DatabaseSelector/index.tsx"),L.register(y,"DatabaseSelector","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/DatabaseSelector/index.tsx")),(x="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&x(e)},940277:(e,t,a)=>{a.d(t,{Z:()=>i});var n,s=a(667294),o=a(358593),r=a(87693),l=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const c=({onClick:e,tooltipContent:t})=>{const a=(0,s.forwardRef)(((e,t)=>(0,l.tZ)(r.Z.Refresh,e)));return(0,l.tZ)(o.u,{title:t},(0,l.tZ)(a,{role:"button",onClick:e,css:e=>({cursor:"pointer",color:e.colors.grayscale.base,"&:hover":{color:e.colors.primary.base}})}))},d=c,i=d;var u,b;(u="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(u.register(c,"RefreshLabel","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/RefreshLabel/index.tsx"),u.register(d,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/RefreshLabel/index.tsx")),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&b(e)},517982:(e,t,a)=>{a.d(t,{Z:()=>Z});var n,s=a(667294),o=a(751995),r=a(431069),l=a(455867),c=a(104715),d=a(558347),i=a(87693),u=a(73995),b=a(940277),m=a(679789),h=a(486057),p=a(414114),f=a(211965);e=a.hmd(e),(n="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&n(e);var v="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e};const g=o.iK.div`
  ${({theme:e})=>`\n    .refresh {\n      display: flex;\n      align-items: center;\n      width: 30px;\n      margin-left: ${e.gridUnit}px;\n      margin-top: ${5*e.gridUnit}px;\n    }\n\n    .section {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n\n    .divider {\n      border-bottom: 1px solid ${e.colors.secondary.light5};\n      margin: 15px 0;\n    }\n\n    .table-length {\n      color: ${e.colors.grayscale.light1};\n    }\n\n    .select {\n      flex: 1;\n    }\n  `}
`,S=o.iK.span`
  align-items: center;
  display: flex;
  white-space: nowrap;

  svg,
  small {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,y=({table:e})=>{const{label:t,type:a,extra:n}=e;return(0,f.tZ)(S,{title:t},"view"===a?(0,f.tZ)(i.Z.Eye,{iconSize:"m"}):(0,f.tZ)(i.Z.Table,{iconSize:"m"}),(null==n?void 0:n.certification)&&(0,f.tZ)(m.Z,{certifiedBy:n.certification.certified_by,details:n.certification.details,size:"l"}),(null==n?void 0:n.warning_markdown)&&(0,f.tZ)(h.Z,{warningMarkdown:n.warning_markdown,size:"l"}),t)},L=({database:e,formMode:t=!1,getDbList:a,handleError:n,isDatabaseSelectEnabled:o=!0,onDbChange:i,onSchemaChange:m,onSchemasLoad:h,onTableChange:v,onTablesLoad:S,readOnly:L=!1,schema:x,sqlLabMode:Z=!0,tableName:w})=>{const[_,C]=(0,s.useState)(e),[T,P]=(0,s.useState)(x),[G,H]=(0,s.useState)(),[k,D]=(0,s.useState)(0),[U,$]=(0,s.useState)(0),[M,j]=(0,s.useState)(!1),[E,N]=(0,s.useState)([]),{addSuccessToast:R}=(0,p.e)();(0,s.useEffect)((()=>{void 0===e&&(C(void 0),P(void 0),H(void 0))}),[e]),(0,s.useEffect)((()=>{if(_&&T){j(!0);const e=encodeURIComponent(T),t=k!==U,a=encodeURI(`/superset/tables/${_.id}/${e}/undefined/${t}/`);U!==k&&$(k),r.Z.get({endpoint:a}).then((({json:e})=>{const a=[];let n;e.options.forEach((e=>{const t={value:e.value,label:(0,f.tZ)(y,{table:e}),text:e.label};a.push(t),e.label===w&&(n=t)})),S&&S(e.options),N(a),H(n),j(!1),t&&R("List updated")})).catch((e=>{j(!1),n((0,l.t)("There was an error loading the tables"))}))}}),[_,T,S,k]);const O=e=>{H(e),v&&T&&v(null==e?void 0:e.value,T)},z=(0,s.useMemo)((()=>(e,t)=>{const a=e.trim().toLowerCase(),{text:n}=t;return n.toLowerCase().includes(a)}),[]);return(0,f.tZ)(g,null,(0,f.tZ)(u.Z,{key:null==_?void 0:_.id,db:_,formMode:t,getDbList:a,handleError:n,onDbChange:L?void 0:e=>{C(e),i&&i(e)},onSchemaChange:L?void 0:e=>{P(e),m&&m(e),O(void 0)},onSchemasLoad:h,schema:T,sqlLabMode:Z,isDatabaseSelectEnabled:o&&!L,readOnly:L}),Z&&!t&&(0,f.tZ)("div",{className:"divider"}),function(){const a=T&&!t&&L||!T&&!(null!=e&&e.allow_multi_schema_metadata_fetch),n=Z?(0,f.tZ)(d.lX,null,(0,l.t)("See table schema")):(0,f.tZ)(d.lX,null,(0,l.t)("Table"));return s=(0,f.tZ)(c.P,{ariaLabel:(0,l.t)("Select table or type table name"),disabled:a,filterOption:z,header:n,labelInValue:!0,lazyLoading:!1,loading:M,name:"select-table",onChange:e=>O(e),options:E,placeholder:(0,l.t)("Select table or type table name"),showSearch:!0,value:G}),o=!t&&!L&&(0,f.tZ)(b.Z,{onClick:()=>D(k+1),tooltipContent:(0,l.t)("Force refresh table list")}),(0,f.tZ)("div",{className:"section"},(0,f.tZ)("span",{className:"select"},s),(0,f.tZ)("span",{className:"refresh"},o));var s,o}())};v(L,"useState{[currentDatabase, setCurrentDatabase](database)}\nuseState{[currentSchema, setCurrentSchema](schema)}\nuseState{[currentTable, setCurrentTable]}\nuseState{[refresh, setRefresh](0)}\nuseState{[previousRefresh, setPreviousRefresh](0)}\nuseState{[loadingTables, setLoadingTables](false)}\nuseState{[tableOptions, setTableOptions]([])}\nuseToasts{{ addSuccessToast }}\nuseEffect{}\nuseEffect{}\nuseMemo{handleFilterOption}",(()=>[p.e]));const x=L,Z=x;var w,_;(w="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(w.register(g,"TableSelectorWrapper","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(S,"TableLabel","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(y,"TableOption","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(L,"TableSelector","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/TableSelector/index.tsx"),w.register(x,"default","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/src/components/TableSelector/index.tsx")),(_="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&_(e)}}]);