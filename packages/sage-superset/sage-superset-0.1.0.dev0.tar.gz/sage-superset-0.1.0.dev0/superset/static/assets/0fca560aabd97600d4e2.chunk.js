"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9973,3148],{301877:(t,e,o)=>{function i(t,e,o,n,s,a){if(!(s-n<=o)){var u=Math.floor((n+s)/2);r(t,e,u,n,s,a%2),i(t,e,o,n,u-1,a+1),i(t,e,o,u+1,s,a+1)}}function r(t,e,o,i,s,a){for(;s>i;){if(s-i>600){var u=s-i+1,h=o-i+1,p=Math.log(u),d=.5*Math.exp(2*p/3),l=.5*Math.sqrt(p*d*(u-d)/u)*(h-u/2<0?-1:1);r(t,e,o,Math.max(i,Math.floor(o-h*d/u+l)),Math.min(s,Math.floor(o+(u-h)*d/u+l)),a)}var c=e[2*o+a],m=i,f=s;for(n(t,e,i,o),e[2*s+a]>c&&n(t,e,i,s);m<f;){for(n(t,e,m,f),m++,f--;e[2*m+a]<c;)m++;for(;e[2*f+a]>c;)f--}e[2*i+a]===c?n(t,e,i,f):n(t,e,++f,s),f<=o&&(i=f+1),o<=f&&(s=f-1)}}function n(t,e,o,i){s(t,o,i),s(e,2*o,2*i),s(e,2*o+1,2*i+1)}function s(t,e,o){var i=t[e];t[e]=t[o],t[o]=i}function a(t,e,o,i){var r=t-o,n=e-i;return r*r+n*n}function u(t,e,o,i,r){return new h(t,e,o,i,r)}function h(t,e,o,r,n){e=e||p,o=o||d,n=n||Array,this.nodeSize=r||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var s=0;s<t.length;s++)this.ids[s]=s,this.coords[2*s]=e(t[s]),this.coords[2*s+1]=o(t[s]);i(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function p(t){return t[0]}function d(t){return t[1]}function l(t){this.options=x(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function c(t,e,o,i,r){return{x:t,y:e,zoom:1/0,id:o,parentId:-1,numPoints:i,properties:r}}function m(t){return{type:"Feature",id:t.id,properties:f(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,o=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(o))/Math.PI-90)]}};var e,o,i}function f(t){var e=t.numPoints,o=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return x(x({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:o})}function g(t){return t/360+.5}function v(t){var e=Math.sin(t*Math.PI/180),o=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return o<0?0:o>1?1:o}function x(t,e){for(var o in e)t[o]=e[o];return t}function M(t){return t.x}function y(t){return t.y}o.r(e),o.d(e,{default:()=>P}),h.prototype={range:function(t,e,o,i){return function(t,e,o,i,r,n,s){for(var a,u,h=[0,t.length-1,0],p=[];h.length;){var d=h.pop(),l=h.pop(),c=h.pop();if(l-c<=s)for(var m=c;m<=l;m++)a=e[2*m],u=e[2*m+1],a>=o&&a<=r&&u>=i&&u<=n&&p.push(t[m]);else{var f=Math.floor((c+l)/2);a=e[2*f],u=e[2*f+1],a>=o&&a<=r&&u>=i&&u<=n&&p.push(t[f]);var g=(d+1)%2;(0===d?o<=a:i<=u)&&(h.push(c),h.push(f-1),h.push(g)),(0===d?r>=a:n>=u)&&(h.push(f+1),h.push(l),h.push(g))}}return p}(this.ids,this.coords,t,e,o,i,this.nodeSize)},within:function(t,e,o){return function(t,e,o,i,r,n){for(var s=[0,t.length-1,0],u=[],h=r*r;s.length;){var p=s.pop(),d=s.pop(),l=s.pop();if(d-l<=n)for(var c=l;c<=d;c++)a(e[2*c],e[2*c+1],o,i)<=h&&u.push(t[c]);else{var m=Math.floor((l+d)/2),f=e[2*m],g=e[2*m+1];a(f,g,o,i)<=h&&u.push(t[m]);var v=(p+1)%2;(0===p?o-r<=f:i-r<=g)&&(s.push(l),s.push(m-1),s.push(v)),(0===p?o+r>=f:i+r>=g)&&(s.push(m+1),s.push(d),s.push(v))}}return u}(this.ids,this.coords,t,e,o,this.nodeSize)}},l.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var o="prepare "+t.length+" points";e&&console.time(o),this.points=t;for(var i,r,n=[],s=0;s<t.length;s++)t[s].geometry&&n.push((i=s,void 0,{x:g((r=t[s].geometry.coordinates)[0]),y:v(r[1]),zoom:1/0,index:i,parentId:-1}));this.trees[this.options.maxZoom+1]=u(n,M,y,this.options.nodeSize,Float32Array),e&&console.timeEnd(o);for(var a=this.options.maxZoom;a>=this.options.minZoom;a--){var h=+Date.now();n=this._cluster(n,a),this.trees[a]=u(n,M,y,this.options.nodeSize,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,n.length,+Date.now()-h)}return e&&console.timeEnd("total time"),this},getClusters:function(t,e){var o=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)o=-180,r=180;else if(o>r){var s=this.getClusters([o,i,180,n],e),a=this.getClusters([-180,i,r,n],e);return s.concat(a)}for(var u=this.trees[this._limitZoom(e)],h=u.range(g(o),v(n),g(r),v(i)),p=[],d=0;d<h.length;d++){var l=u.points[h[d]];p.push(l.numPoints?m(l):this.points[l.index])}return p},getChildren:function(t){var e=t>>5,o=t%32,i="No cluster with the specified id.",r=this.trees[o];if(!r)throw new Error(i);var n=r.points[e];if(!n)throw new Error(i);for(var s=this.options.radius/(this.options.extent*Math.pow(2,o-1)),a=r.within(n.x,n.y,s),u=[],h=0;h<a.length;h++){var p=r.points[a[h]];p.parentId===t&&u.push(p.numPoints?m(p):this.points[p.index])}if(0===u.length)throw new Error(i);return u},getLeaves:function(t,e,o){e=e||10,o=o||0;var i=[];return this._appendLeaves(i,t,e,o,0),i},getTile:function(t,e,o){var i=this.trees[this._limitZoom(t)],r=Math.pow(2,t),n=this.options.extent,s=this.options.radius/n,a=(o-s)/r,u=(o+1+s)/r,h={features:[]};return this._addTileFeatures(i.range((e-s)/r,a,(e+1+s)/r,u),i.points,e,o,r,h),0===e&&this._addTileFeatures(i.range(1-s/r,a,1,u),i.points,r,o,r,h),e===r-1&&this._addTileFeatures(i.range(0,a,s/r,u),i.points,-1,o,r,h),h.features.length?h:null},getClusterExpansionZoom:function(t){for(var e=t%32-1;e<this.options.maxZoom;){var o=this.getChildren(t);if(e++,1!==o.length)break;t=o[0].properties.cluster_id}return e},_appendLeaves:function(t,e,o,i,r){for(var n=this.getChildren(e),s=0;s<n.length;s++){var a=n[s].properties;if(a&&a.cluster?r+a.point_count<=i?r+=a.point_count:r=this._appendLeaves(t,a.cluster_id,o,i,r):r<i?r++:t.push(n[s]),t.length===o)break}return r},_addTileFeatures:function(t,e,o,i,r,n){for(var s=0;s<t.length;s++){var a=e[t[s]],u={type:1,geometry:[[Math.round(this.options.extent*(a.x*r-o)),Math.round(this.options.extent*(a.y*r-i))]],tags:a.numPoints?f(a):this.points[a.index].properties},h=a.numPoints?a.id:this.points[a.index].id;void 0!==h&&(u.id=h),n.features.push(u)}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var o=[],i=this.options.radius/(this.options.extent*Math.pow(2,e)),r=0;r<t.length;r++){var n=t[r];if(!(n.zoom<=e)){n.zoom=e;var s=this.trees[e+1],a=s.within(n.x,n.y,i),u=n.numPoints||1,h=n.x*u,p=n.y*u,d=null;this.options.reduce&&(d=this.options.initial(),this._accumulate(d,n));for(var l=(r<<5)+(e+1),m=0;m<a.length;m++){var f=s.points[a[m]];if(!(f.zoom<=e)){f.zoom=e;var g=f.numPoints||1;h+=f.x*g,p+=f.y*g,u+=g,f.parentId=l,this.options.reduce&&this._accumulate(d,f)}}1===u?o.push(n):(n.parentId=l,o.push(c(h/u,p/u,l,u,d)))}}return o},_accumulate:function(t,e){var o=e.numPoints?e.properties:this.options.map(this.points[e.index].properties);this.options.reduce(t,o)}};var b,_=o(96089);t=o.hmd(t),(b="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0)&&b(t),"undefined"!=typeof reactHotLoaderGlobal&&reactHotLoaderGlobal.default.signature;const w=()=>{};function P(t){const{width:e,height:o,formData:i,hooks:r,queriesData:n}=t,{onError:s=w,setControlValue:a=w}=r,{bounds:u,geoJSON:h,hasCustomMetric:p,mapboxApiKey:d}=n[0].data,{clusteringRadius:c,globalOpacity:m,mapboxColor:f,mapboxStyle:g,pandasAggfunc:v,pointRadius:x,pointRadiusUnit:M,renderWhileDragging:y}=i,b=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(f);if(null===b)return s("Color field must be of form 'rgb(%d, %d, %d)'"),{};const P={maxZoom:_.DEFAULT_MAX_ZOOM,radius:c};p&&(P.initial=()=>({sum:0,squaredSum:0,min:1/0,max:-1/0}),P.map=t=>({sum:t.metric,squaredSum:t.metric**2,min:t.metric,max:t.metric}),P.reduce=(t,e)=>{t.sum+=e.sum,t.squaredSum+=e.squaredSum,t.min=Math.min(t.min,e.min),t.max=Math.max(t.max,e.max)});const z=new l(P);return z.load(h.features),{width:e,height:o,aggregatorName:v,bounds:u,clusterer:z,globalOpacity:m,hasCustomMetric:p,mapboxApiKey:d,mapStyle:g,onViewportChange({latitude:t,longitude:e,zoom:o}){a("viewport_longitude",e),a("viewport_latitude",t),a("viewport_zoom",o)},pointRadius:"Auto"===x?_.DEFAULT_POINT_RADIUS:x,pointRadiusUnit:M,renderWhileDragging:y,rgb:b}}var z,C;(z="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0)&&(z.register(w,"NOOP","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/transformProps.js"),z.register(P,"transformProps","/Users/chenming/PycharmProjects/venv/superset/superset-frontend/plugins/legacy-plugin-chart-map-box/src/transformProps.js")),(C="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0)&&C(t)}}]);