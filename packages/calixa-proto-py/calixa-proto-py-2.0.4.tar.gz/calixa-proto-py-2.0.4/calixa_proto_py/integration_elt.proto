syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

import "entity.proto";
import "common.proto";
import "integration_source.proto";

option java_package = "io.calixa.integration.elt";
option java_multiple_files = true;
option optimize_for = SPEED;

package calixa.integration.elt;

/**
This namespace captures messages/types necessary to perform Loading (the L from the ELT process).
We assume that all Extraction (E from ELT is performed by Airbyte or Census et al).
*/

// Captures domain of possible load types
enum LoadMutationType {
  LOAD_MUTATION_TYPE_UNSPECIFIED = 0;
  LOAD_MUTATION_TYPE_UPSERT = 1;
  LOAD_MUTATION_TYPE_DELETE = 2;
}

// Captures a single JSON update received from Airbyte. This is the
// extract portion of the process.
message ExtractedEntity {
  string organization_id = 1;
  string instance_id = 2;
  string data_warehouse_sync_id = 11;
  calixa.domain.integration.IntegrationSource source = 3;
  google.protobuf.Timestamp emitted_at = 4;
  string extraction_id = 5;
  string namespace = 6;
  string stream = 7;
  string payload = 10;
}

// Once an extracted message is processed, it is represented by this message. This can
// either be an upsert or a delete.
message LoadedEntity {
  calixa.domain.entity.Entity entity = 1; // If mutation_type is DELETE, then entity will be blank
  calixa.domain.common.ExternalId external_id = 2;
  LoadMutationType mutation_type = 3;
  calixa.domain.common.RequestContext request_context = 4;

  reserved 5; // repeated string api_account_external_ids = 5;
}
