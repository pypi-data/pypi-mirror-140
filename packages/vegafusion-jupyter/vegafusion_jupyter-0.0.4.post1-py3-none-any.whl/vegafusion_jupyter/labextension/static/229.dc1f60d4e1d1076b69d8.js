(self.webpackChunkvegafusion_jupyter=self.webpackChunkvegafusion_jupyter||[]).push([[229],{657:(e,n,t)=>{"use strict";t.d(n,{Y:()=>a,o:()=>o});const i=t(147),a=i.version,o=i.name},229:(e,n,t)=>{"use strict";t.r(n),t.d(n,{VegaFusionModel:()=>s,VegaFusionView:()=>r});var i=t(565),a=t(657);t(204),t(926);const o={CLICK_TO_VIEW_ACTIONS:"Click to view actions",PNG_ACTION:"Save as PNG",SVG_ACTION:"Save as SVG"};class s extends i.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:s.model_name,_model_module:s.model_module,_model_module_version:s.model_module_version,_view_name:s.view_name,_view_module:s.view_module,_view_module_version:s.view_module_version,spec:null,full_vega_spec:null,client_vega_spec:null,server_vega_spec:null,vegafusion_handle:null,verbose:null,debounce_wait:30,debounce_max_wait:60})}}s.serializers=Object.assign({},i.DOMWidgetModel.serializers),s.model_name="VegaFusionModel",s.model_module=a.o,s.model_module_version=a.Y,s.view_name="VegaFusionView",s.view_module=a.o,s.view_module_version=a.Y;class r extends i.DOMWidgetView{constructor(){super(...arguments),this.viewElement=document.createElement("div"),this.containerElement=document.createElement("div")}generate_menu(){const e=document.createElement("details");e.title=o.CLICK_TO_VIEW_ACTIONS;const n=document.createElement("summary");n.innerHTML='<svg version="1.1" viewBox="0.0 0.0 946.4776902887139 673.4829396325459" fill="none" stroke="none" stroke-linecap="square" stroke-miterlimit="10" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg"><clipPath id="p.0"><path d="m0 0l946.47766 0l0 673.4829l-946.47766 0l0 -673.4829z" clip-rule="nonzero"/></clipPath><g clip-path="url(#p.0)"><path fill="#000000" fill-opacity="0.0" d="m0 0l946.47766 0l0 673.4829l-946.47766 0z" fill-rule="evenodd"/><path fill="#434a56" d="m241.20998 355.4672l228.50392 0l0 318.04727l-228.50392 0z" fill-rule="evenodd"/><path fill="#434a56" d="m601.9989 0l-65.49762 177.0l343.29565 0.9973755l65.87903 -177.99738z" fill-rule="evenodd"/><path fill="#434a56" d="m505.0006 317.5013l-42.4993 177.0l302.89688 0.15222168l64.59503 -177.88187z" fill-rule="evenodd"/><path fill="#434a56" d="m0.46194226 -0.04330709l240.56693 673.5696l127.509186 -285.16272l-140.021 -388.40683z" fill-rule="evenodd"/><path fill="#434a56" d="m712.8845 -0.01968504l-242.1799 673.54333l-229.69412 0l242.1799 -673.54333z" fill-rule="evenodd"/></g></svg>',e.append(n),document.addEventListener("click",(n=>{e.contains(n.target)||e.removeAttribute("open")}));const t=document.createElement("div");e.append(t),t.classList.add("vegafusion-actions");for(const e of["svg","png"]){let n=1;const i=o[`${e.toUpperCase()}_ACTION`],a=document.createElement("a");a.text=i,a.href="#",a.target="_blank",a.download=`visualization.${e}`,a.title="";let s=this;a.addEventListener("mousedown",(async function(t){t.preventDefault(),s.vegafusion_handle&&(this.href=await s.vegafusion_handle.to_image_url(e,n))})),t.append(a)}t.append(document.createElement("hr"));const i=document.createElement("a");i.text="About VegaFusion",i.href="",i.target="_blank",i.title="",t.append(i);const a=document.createElement("a");return a.text="AGPL License",a.href="https://www.gnu.org/licenses/agpl-3.0.en.html",a.target="_blank",a.title="",t.append(a),e}async render(){const{render_vegafusion:e}=await t.e(432).then(t.t.bind(t,432,23));this.render_vegafusion=e;const{compile:n}=await t.e(453).then(t.t.bind(t,453,23));this.vegalite_compile=n;let i=this.generate_menu();this.containerElement.appendChild(this.viewElement),this.containerElement.classList.add("chart-wrapper"),this.el.appendChild(this.containerElement),this.el.appendChild(i),this.el.classList.add("vegafusion-embed"),this.el.classList.add("has-actions"),this.value_changed(),this.model.on("change:spec",this.value_changed,this),this.model.on("change:verbose",this.value_changed,this),this.model.on("change:debounce_wait",this.value_changed,this),this.model.on("change:debounce_max_wait",this.value_changed,this),this.model.on("msg:custom",((e,n)=>{this.model.get("verbose")&&console.log("VegaFusion(js): Received response");let t=new Uint8Array(n[0].buffer);this.vegafusion_handle.receive(t)}))}value_changed(){let e=this.model.get("spec");if(null!==e){let n,t=JSON.parse(e);if(t.$schema.endsWith("schema/vega/v5.json"))n=e;else{let e=this.vegalite_compile(t);n=JSON.stringify(e.spec)}this.vegafusion_handle=this.render_vegafusion(this.viewElement,n,this.model.get("verbose")||!1,this.model.get("debounce_wait")||30,this.model.get("debounce_max_wait"),(e=>{this.model.get("verbose")&&console.log("VegaFusion(js): Send request"),this.send({type:"request"},[e])})),this.model.set("full_vega_spec",n),this.model.set("client_vega_spec",this.vegafusion_handle.client_spec_json()),this.model.set("server_vega_spec",this.vegafusion_handle.server_spec_json()),this.model.set("comm_plan",this.vegafusion_handle.comm_plan_json()),this.touch()}}}},949:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>r});var i=t(81),a=t.n(i),o=t(645),s=t.n(o)()(a());s.push([e.id,'.vegafusion-embed {\n  min-height: 40px;\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n  overflow: visible;\n}\n.vegafusion-embed.has-actions {\n  padding-right: 38px;\n}\n.vegafusion-embed details:not([open]) > :not(summary) {\n  display: none !important;\n}\n.vegafusion-embed summary {\n  list-style: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  opacity: 0.2;\n  transition: opacity 0.4s ease-in;\n  outline: none;\n  cursor: pointer;\n  line-height: 0px;\n}\n.vegafusion-embed summary::-webkit-details-marker {\n  display: none;\n}\n.vegafusion-embed summary:active {\n  box-shadow: #aaa 0px 0px 0px 1px inset;\n}\n.vegafusion-embed summary svg {\n  width: 16px;\n  height: 16px;\n}\n.vegafusion-embed details[open] summary {\n  opacity: 0.5;\n}\n.vegafusion-embed:hover summary, .vegafusion-embed:focus summary {\n  opacity: 0.7 !important;\n  transition: opacity 0.2s ease;\n}\n.vegafusion-embed .vegafusion-actions {\n  position: absolute;\n  z-index: 1001;\n  top: 35px;\n  right: -9px;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n  animation-duration: 0.15s;\n  animation-name: scale-in;\n  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n  text-align: left;\n}\n.vegafusion-embed .vegafusion-actions hr {\n  width: auto;\n  height: 1px;\n  border: none;\n  background-color: #434a56;\n  margin: 4px 10px 4px 10px;\n  opacity: 50%;\n}\n.vegafusion-embed .vegafusion-actions a {\n  padding: 4px 16px;\n  font-family: sans-serif;\n  font-size: 12px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n.vegafusion-embed .vegafusion-actions a:hover {\n  background-color: #f7f7f9;\n  color: black;\n}\n.vegafusion-embed .vegafusion-actions::before, .vegafusion-embed .vegafusion-actions::after {\n  content: "";\n  display: inline-block;\n  position: absolute;\n  pointer-events: none;\n}\n.vegafusion-embed .vegafusion-actions::before {\n  left: auto;\n  right: 14px;\n  top: -16px;\n  border: 8px solid #0000;\n  border-bottom-color: #d9d9d9;\n}\n.vegafusion-embed .vegafusion-actions::after {\n  left: auto;\n  right: 15px;\n  top: -14px;\n  border: 7px solid #0000;\n  border-bottom-color: #fff;\n}\n.vegafusion-embed .chart-wrapper.fit-x {\n  width: 100%;\n}\n.vegafusion-embed .chart-wrapper.fit-y {\n  height: 100%;\n}\n\n.vegafusion-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px;\n}\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n',""]);const r=s},889:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>r});var i=t(81),a=t.n(i),o=t(645),s=t.n(o)()(a());s.push([e.id,".vegafusion-loading {\n  color: red;\n  background: aqua;\n}\n.vegafusion-loading .inner {\n  width: 100px;\n}\n",""]);const r=s},645:e=>{"use strict";e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",i=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),i&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),i&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,i,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);i&&s[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),n.push(c))}},n}},81:e=>{"use strict";e.exports=function(e){return e[1]}},926:(e,n,t)=>{var i=t(379),a=t(949);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.id,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},204:(e,n,t)=>{var i=t(379),a=t(889);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.id,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},379:(e,n,t)=>{"use strict";var i,a=function(){var e={};return function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}e[n]=t}return e[n]}}(),o=[];function s(e){for(var n=-1,t=0;t<o.length;t++)if(o[t].identifier===e){n=t;break}return n}function r(e,n){for(var t={},i=[],a=0;a<e.length;a++){var r=e[a],l=n.base?r[0]+n.base:r[0],d=t[l]||0,c="".concat(l," ").concat(d);t[l]=d+1;var u=s(c),p={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(o[u].references++,o[u].updater(p)):o.push({identifier:c,updater:g(p,n),references:1}),i.push(c)}return i}function l(e){var n=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var o=t.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(e){n.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(n);else{var s=a(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}return n}var d,c=(d=[],function(e,n){return d[e]=n,d.filter(Boolean).join("\n")});function u(e,n,t,i){var a=t?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=c(n,a);else{var o=document.createTextNode(a),s=e.childNodes;s[n]&&e.removeChild(s[n]),s.length?e.insertBefore(o,s[n]):e.appendChild(o)}}function p(e,n,t){var i=t.css,a=t.media,o=t.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var m=null,f=0;function g(e,n){var t,i,a;if(n.singleton){var o=f++;t=m||(m=l(n)),i=u.bind(null,t,o,!1),a=u.bind(null,t,o,!0)}else t=l(n),i=p.bind(null,t,n),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)};return i(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;i(e=n)}else a()}}e.exports=function(e,n){(n=n||{}).singleton||"boolean"==typeof n.singleton||(n.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var t=r(e=e||[],n);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<t.length;i++){var a=s(t[i]);o[a].references--}for(var l=r(e,n),d=0;d<t.length;d++){var c=s(t[d]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}t=l}}}},147:e=>{"use strict";e.exports=JSON.parse('{"name":"vegafusion-jupyter","version":"0.1.0","description":"Altair Jupyter Widget library that relies on VegaFusion for serverside calculations","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css","css/*.scss","images/*.svg"],"homepage":"https://github.com/jonmmease/vegafusion","bugs":{"url":"https://github.com/jonmmease/vegafusion/issues"},"license":"BSD-3-Clause","author":{"name":"Jon Mease","email":"jonmmease@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/jonmmease/vegafusion"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc && sass scss:css","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf vegafusion_jupyter/labextension","clean:nbextension":"rimraf vegafusion_jupyter/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.0 || ^3.0.0 || ^4.0.0","@jupyterlab/notebook":"^3.0.0 || ^4.0.0","vega":"5.21.0","vega-lite":"^4.17.0","vega-tooltip":"^0.27.0","vegafusion-wasm":"../../vegafusion-wasm/pkg"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"6.5.1","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","sass":"^1.45.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","svg-inline-loader":"^0.8.2","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.65.0","webpack-cli":"^4.9.1","webpack-require-from":"^1.8.6"},"jupyterlab":{"extension":"lib/plugin","outputDir":"vegafusion_jupyter/labextension/","webpackConfig":"webpack.config.experimental.js","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);