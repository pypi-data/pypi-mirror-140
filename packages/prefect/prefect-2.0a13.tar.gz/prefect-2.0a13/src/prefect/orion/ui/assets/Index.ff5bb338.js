import{e as G,k as N,f as n,l as q,an as ie,o as i,h as V,H as ce,ay as X,r as I,c as d,d as t,a as r,w as c,g as s,ax as _e,ai as Y,az as Z,aA as de,i as x,I as h,aB as pe,aC as fe,aD as me,aE as ve,u as ye,av as he,ao as ge,au as we,t as g,a6 as be,aF as ke,F as xe}from"./vendor.e30a69e6.js";import{R as Re,M as $e}from"./Radar.497f0088.js";import{A as R,E as $,s as ee,S as Fe,f as te}from"./index.e1930792.js";import{T as Ie}from"./Timeline.5273a3b1.js";const Le=G({props:{id:{type:String,required:!0}},setup(L){const w=L,b=N(new Re),m=n(()=>({id:w.id})),v={radar:R.query({endpoint:$.radar,body:m,options:{pollInterval:5e3}})};return q(()=>{var l;return(l=v.radar.response)==null?void 0:l.value},l=>{l&&b.value.items(l)}),ie(()=>{b.value.id("id").dependencies("upstream_dependencies").items([])}),(l,B)=>(i(),V($e,{id:L.id,radar:b.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const Se={class:"flow-run-logs-tabs-content"},Te={class:"flow-run-logs-tabs-content__header"},Ce=h(" Copy Logs "),Ne={class:"flow-run-logs-tab-content__table"},qe=pe('<div class="flow-run-logs-tab-content__table-header"><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"> Level </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"> Time </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"> Message </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"> Run name </span></div>',1),Be={class:"flow-run_logs-tab-content__empty"},De=h(" No logs to show. "),Ee=h(" Try clearing your filter "),je={key:0,class:"flow-run-logs-tabs-content__loading"},Ve=G({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(L){const w=L,b=N(),m=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],v=N(0),l=n(()=>({logs:{flow_run_id:{any_:[w.flowRunId]},level:{ge_:v.value}}})),B={interval:w.running?5e3:void 0},p=ce(X.getLogs.bind(X),[l],B),D=n(()=>{var o;return(o=p.response.value)!=null?o:[]}),S=n(()=>{var o;return(o=p.loading.value)!=null?o:!0}),T=()=>{v.value=0},A=()=>{if(!b.value)return;const o=b.value,k=o.scrollTop>0,F=o.scrollTop+o.offsetHeight===o.scrollHeight;k&&F&&fe(()=>{o.scrollTop=o.scrollHeight})},H=()=>D.value.map(o=>{const k=me(o.level),F=ve(o.timestamp);return`${k}	${F}	${o.message}`}).join(`
`);return q(()=>w.running,()=>p.unsubscribe()),q(()=>p.response.value,()=>A()),(o,k)=>{const F=I("m-select"),a=I("m-button"),E=I("m-loader");return i(),d("div",Se,[t("div",Te,[r(F,{modelValue:v.value,"onUpdate:modelValue":k[0]||(k[0]=y=>v.value=y),options:m,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"]),r(s(_e),{text:"",value:H,class:"flow-run-logs__copy",toast:"Logs copied to clipboard"},{default:c(()=>[Ce]),_:1})]),t("div",Ne,[qe,t("div",{ref:(y,j)=>{j.logsRef=y,b.value=y},class:"flow-run-logs-tab-content__logs"},[r(s(de),{logs:s(D)},{empty:c(()=>[t("p",Be,[De,Y(r(a,{class:"ml-2",onClick:T},{default:c(()=>[Ee]),_:1},512),[[Z,v.value]])])]),_:1},8,["logs"]),L.running||s(S)?(i(),d("div",je,[r(E,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),Y(t("span",null,"Run in progress...",512),[[Z,L.running]])])):x("",!0)],512)])])}}});const Ae={class:"main-grid"},He={class:"d-flex align-center justify-space-between py-1 px-2"},Me={class:"d-inline-flex flex-column"},Pe={class:"flex-grow-0 flex-shrink-1"},Ue={class:"d-inline-flex align-center text-truncate"},Ge={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},We={key:0},ze=h(" Started: "),Oe={class:"text--grey-80 mr-1 ml--half"},Je={key:1},Ke=h(" Ended: "),Qe={class:"text--grey-80 mr-1 ml--half"},Xe={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},Ye={key:0},Ze=h(" Deployment: "),et={class:"text--grey-80 mr-1 ml--half"},tt={key:1},st=h(" Parent: "),nt={class:"text--grey-80"},ot=h(" /"),at={key:2},lt=h(" Results: "),rt={class:"text--grey-80 mr-1 ml--half"},ut={key:3},it=h(" Flow version: "),ct={class:"text--grey-80 mr-1 ml--half"},_t={class:"font--secondary"},dt={class:"d-flex align-center justify-space-between py-1 px-2"},pt=t("div",{class:"subheader"}," Timeline ",-1),ft={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},mt={class:"d-flex align-center justify-space-between py-1 px-2"},vt=t("div",{class:"subheader"}," Radar ",-1),yt={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},ht={key:0,class:"flow-run__tab-badge caption"},gt={class:"font--secondary caption my-2",style:{"min-height":"17px"}},wt={key:0},bt={class:"results-section"},kt={key:1,class:"text-center my-8"},xt=t("h2",null,"No results found",-1),Rt=[xt],$t={class:"results-section"},Ft={key:1,class:"text-center my-8"},It=t("h2",null,"No results found",-1),Lt=[It],St={class:"flow-run__tab-content"},Tt=t("hr",{class:"results-hr mt-3"},null,-1),Dt=G({async setup(L){let w,b;const m=ye(),v=N("logs"),l=N(m==null?void 0:m.params.id),B=n(()=>({id:l.value})),p=([w,b]=he(()=>R.query({endpoint:$.flow_run,body:B,options:{pollInterval:5e3}}).fetch()),w=await w,b(),w),D=n(()=>p.response.value.flow_id),S=n(()=>p.response.value.parent_task_run_id),T=n(()=>p.response.value.deployment_id),A=n(()=>({id:D.value})),H=n(()=>({id:T.value})),o=n(()=>({task_runs:{id:{any_:[S.value]}}})),k=n(()=>({flow_runs:{id:{any_:[l.value]}}})),F=n(()=>({flow_runs:{id:{any_:[l.value]}},task_runs:{subflow_runs:{exists_:!0}}})),a={flow:R.query({endpoint:$.flow,body:A}),deployment:R.query({endpoint:$.deployment,body:H,options:{paused:!T.value}}),parent_flow:R.query({endpoint:$.flows,body:o,options:{paused:!S.value}}),parent_flow_run:R.query({endpoint:$.flow_runs,body:o,options:{paused:!S.value}}),task_runs_count:R.query({endpoint:$.task_runs_count,body:k,options:{pollInterval:1e4}}),task_runs:R.query({endpoint:$.task_runs,body:k,options:{pollInterval:1e4}}),sub_flow_runs_count:R.query({endpoint:$.task_runs_count,body:F,options:{pollInterval:1e4}})};function E(e){return typeof j.value[e]=="number"}const y=e=>{var u;return(u=j.value[e])!=null?u:0},j=n(()=>{var e,u;return{task_runs:(e=a.task_runs_count.response)==null?void 0:e.value,sub_flow_runs:(u=a.sub_flow_runs_count.response)==null?void 0:u.value,logs:void 0}}),M=n(()=>{var e;return((e=a.deployment.response)==null?void 0:e.value)||{}}),W=n(()=>{var e,u;return((u=(e=a.parent_flow.response)==null?void 0:e.value)==null?void 0:u[0])||{}}),z=n(()=>{var e,u;return((u=(e=a.parent_flow_run.response)==null?void 0:e.value)==null?void 0:u[0])||{}}),O=n(()=>{var e,u;return(u=(e=M.value)==null?void 0:e.flow_data)==null?void 0:u.blob}),f=n(()=>{var e;return((e=p.response)==null?void 0:e.value)||{}}),se=n(()=>f.value.end_time),C=n(()=>{var e;return(e=f.value)==null?void 0:e.state}),ne=n(()=>C.value.type=="RUNNING"),oe=n(()=>{var e;return((e=f.value)==null?void 0:e.tags)||[]});n(()=>{var e;return((e=a.task_runs_count.response)==null?void 0:e.value)||0}),n(()=>{var e;return((e=a.sub_flow_runs_count.response)==null?void 0:e.value)||0});const J=n(()=>{var e;return((e=a.task_runs.response)==null?void 0:e.value)||[]}),ae=[{title:"Task Runs",key:"task_runs",icon:"pi-task"},{title:"Subflow Runs",key:"sub_flow_runs",icon:"pi-flow-run"},{title:"Logs",key:"logs",icon:"pi-logs-fill"}],le=n(()=>C.value.type=="PENDING"||C.value.type=="SCHEDULED"?"--":f.value.total_run_time?ee(f.value.total_run_time):ee(f.value.estimated_run_time));ge(()=>{p.stopPolling(),R.queries.delete(p.id)});const re=q(m,()=>{l.value=m==null?void 0:m.params.id});return we(()=>{re()}),q(l,async()=>{!l.value||(await p.fetch(),a.flow.fetch(),a.task_runs_count.fetch(),a.task_runs.fetch(),a.sub_flow_runs_count.fetch(),T.value?a.deployment.fetch():a.deployment.clearResult(),S.value?a.parent_flow.fetch():a.parent_flow.clearResult(),S.value?a.parent_flow_run.fetch():a.parent_flow_run.clearResult(),v.value="task_runs")}),(e,u)=>{const ue=I("m-tags"),P=I("router-link"),U=I("m-card"),K=I("m-icon-button"),Q=I("ResultsList");return i(),d(xe,null,[t("div",Ae,[r(U,{class:"details",shadow:"sm"},{default:c(()=>[t("div",He,[t("div",Me,[t("div",Pe,[t("span",Ue,[r(Fe,{name:s(C).name,type:s(C).type,class:"mr-1"},null,8,["name","type"]),r(ue,{tags:s(oe),class:"mr-1 caption"},null,8,["tags"]),t("div",Ge,[s(f).start_time?(i(),d("span",We,[ze,t("span",Oe,g(s(te)(s(f).start_time)),1)])):x("",!0),s(f).end_time?(i(),d("span",Je,[Ke,t("span",Qe,g(s(te)(s(f).end_time)),1)])):x("",!0)])])]),t("div",Xe,[s(M).name?(i(),d("span",Ye,[Ze,t("span",et,g(s(M).name),1)])):x("",!0),s(W).name?(i(),d("span",tt,[st,t("span",nt,g(s(W).name),1),ot,r(P,{to:`/flow-run/${s(z).id}`,class:"mr-1 ml--half text--primary"},{default:c(()=>[h(g(s(z).name),1)]),_:1},8,["to"])])):x("",!0),s(O)?(i(),d("span",at,[lt,t("span",rt,g(s(O)),1)])):x("",!0),s(f).flow_version?(i(),d("span",ut,[it,t("span",ct,g(s(f).flow_version),1)])):x("",!0)])]),t("div",_t,g(s(le)),1)])]),_:1}),r(U,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:c(()=>[t("div",dt,[pt,r(P,{to:`/flow-run/${l.value}/timeline`},{default:c(()=>[r(K,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",ft,[s(J).length?(i(),V(Ie,{key:0,items:s(J),"max-end-time":s(se),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):x("",!0)])]),_:1}),r(U,{class:"radar",shadow:"sm"},{header:c(()=>[t("div",mt,[vt,r(P,{to:`/flow-run/${l.value}/radar`},{default:c(()=>[r(K,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[t("div",yt,[r(Le,{id:l.value},null,8,["id"])])]),_:1})]),r(s(ke),{value:v.value,"onUpdate:value":u[0]||(u[0]=_=>v.value=_),tabs:ae,class:"mt-3"},{"after-tab":c(({tab:_})=>[E(_.key)?(i(),d("span",ht,g(y(_.key).toLocaleString()),1)):x("",!0)]),"before-tab-content":c(({selectedTab:_})=>[t("div",gt,[E(_.key)&&y(_.key)>0?(i(),d("span",wt,g(y(_.key).toLocaleString())+" "+g(s(be)("Result",y(_.key))),1)):x("",!0)])]),task_runs:c(({tab:_})=>[t("section",bt,[y(_.key)>0?(i(),V(Q,{key:"task_runs",filter:s(k),component:"ListItemTaskRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(i(),d("div",kt,Rt))])]),sub_flow_runs:c(({tab:_})=>[t("section",$t,[y(_.key)>0?(i(),V(Q,{key:"sub_flow_runs",filter:s(F),component:"ListItemSubFlowRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(i(),d("div",Ft,Lt))])]),logs:c(()=>[t("section",St,[r(Ve,{"flow-run-id":l.value,running:s(ne)},null,8,["flow-run-id","running"])])]),_:1},8,["value"]),Tt],64)}}});export{Dt as default};
