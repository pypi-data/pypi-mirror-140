$def with (posts)
$var classes = "h-feed"

$for post in posts:
    <div class=h-entry>
    $if "content" in post:
        $if "name" in post:
            <big><strong class=p-name>$post["name"][0]</strong></big><br>
            $ content = post["content"][0]
            <p class=p-summary>
            $if isinstance(content, str):
                $content.strip().partition("\n\n")[0]
            $else:
                $content
            &hellip;</p>
        $else:
            <p class=p-content>$post["content"][0]</p>
    $elif "like-of" in post:
        <p><small>Liked</small> <a
        href=$post["like-of"][0]>$post["like-of"][0]</a></p>
    $elif "bookmark-of" in post:
        <p><small>Bookmarked</small> <a
        href=$post["bookmark-of"][0]>$post["bookmark-of"][0]</a></p>
    <p style=text-align:right><small><a class=u-url href=$post["url"][0]><time \
    datetime=$post["published"][0].isoformat() \
    class=dt-published>$post["published"][0].diff_for_humans()</time></a></small></p>
    </div>

$def head():
    <style>
    /* body {
        display: grid;
        grid-template-columns: 61.8% 38.2%;
        margin: 2em auto;
        width: 50em; } */
    /* header {
        grid-column: 2;
        grid-row: 1; }
    h1 {
        margin-top: 0; }
    article {
        grid-column: 1;
        grid-row: 1; }
    article > p:first-child {
        font-size: 2em;
        margin-top: 0; }
    ul.elsewhere {
        list-style: none;
        padding-left: 1em; }
    li a {
        display: grid;
        grid-column-gap: .2em;
        grid-template-columns: 1em auto;
        margin: .2em;
        padding: .2em; }
    li a span {
        font-size: .8em; } */
    </style>
    <script src=/static/understory.js crossorigin=anonymous></script>
    <script>
    const { MicropubClient } = understory
    const pub = new MicropubClient('/pub')
    document.addEventListener('DOMContentLoaded', () => {
      // XXX document.querySelectorAll('form').forEach(el => {
      // XXX   el.style.display = 'none'
      // XXX })
      const name = document.querySelector('h1')
      name.addEventListener('keypress', ev => {
        if (ev.which === 13) {
          ev.preventDefault()
          name.contentEditable = false
          name.blur()
          pub.update('/', 'replace', 'name', [name.innerText]).then(permalink => {
            console.log("UPDATED!!!!")
          })
        }
      })
      name.addEventListener('click', () => {
        name.contentEditable = true
        name.focus()
      })
    })
    </script>
$var head = head
