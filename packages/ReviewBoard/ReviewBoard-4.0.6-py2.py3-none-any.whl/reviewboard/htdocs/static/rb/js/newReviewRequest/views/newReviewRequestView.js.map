{"version":3,"sources":["newReviewRequestView.es6.js"],"names":[],"mappings":"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","file":"newReviewRequestView.js","sourcesContent":["(function() {\n\n\n/**\n * A simple model for creating file-attachment only review requests.\n *\n * Model Attributes:\n *     repository (RB.Repository):\n *         The associated repository (always ``null``).\n */\nconst FilesOnlyPreCommitModel = Backbone.Model.extend({\n    defaults: _.defaults({\n        repository: null,\n    }),\n});\n\n\n/**\n * A simple view for creating file-attachment only review requests.\n */\nconst FilesOnlyPreCommitView = Backbone.View.extend({\n    className: 'files-only',\n\n    template: _.template(dedent`\n        <p><%- description %></p>\n        <input type=\"submit\" class=\"primary large\" id=\"files-only-create\"\n               value=\"<%- buttonText %>\" />\n    `),\n\n    events: {\n        'click #files-only-create': '_onCreateClicked',\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     FilesOnlyPreCommitView:\n     *     This object, for chaining.\n     */\n    render() {\n        this.$el.html(this.template({\n            description: gettext('You won\\'t be able to add any diffs to this review request. The review request will only be usable for reviewing graphics, screenshots and file attachments.'),\n            buttonText: gettext('Create Review Request'),\n        }));\n\n        return this;\n    },\n\n    /**\n     * Callback for when the \"Create Review Request\" button is clicked.\n     *\n     * Creates a review request with the given localSitePrefix and nothing else,\n     * and redirects the browser to it.\n     *\n     * Args:\n     *     ev (Event):\n     *         The click event.\n     */\n    _onCreateClicked(ev) {\n        ev.preventDefault();\n        ev.stopPropagation();\n\n        const repository = this.model.get('repository');\n        const reviewRequest = new RB.ReviewRequest({\n            localSitePrefix: repository.get('localSitePrefix')\n        });\n\n        reviewRequest.save({\n            success: () => {\n                window.location = reviewRequest.get('reviewURL');\n            },\n            error: () => {\n                // TODO: handle errors\n            },\n        });\n    },\n});\n\n\n/**\n * The view for creating new review requests.\n *\n * This orchestrates several other objects to guide users through creating file\n * attachment only, pre-commit, or post-commit review requests.\n */\nRB.NewReviewRequestView = RB.PageView.extend({\n    el: '#new-review-request',\n\n    template: _.template(dedent`\n        <div class=\"rb-c-new-review-request\">\n         <div class=\"rb-c-sidebar -no-icons\"></div>\n         <div class=\"rb-c-new-review-request__repo-pane\">\n          <a href=\"#\" class=\"rb-c-new-review-request__show-repositories\">\n           <span class=\"fa fa-chevron-left\"></span>\n           <%- repositoriesLabel %>\n          </a>\n          <div class=\"rb-c-new-review-request__repo-detail\">\n           <div class=\"rb-c-new-review-request__main\">\n            <div class=\"rb-c-new-review-request__hint\"><%- hint %></div>\n           </div>\n          </div>\n         </div>\n        </div>\n    `),\n\n    events: {\n        'click .rb-c-new-review-request__show-repositories':\n            '_onShowRepositoriesClicked',\n    },\n\n    /**\n     * Render the page.\n     */\n    renderPage() {\n        /* Build the main UI for the page. */\n        this.$pageContent.html(this.template({\n            hint: gettext('Select a repository'),\n            repositoriesLabel: gettext('Repositories'),\n        }));\n\n        this._$newReviewRequestContainer = this.$pageContent.find(\n            '.rb-c-new-review-request');\n        this._$repoPane = this.$pageContent.find(\n            '.rb-c-new-review-request__repo-pane');\n        this._$repoDetailContainer = this._$repoPane.find(\n            '.rb-c-new-review-request__repo-detail');\n        this._$repoSelectorContainer = this._$newReviewRequestContainer.find(\n            '.rb-c-sidebar');\n        this._$content = this._$repoDetailContainer.find(\n            '.rb-c-new-review-request__main');\n        this._$hint = this._$repoDetailContainer.find(\n            '.rb-c-new-review-request__hint');\n\n        /*\n         * Add the repository selector. This will live either in the page's\n         * sidebar (in desktop mode) or in the page's container (in mobile\n         * mode).\n         */\n        this._repositorySelectionView = new RB.RepositorySelectionView({\n            collection: this.model.get('repositories'),\n        });\n        this._repositorySelectionView.render();\n\n        this.listenTo(this._repositorySelectionView,\n                      'selected',\n                      repository => this.model.set('repository', repository));\n        this.listenTo(this.model, 'change:repository',\n                      this._onRepositoryChanged);\n\n        if (this._preCommitView) {\n            this._$hint.hide();\n            this._$content.append(this._preCommitView.render().el);\n        }\n        if (this._postCommitView) {\n            this._$hint.hide();\n            this._$content.append(this._postCommitView.render().el);\n        }\n\n        /*\n         * If the only two options are the \"None - File attachments only\"\n         * pseudo-repository and one real one, pre-select the real one to speed\n         * up the 80% case. Otherwise, we'll leave it at the \"Select a\n         * repository\" screen.\n         */\n        const repositories = this.model.get('repositories').models;\n\n        if (repositories.length === 2) {\n            repositories[1].trigger('selected', repositories[1]);\n        }\n\n        return this;\n    },\n\n    /**\n     * Handle mobile mode changes.\n     *\n     * This will update the parent of the repository selector. In desktop\n     * mode, it will be placed in the sidebar. In mobile mode, it will be\n     * placed in a container in this view, with its display managed by CSS.\n     *\n     * Args:\n     *     inMobileMode (bool):\n     *         Whether the UI is now in mobile mode.\n     */\n    onMobileModeChanged(inMobileMode) {\n        this._repositorySelectionView.$el\n            .detach()\n            .appendTo(inMobileMode\n                      ? this._$repoSelectorContainer\n                      : this.$mainSidebar);\n    },\n\n    /**\n     * Callback for when the current repository has changed.\n     *\n     * If the \"Files Only\" entry is selected, this shows the special\n     * FilesOnlyPreCommitView in the right-hand pane.\n     *\n     * If a repository that supports fetching committed revisions is selected,\n     * this will show both the pre-commit and post-commit UIs stacked\n     * vertically. If the repository only supports pre-commit, only the\n     * pre-commit UI is shown.\n     */\n    _onRepositoryChanged() {\n        const repository = this.model.get('repository');\n\n        if (repository === null) {\n            /*\n             * A repository is no longer selected. The user either chose\n             * the File Attachments Only entry or hit the \"< Repositories\"\n             * link on mobile.\n             *\n             * If on mobile, we're going to add a small delay (slightly longer\n             * than the animation time) before removing any views, so that\n             * they don't disappear during animation.\n             */\n            this._$newReviewRequestContainer\n                .removeClass('js-repository-selected');\n\n            if (this.inMobileMode) {\n                _.delay(this._removeCommitViews.bind(this), 400);\n            } else {\n                this._removeCommitViews();\n            }\n        } else {\n            /*\n             * The user has selected a repository. Begin placing new views\n             * based on the repository's capabilities.\n             */\n            this._$newReviewRequestContainer\n                .addClass('js-repository-selected');\n\n            this._removeCommitViews();\n\n            if (repository.get('filesOnly')) {\n                this._preCommitView = new FilesOnlyPreCommitView({\n                    model: new FilesOnlyPreCommitModel({\n                        repository: repository\n                    })\n                });\n            } else {\n                this._preCommitView = new RB.PreCommitView({\n                    model: new RB.UploadDiffModel({\n                        repository: repository\n                    })\n                });\n\n                if (repository.get('supportsPostCommit')) {\n                    this._postCommitView = new RB.PostCommitView({\n                        model: new RB.PostCommitModel({\n                            repository: repository\n                        }),\n                        $scrollContainer: this._$content,\n                    });\n                }\n            }\n\n            this._$hint.hide();\n            this._$content.append(this._preCommitView.render().el);\n\n            if (this._postCommitView) {\n                this._$content.append(this._postCommitView.render().el);\n            }\n        }\n    },\n\n    /**\n     * Remove the pre- and post-commit views.\n     *\n     * This will remove the views from the DOM and null them out, allowing\n     * them to be rebuilt.\n     */\n    _removeCommitViews() {\n        if (this._preCommitView) {\n            this._preCommitView.remove();\n            this._preCommitView = null;\n        }\n\n        if (this._postCommitView) {\n            this._postCommitView.remove();\n            this._postCommitView = null;\n        }\n    },\n\n    /**\n     * Handler for when the mobile-only Show Repositories link is clicked.\n     *\n     * Sets the page to slide back to the sidebar listing repositories.\n     */\n    _onShowRepositoriesClicked() {\n        this._repositorySelectionView.unselect();\n    },\n});\n\n\n})();\n"]}