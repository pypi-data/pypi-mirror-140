{"version":3,"sources":["uploadAttachmentViewTests.es6.js"],"names":[],"mappings":"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","file":"uploadAttachmentViewTests.js","sourcesContent":["suite('rb/views/UploadAttachmentView', function() {\n    let reviewRequest;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest({\n            summary: 'My Review Request',\n            reviewURL: '/r/1/',\n        });\n    });\n\n    describe('Instances', function() {\n        let dialog;\n\n        afterEach(function() {\n            if (dialog) {\n                dialog.hide();\n                dialog = null;\n            }\n        });\n\n        describe('Buttons', function() {\n            beforeEach(function() {\n                dialog = new RB.UploadAttachmentView({\n                    reviewRequest: reviewRequest,\n                });\n            });\n\n            describe('Cancel', function() {\n                let $button;\n\n                beforeEach(function() {\n                    dialog.show();\n                    $button = dialog.$buttonsMap.cancel;\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Enabled by default', function() {\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Closes dialog when clicked', function() {\n                    spyOn($.fn, 'modalBox').and.callThrough();\n                    dialog.delegateEvents();\n\n                    $button.click();\n                    expect($.fn.modalBox).toHaveBeenCalledWith('destroy');\n                });\n            });\n\n            describe('Upload', function() {\n                let $button;\n                let $path;\n\n                beforeEach(function() {\n                    spyOn(dialog, 'send');\n\n                    dialog.show();\n                    $button = dialog.$buttonsMap.upload;\n                    $path = dialog._$path;\n\n                    /*\n                     * Allows the value of the input to be changed\n                     * programmatically without security issues.\n                     */\n                    $path.attr('type', 'text');\n\n                    spyOn(dialog, 'updateUploadButtonEnabledState')\n                        .and.callThrough();\n                    dialog.delegateEvents();\n\n                    expect($button.length).toBe(1);\n                });\n\n                it('Disabled by default until a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Enabled when a file is uploaded', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(1);\n                    expect($button.is(':disabled')).toBe(false);\n                });\n\n                it('Disabled when an uploaded file is removed', function() {\n                    $path\n                        .val('fakefile')\n                        .trigger('change')\n                        .val('')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState)\n                        .toHaveBeenCalledTimes(2);\n                    expect($button.is(':disabled')).toBe(true);\n                });\n\n                it('Uploads the file attachment', function() {\n                    expect($button.is(':disabled')).toBe(true);\n\n                    $path\n                        .val('fakefile')\n                        .trigger('change');\n\n                    expect(dialog.updateUploadButtonEnabledState).toHaveBeenCalled();\n                    expect($button.is(':disabled')).toBe(false);\n\n                    $button.click();\n                    expect(dialog.send).toHaveBeenCalled();\n                });\n            });\n        });\n\n        it('Dialog for updating an existing file attachment', function() {\n            dialog = new RB.UploadAttachmentView({\n                attachmentHistoryID: 14,\n                presetCaption: 'fakecaption',\n                reviewRequest: reviewRequest,\n            });\n\n            dialog.show();\n            const $caption = dialog.$('[name=\"caption\"]');\n            const $attachmentHistory = dialog.$('[name=\"attachment_history\"]');\n\n            expect($caption.length).toBe(1);\n            expect($caption.val()).toBe('fakecaption');\n\n            expect($attachmentHistory.length).toBe(1);\n            expect($attachmentHistory.val()).toBe('14');\n        });\n    });\n});\n"]}