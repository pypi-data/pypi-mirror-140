{"version":3,"sources":["dialogView.es6.js"],"names":[],"mappings":"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","file":"dialogView.js","sourcesContent":["/**\n * Displays a modal dialog box with content and buttons.\n *\n * The dialog box can have a title and a list of buttons. It can be shown\n * or hidden on demand.\n *\n * This view can either be subclassed (with the contents in render() being\n * used to populate the dialog), or it can be tied to an element that already\n * contains content.\n *\n * Under the hood, this is a wrapper around $.modalBox.\n *\n * Subclasses of DialogView can specify a default title, list of buttons,\n * and default options for modalBox. The title and buttons can be overridden\n * when constructing the view by passing them as options.\n */\nRB.DialogView = Backbone.View.extend({\n    /** The default title to show for the dialog. */\n    title: null,\n\n    /** The default body to show in the dialog. */\n    body: null,\n\n    /** The default list of buttons to show for the dialog. */\n    buttons: [],\n\n    /** Default options to pass to $.modalBox(). */\n    defaultOptions: {},\n\n    /** Events handled by the view. */\n    events: {\n        'submit form': '_onFormSubmit',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * The available options are 'title' and 'buttons'.\n     *\n     * options.title specifies the title shown on the dialog, overriding\n     * the title on the class.\n     *\n     * Args:\n     *     options (object):\n     *         Options for view construction.\n     *\n     * Option Args:\n     *     body (string or function, optional):\n     *         The body to show in the dialog.\n     *\n     *     buttons (Array of object):\n     *         A list of buttons. Each button may have the following keys:\n     *\n     *         danger (boolean, optional):\n     *             Whether the button performs a dangerous operation (such as\n     *             deleting user data).\n     *\n     *         disabled (boolean, optional):\n     *             Whether the button is disabled.\n     *\n     *         id (string, required):\n     *             The ID for the button.\n     *\n     *         label (string, required):\n     *             The label for the button.\n     *\n     *         onClick (function or string, optional):\n     *             The handler to invoke when the button is clicked. If set to\n     *             a function, that function will be called. If set to a\n     *             string, it will resolve to a function with that name on the\n     *             DialogView instance. If unset, the dialog will simply close\n     *             without invoking any actions.\n     *\n     *             The callback function can return ``false`` to prevent the\n     *             dialog from being closed.\n     *\n     *         primary (boolean, optional):\n     *             Whether the button is the primary action for the dialog.\n     *\n     *     title (string):\n     *         The title for the dialog.\n     */\n    initialize(options={}) {\n        this.options = options;\n\n        if (options.title) {\n            this.title = options.title;\n        }\n\n        if (options.body) {\n            this.body = options.body;\n        }\n\n        if (options.buttons) {\n            this.buttons = options.buttons;\n        }\n\n        this.visible = false;\n    },\n\n    /**\n     * Render the content of the dialog.\n     *\n     * By default, this does nothing. Subclasses can override to render\n     * custom content.\n     *\n     * Note that this will be called every time the dialog is shown, not just\n     * when it's first constructed.\n     *\n     * Returns:\n     *     RB.DialogView:\n     *     This object, for chaining.\n     */\n    render() {\n        return this;\n    },\n\n    /**\n     * Show the dialog.\n     */\n    show() {\n        if (!this.visible) {\n            const body = _.result(this, 'body');\n\n            if (body) {\n                this.$el.append(body);\n            }\n\n            this._makeButtons();\n            this.render();\n\n            this.$el.modalBox(_.defaults({\n                title: _.result(this, 'title'),\n                buttons: this.$buttonsList,\n                destroy: () => this.visible = false,\n            }, this.options, this.defaultOptions));\n\n            this.$el.closest('.modalbox-inner')\n                .on('keydown', this._onDialogKeyDown.bind(this));\n\n            this.visible = true;\n        }\n    },\n\n    /**\n     * Hide the dialog.\n     */\n    hide() {\n        if (this.visible) {\n            /*\n             * The jQuery-UI widget can self-destruct in some cases depending\n             * on how events bubble. If that's the case, we skip an extra\n             * destroy call because otherwise we get errors on the console.\n             */\n            if (this.$el.data('uiModalBox')) {\n                this.$el.modalBox('destroy');\n            }\n\n            this.visible = false;\n        }\n    },\n\n    /**\n     * Remove the dialog from the DOM.\n     */\n    remove() {\n        this.hide();\n\n        _super(this).remove.call(this);\n    },\n\n    /**\n     * Return a list of button elements for rendering.\n     *\n     * This will take the button list that was provided when constructing\n     * the dialog and turn each into an element. The elements are also saved to\n     * a map to allow child components to access the buttons.\n     *\n     * Returns:\n     *     Array of jQuery:\n     *     An array of button elements.\n     */\n    _makeButtons() {\n        this.$buttonsMap = {};\n        this.$buttonsList = this.buttons.map(buttonInfo => {\n            const $button = $('<input type=\"button\" />')\n                .val(buttonInfo.label)\n                .attr('id', buttonInfo.id);\n\n            if (buttonInfo.class) {\n                $button.addClass(buttonInfo.class);\n            }\n\n            if (buttonInfo.disabled) {\n                $button.attr('disabled', true);\n            }\n\n            if (buttonInfo.primary) {\n                $button.addClass('primary');\n                this._$primaryButton = $button;\n            }\n\n            if (buttonInfo.danger) {\n                $button.addClass('danger');\n            }\n\n            if (buttonInfo.onClick) {\n                if (_.isFunction(buttonInfo.onClick)) {\n                    $button.click(buttonInfo.onClick);\n                } else {\n                    $button.click(this[buttonInfo.onClick].bind(this));\n                }\n            }\n\n            this.$buttonsMap[buttonInfo.id] = $button;\n\n            return $button;\n        });\n    },\n\n    /**\n     * Handle form submission events for the dialog.\n     *\n     * This will trigger the primary button if the form in the dialog does not\n     * have an explicit action.\n     *\n     * Args:\n     *     e (Event):\n     *         The event which triggered the callback.\n     */\n    _onFormSubmit(e) {\n        if (!$(e.target).attr('action')) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (this._$primaryButton) {\n                this._$primaryButton[0].click();\n            }\n        }\n    },\n\n    /**\n     * Handle keydown events for the dialog.\n     *\n     * Args:\n     *     e (Event):\n     *         The event which triggered the callback.\n     */\n    _onDialogKeyDown(e) {\n        if (e.which === $.ui.keyCode.ESCAPE) {\n            e.stopPropagation();\n            e.preventDefault();\n\n            this.hide();\n        }\n    },\n});\n"]}