{"version":3,"sources":["reviewViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewView', function() {\n    const template = _.template(dedent`\n        <div class=\"review review-request-page-entry\">\n         <div class=\"review-request-page-entry-contents\">\n          <div class=\"collapse-button\"></div>\n          <div class=\"banners\">\n           <input type=\"button\" value=\"Publish\" />\n           <input type=\"button\" value=\"Discard\" />\n          </div>\n          <div class=\"body\">\n           <ol class=\"review-comments\">\n            <li>\n             <div class=\"review-comment-details\">\n              <div class=\"review-comment\">\n               <pre class=\"reviewtext body_top\"></pre>\n              </div>\n             </div>\n             <div class=\"review-comment-thread\">\n              <div class=\"comment-section\"\n                   data-context-type=\"body_top\"\n                   data-reply-anchor-prefix=\"header-reply\">\n               <a class=\"add_comment_link\"></a>\n               <ul class=\"reply-comments\">\n                <li class=\"draft\" data-comment-id=\"456\">\n                 <pre class=\"reviewtext\"></pre>\n                </li>\n               </ul>\n              </div>\n             </div>\n            </li>\n            <li>\n             <div class=\"review-comment-thread\">\n              <div class=\"comment-section\" data-context-id=\"123\"\n                   data-context-type=\"diff_comments\"\n                   data-reply-anchor-prefix=\"comment\">\n               <a class=\"add_comment_link\"></a>\n               <ul class=\"reply-comments\"></ul>\n              </div>\n             </div>\n            </li>\n            <li>\n             <div class=\"review-comment-details\">\n              <div class=\"review-comment\">\n               <pre class=\"reviewtext body_bottom\"></pre>\n              </div>\n             </div>\n             <div class=\"review-comment-thread\">\n              <div class=\"comment-section\"\n                   data-context-type=\"body_bottom\"\n                   data-reply-anchor-prefix=\"footer-reply\">\n               <a class=\"add_comment_link\"></a>\n               <ul class=\"reply-comments\"></ul>\n              </div>\n             </div>\n            </div>\n           </li>\n          </ol>\n         </div>\n        </div>\n    `);\n    let view;\n    let review;\n    let reviewReply;\n\n    beforeEach(function() {\n        const reviewRequest = new RB.ReviewRequest();\n        const editor = new RB.ReviewRequestEditor({\n            reviewRequest: reviewRequest,\n        });\n\n        review = reviewRequest.createReview({\n            loaded: true,\n            links: {\n                replies: {\n                    href: '/api/review/123/replies/',\n                },\n            },\n        });\n\n        const $el = $(template()).appendTo($testsScratch);\n\n        reviewReply = review.createReply();\n\n        view = new RB.ReviewRequestPage.ReviewView({\n            el: $el,\n            model: review,\n            entryModel: new RB.ReviewRequestPage.ReviewEntry({\n                review: review,\n                reviewRequest: reviewRequest,\n                reviewRequestEditor: editor,\n            }),\n        });\n\n        view._setupNewReply(reviewReply);\n\n        spyOn(view, 'trigger').and.callThrough();\n\n        view.render();\n    });\n\n    describe('Model events', function() {\n        it('bodyTop changed', function() {\n            review.set({\n                bodyTop: 'new **body** top',\n                htmlTextFields: {\n                    bodyTop: '<p>new <strong>body</strong> top</p>',\n                },\n            });\n\n            expect(view._$bodyTop.html())\n                .toBe('<p>new <strong>body</strong> top</p>');\n        });\n\n        it('bodyBottom changed', function() {\n            review.set({\n                bodyBottom: 'new **body** bottom',\n                htmlTextFields: {\n                    bodyBottom: '<p>new <strong>body</strong> bottom</p>',\n                },\n            });\n\n            expect(view._$bodyBottom.html())\n                .toBe('<p>new <strong>body</strong> bottom</p>');\n        });\n\n        describe('bodyTopRichText changed', function() {\n            it('To true', function() {\n                expect(view._$bodyTop.hasClass('rich-text')).toBe(false);\n                review.set('bodyTopRichText', true);\n                expect(view._$bodyTop.hasClass('rich-text')).toBe(true);\n            });\n\n            it('To false', function() {\n                review.attributes.bodyTopRichText = true;\n                view._$bodyTop.addClass('rich-text');\n\n                review.set('bodyTopRichText', false);\n                expect(view._$bodyTop.hasClass('rich-text')).toBe(false);\n            });\n        });\n\n        describe('bodyBottomRichText changed', function() {\n            it('To true', function() {\n                expect(view._$bodyBottom.hasClass('rich-text')).toBe(false);\n                review.set('bodyBottomRichText', true);\n                expect(view._$bodyBottom.hasClass('rich-text')).toBe(true);\n            });\n\n            it('To false', function() {\n                review.attributes.bodyBottomRichText = true;\n                view._$bodyBottom.addClass('rich-text');\n\n                review.set('bodyBottomRichText', false);\n                expect(view._$bodyBottom.hasClass('rich-text')).toBe(false);\n            });\n        });\n    });\n\n    describe('Reply editors', function() {\n        it('Views created', function() {\n            expect(view._replyEditorViews.length).toBe(3);\n        });\n\n        it('Initial state populated', function() {\n            let model = view._replyEditorViews[0].model;\n\n            expect(model.get('anchorPrefix')).toBe('header-reply');\n            expect(model.get('contextID')).toBe(null);\n            expect(model.get('contextType')).toBe('body_top');\n            expect(model.get('hasDraft')).toBe(true);\n\n            model = view._replyEditorViews[1].model;\n            expect(model.get('anchorPrefix')).toBe('comment');\n            expect(model.get('contextID')).toBe(123);\n            expect(model.get('contextType')).toBe('diff_comments');\n            expect(model.get('hasDraft')).toBe(false);\n\n            model = view._replyEditorViews[2].model;\n            expect(model.get('anchorPrefix')).toBe('footer-reply');\n            expect(model.get('contextID')).toBe(null);\n            expect(model.get('contextType')).toBe('body_bottom');\n            expect(model.get('hasDraft')).toBe(false);\n\n            expect(view._replyDraftsCount).toBe(1);\n        });\n\n        it('Draft banner when draft comment exists', function() {\n            expect(view.trigger)\n                .toHaveBeenCalledWith('hasDraftChanged', true);\n        });\n\n        describe('reviewReply changes on', function() {\n            it('Discard', function() {\n                spyOn(view, '_setupNewReply');\n\n                spyOn(reviewReply, 'discardIfEmpty').and.callFake(\n                    (options, context) => options.success.call(context));\n\n                reviewReply.trigger('destroyed');\n\n                expect(view._setupNewReply).toHaveBeenCalled();\n            });\n\n            it('Publish', function() {\n                spyOn(view, '_setupNewReply');\n\n                /*\n                 * Avoid any of the steps in saving the replies. This\n                 * short-circuits a lot of the logic, but for the purposes\n                 * of this test, it's sufficient.\n                 */\n                spyOn(RB.BaseResource.prototype, 'ready');\n\n                /*\n                 * Save each editor, so the necessary state is available for\n                 * the publish operation.\n                 */\n                view._replyEditors.forEach(editor => editor.save());\n                reviewReply.trigger('published');\n\n                expect(view._setupNewReply).toHaveBeenCalled();\n            });\n        });\n\n        describe('When draft deleted', function() {\n            describe('With last one', function() {\n                it('Draft banner hidden', function() {\n                    const editor = view._replyEditors[0];\n                    expect(editor.get('hasDraft')).toBe(true);\n                    expect(view._replyDraftsCount).toBe(1);\n                    expect(view._draftBannerShown).toBe(true);\n\n                    editor.set('hasDraft', false);\n                    expect(view._replyDraftsCount).toBe(0);\n                    expect(view._draftBannerShown).toBe(false);\n                });\n            });\n\n            describe('With more remaining', function() {\n                it('Draft banner stays visible', function() {\n                    view._replyEditors[1].set('hasDraft', true);\n\n                    const editor = view._replyEditors[0];\n                    expect(editor.get('hasDraft')).toBe(true);\n\n                    expect(view._replyDraftsCount).toBe(2);\n                    expect(view._draftBannerShown).toBe(true);\n\n                    editor.set('hasDraft', false);\n                    expect(view._replyDraftsCount).toBe(1);\n                    expect(view._draftBannerShown).toBe(true);\n                });\n            });\n        });\n\n        describe('When reviewReply changes', function() {\n            it('Signals connected', function() {\n                spyOn(view, 'listenTo').and.callThrough();\n\n                view._setupNewReply(new RB.ReviewReply());\n\n                expect(view.listenTo.calls.argsFor(0)[1])\n                    .toBe('destroyed published');\n            });\n\n            it('Signals disconnected from old reviewReply', function() {\n                spyOn(view, 'stopListening').and.callThrough();\n\n                view._setupNewReply();\n\n                expect(view.stopListening).toHaveBeenCalledWith(reviewReply);\n            });\n\n            it('Hide draft banner signal emitted', function() {\n                view._setupNewReply();\n                expect(view.trigger).toHaveBeenCalledWith('hasDraftChanged',\n                                                          false);\n            });\n\n            it('Editors updated', function() {\n                view._setupNewReply();\n\n                view._replyEditors.forEach(editor =>\n                    expect(editor.get('reviewReply')).toBe(view._reviewReply));\n            });\n        });\n    });\n});\n"]}