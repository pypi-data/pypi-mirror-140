{"version":3,"sources":["diffCommitListView.es6.js"],"names":[],"mappings":"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","file":"diffCommitListView.js","sourcesContent":["/*\n * The templates should be kept in sync with:\n *\n * - templates/reviews/changedesc_commit_list.html\n * - templates/reviews/commit_list_field.html\n *\n * so that they render items identically.\n */\n(function() {\n\n\nconst itemTemplate = _.template(dedent`\n    <tr<% if (rowClass) { %> class=\"<%- rowClass %>\"<% } %>>\n     <% if (showHistorySymbol) { %>\n      <td class=\"marker\">\n       <%- historyDiffEntry.getSymbol() %>\n      </td>\n     <% } else if (showInterCommitDiffControls) { %>\n      <td class=\"select-base\">\n       <input type=\"radio\"\n              class=\"base-commit-selector\"\n              name=\"base-commit-id\"\n              <% if (baseSelected) { %>checked<% } %>\n              <% if (baseDisabled) { %>disabled<% } %>\n              value=\"<%- commit.id %>\">\n      </td>\n      <td class=\"select-tip\">\n       <input type=\"radio\"\n              class=\"tip-commit-selector\"\n              name=\"tip-commit-id\"\n              <% if (tipSelected) { %>checked<% } %>\n              <% if (tipDisabled) { %>disabled<% } %>\n              value=\"<%- commit.id %>\">\n      </td>\n     <% } %>\n     <% if (showExpandCollapse) { %>\n      <td>\n       <% if (commit && commit.hasSummary()) { %>\n        <a href=\"#\"\n           class=\"expand-commit-message\"\n           data-commit-id=\"<%- commit.id %>\"\n           aria-role=\"button\">\n         <span class=\"fa fa-plus\" title=\"<%- expandText %>\"></span>\n        </a>\n       <% } %>\n      </td>\n     <% } %>\n     <td<% if (showHistorySymbol) { %> class=\"value\"<% } %>>\n      <% if (commit !== null) { %>\n       <pre><%- commit.get('summary') %></pre>\n      <% } %>\n     </td>\n     <td<% if (showHistorySymbol) { %> class=\"value\"<% } %>>\n      <% if (commit !== null) { %>\n       <%- commit.get('authorName') %>\n      <% } %>\n     </td>\n    </tr>\n`);\n\nconst headerTemplate = _.template(dedent`\n    <thead>\n     <tr>\n      <% if (showHistorySymbol) { %>\n       <th></th>\n      <% } else if (showInterCommitDiffControls) { %>\n       <th><%- firstText %></th>\n       <th><%- lastText %></th>\n      <% } %>\n      <th<% if (showExpandCollapse) { %> colspan=\"2\"<% } %>>\n       <%- summaryText %>\n       </th>\n      <th><%- authorText %></th>\n     </tr>\n    </thead>\n`);\n\nconst tableTemplate = _.template(dedent`\n    <form>\n     <table class=\"commit-list\">\n      <colgroup>\n       <% if (showHistorySymbol) { %>\n        <col>\n       <% } else if (showInterCommitDiffControls) { %>\n         <col>\n         <col>\n       <% } %>\n       <% if (showExpandCollapse) { %>\n        <col class=\"expand-collapse-control\">\n       <% } %>\n       <col>\n       <col>\n      </colgroup>\n     </table>\n    </form>\n`);\n\n/**\n * A view for displaying a list of commits and their metadata.\n */\nRB.DiffCommitListView = Backbone.View.extend({\n    events: {\n        'change .base-commit-selector': '_onBaseChanged',\n        'change .tip-commit-selector': '_onTipChanged',\n        'click .collapse-commit-message': '_collapseCommitMessage',\n        'click .expand-commit-message': '_expandCommitMessage',\n    },\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options that control how this view behaves.\n     *\n     * Option Args:\n     *     showInterCommitDiffControls (boolean):\n     *         Whether or not to show interdiff controls.\n     */\n    initialize(options) {\n        this.listenTo(this.model.get('commits'), 'reset', this.render);\n\n        this._showInterCommitDiffControls =\n            !!options.showInterCommitDiffControls;\n\n        this._$baseSelectors = $();\n        this._$tipSelectors = $();\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.DiffCommitListView:\n     *     This view, for chaining.\n     */\n    render() {\n        const commits = this.model.get('commits');\n        const isInterdiff = this.model.isInterdiff();\n\n        const commonContext = {\n            showExpandCollapse: commits.some(commit => commit.hasSummary()),\n            showHistorySymbol: isInterdiff,\n            showInterCommitDiffControls:\n                this._showInterCommitDiffControls,\n        };\n\n        const $content = $(tableTemplate(commonContext))\n        const $table = $content\n            .find('table')\n            .toggleClass('changed', isInterdiff)\n            .append(headerTemplate(_.extend(\n                {\n                    authorText: gettext('Author'),\n                    firstText: gettext('First'),\n                    lastText: gettext('Last'),\n                    summaryText: gettext('Summary'),\n                },\n                commonContext\n            )));\n\n        const $tbody = $('<tbody />');\n\n        commonContext.expandText = gettext('Expand commit message.');\n\n        if (isInterdiff) {\n            this.model.get('historyDiff').each(historyDiffEntry => {\n                const entryType = historyDiffEntry.get('entryType');\n\n                let key;\n                let rowClass;\n\n                switch (entryType) {\n                    case RB.CommitHistoryDiffEntry.ADDED:\n                        rowClass = 'new-value';\n                        key = 'newCommitID';\n                        break;\n\n                    case RB.CommitHistoryDiffEntry.REMOVED:\n                        rowClass = 'old-value';\n                        key = 'oldCommitID';\n                        break;\n\n                    case RB.CommitHistoryDiffEntry.UNMODIFIED:\n                    case RB.CommitHistoryDiffEntry.MODIFIED:\n                        key = 'newCommitID';\n                        break;\n\n                    default:\n                        console.error('Invalid history entry type: %s',\n                                      entryType);\n                        break;\n                }\n\n                const commit = commits.get(historyDiffEntry.get(key));\n\n                $tbody.append(itemTemplate(_.extend(\n                    {\n                        commit: commit,\n                        historyDiffEntry: historyDiffEntry,\n                        rowClass: rowClass,\n                    },\n                    commonContext\n                )));\n            });\n        } else {\n            commonContext.rowClass = '';\n\n            const baseCommitID = this.model.get('baseCommitID');\n            const tipCommitID = this.model.get('tipCommitID');\n            const lastIndex = commits.size() - 1;\n\n            const baseIndex = (\n                baseCommitID === null\n                ? 0\n                : commits.indexOf(commits.getChild(commits.get(baseCommitID)))\n            );\n\n            const tipIndex = (tipCommitID === null\n                              ? lastIndex\n                              : commits.indexOf(commits.get(tipCommitID)));\n\n            commits.each((commit, i) => {\n                $tbody.append(itemTemplate(_.extend(\n                    {\n                        commit: commit,\n                        baseSelected: i === baseIndex,\n                        tipSelected: i === tipIndex,\n                        baseDisabled: i > tipIndex,\n                        tipDisabled: i < baseIndex,\n                    },\n                    commonContext\n                )));\n            });\n        }\n\n        $table.append($tbody);\n\n        this.$el\n            .empty()\n            .append($content);\n\n        this._$baseSelectors = this.$('.base-commit-selector');\n        this._$tipSelectors = this.$('.tip-commit-selector');\n\n        return this;\n    },\n\n    /**\n     * Handle the expand button being clicked.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _expandCommitMessage(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._expandOrCollapse(\n            $(e.target).closest('.expand-commit-message'),\n            true);\n    },\n\n    /**\n     * Handle the collapse button being clicked.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The click event.\n     */\n    _collapseCommitMessage(e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this._expandOrCollapse(\n            $(e.target).closest('.collapse-commit-message'),\n            false);\n    },\n\n    /**\n     * Expand or collapse the commit message on the same row as the link.\n     *\n     * Args:\n     *     $link (jQuery):\n     *         The expand or collapse link that was clicked.\n     *\n     *     expand (boolean):\n     *         Whether we are expanding (``true``) or collapsing (``false``).\n     */\n    _expandOrCollapse($link, expand) {\n        const $icon = $link.find('.fa');\n        const commitID = $link.data('commitId');\n\n        const commit = this.model.get('commits').get(commitID);\n        const newText = commit.get(expand ? 'commitMessage' : 'summary');\n\n        $link.closest('tr')\n            .find('pre')\n            .text(newText);\n\n        $link.attr(\n            'class',\n            expand ? 'collapse-commit-message' : 'expand-commit-message');\n\n        $icon.attr({\n            'class': expand ? 'fa fa-minus' : 'fa fa-plus',\n            'title': expand ? gettext('Collapse commit message.')\n                            : gettext('Expand commit message.'),\n        });\n    },\n\n    /**\n     * Handle the base commit selection changing.\n     *\n     * The view's model will be updated to reflect this change.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The change event.\n     */\n    _onBaseChanged(e) {\n        const $target = $(e.target);\n        const commits = this.model.get('commits');\n        const commit = commits.get(parseInt($target.val(), 10));\n        const index = commits.indexOf(commit);\n\n        this.model.set('baseCommitID',\n                       index === 0\n                       ? null\n                       : commits.getParent(commit).id);\n\n        this._$tipSelectors\n            .slice(0, index)\n            .prop('disabled', true);\n\n        this._$tipSelectors\n            .slice(index)\n            .prop('disabled', false);\n    },\n\n    /**\n     * Handle the tip commit selection changing.\n     *\n     * The view's model will be updated to reflect this change.\n     *\n     * Args:\n     *     e (jQuery.Event):\n     *         The change event.\n     */\n    _onTipChanged(e) {\n        const $target = $(e.target);\n        const commits = this.model.get('commits');\n        const commit = commits.get(parseInt($target.val(), 10));\n        const index = commits.indexOf(commit);\n\n        this.model.set('tipCommitID',\n                       index === commits.size() - 1\n                       ? null\n                       : commit.id);\n\n        this._$baseSelectors\n            .slice(0, index + 1)\n            .prop('disabled', false);\n\n        this._$baseSelectors\n            .slice(index + 1)\n            .prop('disabled', true);\n    },\n});\n\n\n})();\n"]}