{"version":3,"sources":["fileAttachmentThumbnailViewTests.es6.js"],"names":[],"mappings":"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","file":"fileAttachmentThumbnailViewTests.js","sourcesContent":["suite('rb/views/FileAttachmentThumbnail', function() {\n    let reviewRequest;\n    let model;\n    let view;\n\n    beforeEach(function() {\n        reviewRequest = new RB.ReviewRequest();\n        model = new RB.FileAttachment({\n            downloadURL: 'http://example.com/file.png',\n            filename: 'file.png',\n        });\n\n        spyOn(model, 'trigger').and.callThrough();\n    });\n\n    describe('Rendering', function() {\n        function expectElements() {\n            expect(view.$('a.edit').length).toBe(1);\n            expect(view.$('.file-caption').length).toBe(1);\n            expect(view.$('.file-actions').length).toBe(1);\n            expect(view.$('.file-delete').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n            expect(view.$('.file-update').length).toBe(\n                view.options.canEdit && model.get('loaded') ? 1 : 0);\n        }\n\n        function expectAttributeMatches() {\n            expect(view.$('.file-download').attr('href')).toBe(\n                model.get('downloadURL'));\n            expect(view.$('.file-caption .edit').text()).toBe(\n                model.get('caption'));\n        }\n\n        it('Using existing elements', function() {\n            const $el = $('<div/>')\n                .addClass(RB.FileAttachmentThumbnail.prototype.className)\n                .html(RB.FileAttachmentThumbnail.prototype.template(\n                    _.defaults({\n                        caption: 'No caption',\n                        captionClass: 'edit empty-caption',\n                    }, model.attributes)));\n\n            model.set('loaded', true);\n\n            view = new RB.FileAttachmentThumbnail({\n                renderThumbnail: true,\n                reviewRequest: reviewRequest,\n                el: $el,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').is(':visible')).toBe(true);\n            expect(view.$('.fa-spinner').length).toBe(0);\n        });\n\n        it('Rendered thumbnail with unloaded model', function() {\n            view = new RB.FileAttachmentThumbnail({\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            expectElements();\n\n            expect(view.$('.file-actions').children().length).toBe(0);\n            expect(view.$('.fa-spinner').length).toBe(1);\n        });\n\n        describe('Rendered thumbnail with loaded model', function() {\n            beforeEach(function() {\n                model.id = 123;\n                model.attributes.id = 123;\n                model.set('caption', 'My Caption');\n                model.set('loaded', true);\n                model.url = '/api/file-attachments/123/';\n            });\n\n            it('With review UI', function() {\n                model.set('reviewURL', '/review/');\n\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(1);\n                expect(view.$('.file-add-comment').length).toBe(0);\n            });\n\n            it('No review UI', function() {\n                view = new RB.FileAttachmentThumbnail({\n                    reviewRequest: reviewRequest,\n                    renderThumbnail: true,\n                    model: model,\n                });\n                $testsScratch.append(view.$el);\n                view.render();\n\n                expectElements();\n                expectAttributeMatches();\n\n                expect(view.$('.file-actions').children().length).toBe(2);\n                expect(view.$('.fa-spinner').length).toBe(0);\n                expect(view.$('.file-review').length).toBe(0);\n                expect(view.$('.file-add-comment').length).toBe(1);\n            });\n        });\n    });\n\n    describe('Actions', function() {\n        beforeEach(function() {\n            model.id = 123;\n            model.attributes.id = 123;\n            model.set('loaded', true);\n            model.url = '/api/file-attachments/123/';\n\n            view = new RB.FileAttachmentThumbnail({\n                canEdit: true,\n                reviewRequest: reviewRequest,\n                renderThumbnail: true,\n                model: model,\n            });\n            $testsScratch.append(view.$el);\n            view.render();\n\n            spyOn(view, 'trigger').and.callThrough();\n        });\n\n        it('Begin caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n        });\n\n        it('Cancel caption editing', function() {\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view._captionEditorView.cancel();\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n        });\n\n        it('Save caption', function() {\n            spyOn(model, 'save');\n\n            view._captionEditorView.startEdit();\n            expect(view.trigger).toHaveBeenCalledWith('beginEdit');\n\n            view.$('input')\n                .val('Foo')\n                .triggerHandler('keyup');\n            view._captionEditorView.submit();\n\n            expect(view.trigger).toHaveBeenCalledWith('endEdit');\n            expect(model.get('caption')).toBe('Foo');\n            expect(model.save).toHaveBeenCalled();\n        });\n\n        it('Delete', function() {\n            spyOn(model, 'destroy').and.callThrough();\n            spyOn($, 'ajax').and.callFake(options => options.success());\n            spyOn(view.$el, 'fadeOut').and.callFake(done => done());\n            spyOn(view, 'remove');\n\n            view.$('.file-delete').click();\n\n            expect($.ajax).toHaveBeenCalled();\n            expect(model.destroy).toHaveBeenCalled();\n            expect(model.trigger.calls.argsFor(2)[0]).toBe('destroying');\n            expect(view.$el.fadeOut).toHaveBeenCalled();\n            expect(view.remove).toHaveBeenCalled();\n        });\n    });\n});\n"]}