{"version":3,"sources":["abstractReviewableView.es6.js"],"names":[],"mappings":"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","file":"abstractReviewableView.js","sourcesContent":["/**\n * Abstract base for review UIs.\n *\n * This provides all the basics for creating a review UI. It does the\n * work of loading in comments, creating views, and displaying comment dialogs,\n */\nRB.AbstractReviewableView = Backbone.View.extend({\n    /**\n     * The AbstractCommentBlockView subclass.\n     *\n     * This is the type that will be instantiated for rendering comment blocks.\n     */\n    commentBlockView: null,\n\n    /**\n     * The list type (as a string) for passing to CommentDlg.\n     */\n    commentsListName: null,\n\n    /**\n     * Initialize AbstractReviewableView.\n     *\n     * Args:\n     *     options (object, optional):\n     *         Options for the view.\n     */\n    initialize(options={}) {\n        console.assert(this.commentBlockView,\n                       'commentBlockView must be defined by the subclass');\n        console.assert(this.commentsListName,\n                       'commentsListName must be defined by the subclass');\n\n        this.commentDlg = null;\n        this._activeCommentBlock = null;\n        this.renderedInline = options.renderedInline || false;\n    },\n\n    /**\n     * Render the reviewable to the page.\n     *\n     * This will call the subclass's renderContent(), and then handle\n     * rendering each comment block on the reviewable.\n     *\n     * Returns:\n     *     RB.AbstractReviewableView:\n     *     This object, for chaining.\n     */\n    render() {\n        this.renderContent();\n\n        this.model.commentBlocks.each(this._addCommentBlockView, this);\n        this.model.commentBlocks.on('add', this._addCommentBlockView, this);\n\n        return this;\n    },\n\n    /**\n     * Render the content of the reviewable.\n     *\n     * This should be overridden by subclasses.\n     */\n    renderContent() {\n    },\n\n    /**\n     * Create a new comment in a comment block and opens it for editing.\n     *\n     * Args:\n     *     options (object):\n     *         Options for the comment block creation.\n     */\n    createAndEditCommentBlock(options) {\n        if (this.commentDlg !== null &&\n            this.commentDlg.model.get('dirty') &&\n            !confirm(gettext('You are currently editing another comment. Would you like to discard it and create a new one?'))) {\n            return;\n        }\n\n        let defaultCommentBlockFields =\n            _.result(this.model, 'defaultCommentBlockFields');\n\n        if (defaultCommentBlockFields.length === 0 &&\n            this.model.reviewableIDField) {\n            console.log('Deprecation notice: Reviewable subclass is missing ' +\n                        'defaultCommentBlockFields. Rename reviewableIDField ' +\n                        'to defaultCommentBlockFields, and make it a list.');\n            defaultCommentBlockFields = [this.model.reviewableIDField];\n        }\n\n        /* As soon as we add the comment block, show the dialog. */\n        this.once('commentBlockViewAdded',\n                  commentBlockView => this.showCommentDlg(commentBlockView));\n\n        _.extend(options,\n                 _.pick(this.model.attributes, defaultCommentBlockFields));\n        this.model.createCommentBlock(options);\n    },\n\n    /**\n     * Show the comment details dialog for a comment block.\n     *\n     * Args:\n     *     commentBlockView (RB.AbstractCommentBlockView):\n     *         The comment block to show the dialog for.\n     */\n    showCommentDlg(commentBlockView) {\n        const commentBlock = commentBlockView.model;\n\n        commentBlock.ensureDraftComment();\n\n        if (this._activeCommentBlock === commentBlock) {\n            return;\n        }\n\n        this.stopListening(this.commentDlg, 'closed');\n        this.commentDlg = RB.CommentDialogView.create({\n            comment: commentBlock.get('draftComment'),\n            publishedComments: commentBlock.get('serializedComments'),\n            publishedCommentsType: this.commentsListName,\n            position: dlg => commentBlockView.positionCommentDlg(dlg),\n        });\n        this._activeCommentBlock = commentBlock;\n\n        this.listenTo(this.commentDlg, 'closed', () => {\n            this.commentDlg = null;\n            this._activeCommentBlock = null;\n        });\n    },\n\n    /**\n     * Add a CommentBlockView for the given CommentBlock.\n     *\n     * This will create a view for the block, render it, listen for clicks\n     * in order to show the comment dialog, and then emit\n     * 'commentBlockViewAdded'.\n     *\n     * Args:\n     *     commentBlock (RB.AbstractCommentBlock):\n     *         The comment block to add a view for.\n     */\n    _addCommentBlockView(commentBlock) {\n        const commentBlockView = new this.commentBlockView({\n            model: commentBlock\n        });\n\n        commentBlockView.on('clicked', () => this.showCommentDlg(commentBlockView));\n        commentBlockView.render();\n        this.trigger('commentBlockViewAdded', commentBlockView);\n    },\n});\n"]}