{"version":3,"sources":["reviewEntryViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewEntryViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewEntryView', function() {\n    const template = dedent`\n        <div class=\"review review-request-page-entry\">\n         <div class=\"review-request-page-entry-contents\">\n          <div class=\"collapse-button\"></div>\n          <div class=\"banners\">\n           <input type=\"button\" value=\"Publish\" />\n           <input type=\"button\" value=\"Discard\" />\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_top\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\">\n            <li class=\"draft\" data-comment-id=\"456\">\n             <pre class=\"reviewtext\"></pre>\n            </li>\n           </ul>\n          </div>\n          <div class=\"comment-section\" data-context-id=\"123\"\n               data-context-type=\"diff_comments\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n          <div class=\"comment-section\" data-context-type=\"body_bottom\">\n           <a class=\"add_comment_link\"></a>\n           <ul class=\"reply-comments\"></ul>\n          </div>\n         </div>\n        </div>\n    `;\n    let view;\n    let reviewView;\n    let reviewReply;\n\n    beforeEach(function() {\n        const reviewRequest = new RB.ReviewRequest();\n        const editor = new RB.ReviewRequestEditor({\n            reviewRequest: reviewRequest\n        });\n        const review = reviewRequest.createReview({\n            loaded: true,\n            links: {\n                replies: {\n                    href: '/api/review/123/replies/',\n                },\n            },\n        });\n        const model = new RB.ReviewRequestPage.ReviewEntry({\n            review: review,\n            reviewRequest: reviewRequest,\n            reviewRequestEditor: editor,\n        });\n        const $el = $(template).appendTo($testsScratch);\n\n        reviewReply = review.createReply();\n\n        view = new RB.ReviewRequestPage.ReviewEntryView({\n            el: $el,\n            model: model,\n        });\n\n        view.render();\n\n        reviewView = view._reviewView;\n\n        /* Don't allow the draft banner to show. */\n        spyOn(reviewView, '_showReplyDraftBanner');\n        spyOn(reviewView, 'trigger').and.callThrough();\n\n        reviewView._setupNewReply(reviewReply);\n    });\n\n    describe('Actions', function() {\n        it('Toggle collapse', function() {\n            const $box = view.$('.review-request-page-entry-contents');\n            const $collapseButton = view.$('.collapse-button');\n\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(true);\n            $collapseButton.click();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n    });\n\n    describe('Draft banner', function() {\n        describe('Visibility', function() {\n            it('Shown on hasDraft', function() {\n                const editor = reviewView._replyEditorViews[1].model;\n\n                reviewView._showReplyDraftBanner.calls.reset();\n\n                expect(editor.get('hasDraft')).toBe(false);\n                expect(reviewView._showReplyDraftBanner).not.toHaveBeenCalled();\n\n                editor.set('hasDraft', true);\n                expect(reviewView._showReplyDraftBanner).toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Methods', function() {\n        it('collapse', function() {\n            view.collapse();\n            expect(\n                view.$('.review-request-page-entry-contents')\n                    .hasClass('collapsed'))\n                .toBe(true);\n        });\n\n        it('expand', function() {\n            const $box = view.$('.review-request-page-entry-contents')\n                .addClass('collapsed');\n            view.expand();\n            expect($box.hasClass('collapsed')).toBe(false);\n        });\n\n        describe('getReviewReplyEditorView', function() {\n            it('With body_top', function() {\n                const editorView = view.getReviewReplyEditorView('body_top');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[0]);\n            });\n\n            it('With body_bottom', function() {\n                const editorView = view.getReviewReplyEditorView('body_bottom');\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[2]);\n            });\n\n            it('With comments', function() {\n                const editorView = view.getReviewReplyEditorView('diff_comments',\n                                                                 123);\n\n                expect(editorView).not.toBe(undefined);\n                expect(editorView).toBe(reviewView._replyEditorViews[1]);\n            });\n        });\n    });\n});\n"]}