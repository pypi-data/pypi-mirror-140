{"version":3,"sources":["reviewReplyEditorViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewReplyEditorViewTests.js","sourcesContent":["suite('rb/reviewRequestPage/views/ReviewReplyEditorView', function() {\n    let reviewReply;\n    let editor;\n    let view;\n\n    beforeEach(function() {\n        const $container = $('<div/>').appendTo($testsScratch);\n\n        reviewReply = new RB.ReviewReply({\n            id: 121\n        });\n\n        /* Some tests will invoke this, so just pretend it works. */\n        spyOn(reviewReply, 'discardIfEmpty').and.callFake(\n            (options, context) => options.success.call(context));\n\n        editor = new RB.ReviewRequestPage.ReviewReplyEditor({\n            anchorPrefix: 'header-reply',\n            replyObject: reviewReply,\n            review: new RB.Review({\n                id: 42,\n                parentObject: new RB.ReviewRequest(),\n            }),\n            reviewReply: reviewReply,\n            contextType: 'rcbt',\n            contextID: '100',\n        });\n\n        view = new RB.ReviewRequestPage.ReviewReplyEditorView({\n            model: editor,\n            el: $testsScratch,\n        });\n\n        /* Necessary to do pre-render so we can use makeCommentElement. */\n        view._$commentsList = $('<ul class=\"reply-comments\"/>');\n\n        $container\n            .append(view._$commentsList)\n            .append($('<a href=\"#\" class=\"add_comment_link\">New Comment</a>'));\n    });\n\n    describe('Construction', function() {\n        it('Populate from draft comment', function() {\n            const commentText = 'Test comment';\n            const now = moment();\n            const $el = view._makeCommentElement({\n                commentID: 16,\n                now: now,\n                text: commentText,\n            });\n\n            view.render();\n\n            expect(editor.get('commentID')).toBe(16);\n            expect(editor.get('text')).toBe(commentText);\n            expect(editor.get('hasDraft')).toBe(true);\n            expect(editor.get('timestamp').valueOf())\n                .toBe(now.milliseconds(0).valueOf());\n            expect(view._$draftComment[0]).toBe($el[0]);\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Add comment link', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            view._$addCommentLink.click();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Event handling', function() {\n        it('Comment discarded', function() {\n            view._makeCommentElement({\n                text: 'Test comment',\n            });\n\n            view.render();\n\n            let $el = view.$('.reply-comments li');\n            expect($el.length).toBe(1);\n\n            reviewReply.trigger('destroyed');\n\n            $el = view.$('.reply-comments li');\n            expect($el.length).toBe(0);\n            expect(view._$draftComment).toBe(null);\n        });\n\n        it('Comment published', function() {\n            const $draftEl = view._makeCommentElement({\n                commentID: 16,\n            });\n\n            spyOn($.fn, 'user_infobox').and.callThrough();\n            spyOn($.fn, 'timesince').and.callThrough();\n\n            view.render();\n            editor.set('text', 'Test **comment**');\n            reviewReply.trigger('published');\n\n            const $el = view.$('.reply-comments li');\n\n            expect($el.length).toBe(1);\n            expect($draftEl).not.toBe($el);\n            expect($el.hasClass('draft')).toBe(false);\n            expect($el.data('comment-id')).toBe(16);\n            expect(view._$draftComment).toBe(null);\n            expect($.fn.user_infobox).toHaveBeenCalled();\n            expect($.fn.timesince).toHaveBeenCalled();\n\n            const $anchor = $el.children('.comment-anchor');\n            expect($anchor.length).toBe(1);\n            expect($anchor.attr('name')).toBe('header-reply121');\n\n            const $floatingAnchor = $el.find('> .floating-anchor > a');\n            expect($floatingAnchor.length).toBe(1);\n            expect($floatingAnchor.attr('href')).toBe('#header-reply121');\n            expect($floatingAnchor.hasClass('fa fa-link fa-flip-horizontal'))\n                .toBe(true);\n        });\n    });\n\n    describe('Methods', function() {\n        it('openCommentEditor', function() {\n            view.render();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(true);\n            expect(view._$draftComment).toBe(null);\n\n            view.openCommentEditor();\n\n            expect(view._$addCommentLink.is(':visible')).toBe(false);\n            expect(view._$draftComment).not.toBe(null);\n            expect(view._$draftComment.hasClass('draft')).toBe(true);\n        });\n    });\n\n    describe('Text rendering', function() {\n        function testRendering(richText, expectedHTML) {\n            view.render();\n\n            const $comment = view._makeCommentElement({\n                text: '<p><strong>Test</strong> &amp;lt;</p>',\n                richText: richText,\n            });\n\n            const $reviewText = $comment.find('.reviewtext');\n            expect($reviewText.length).toBe(1);\n            expect($reviewText.hasClass('rich-text')).toBe(richText);\n            expect($reviewText.html()).toBe(expectedHTML);\n        }\n\n        it('richText=true', function() {\n            testRendering(true, '<p><strong>Test</strong> &amp;lt;</p>');\n        });\n\n        it('richText=false', function() {\n            testRendering(false,\n                          '&lt;p&gt;&lt;strong&gt;Test&lt;/strong&gt; ' +\n                          '&amp;amp;lt;&lt;/p&gt;');\n        });\n    });\n});\n"]}