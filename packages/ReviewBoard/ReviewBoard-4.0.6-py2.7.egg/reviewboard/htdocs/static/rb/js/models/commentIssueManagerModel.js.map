{"version":3,"sources":["commentIssueManagerModel.es6.js"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,mBAAH,GAAyB,QAAQ,CAAC,KAAT,CAAe,MAAf,CAAsB;AAC3C,EAAA,QAAQ,EAAE;AACN,IAAA,aAAa,EAAE;AADT,GADiC;;AAK3C;AACJ;AACA;AACI,EAAA,UAR2C,wBAQ9B;AACT,SAAK,SAAL,GAAiB,EAAjB;AACH,GAV0C;;AAY3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACI,EAAA,eA7B2C,2BA6B3B,QA7B2B,EA6BjB,SA7BiB,EA6BN,WA7BM,EA6BO,KA7BP,EA6Bc;AACrD,QAAM,OAAO,GAAG,KAAK,UAAL,CAAgB,QAAhB,EAA0B,SAA1B,EAAqC,WAArC,CAAhB;;AACA,SAAK,aAAL,CAAmB,OAAnB,EAA4B,KAA5B;AACH,GAhC0C;;AAkC3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACI,EAAA,UAvD2C,sBAuDhC,QAvDgC,EAuDtB,SAvDsB,EAuDX,WAvDW,EAuDE;AACzC,QAAI,CAAC,KAAK,SAAL,CAAe,SAAf,CAAL,EAAgC;AAC5B,UAAM,aAAa,GAAG,KAAK,GAAL,CAAS,eAAT,CAAtB;AACA,UAAI,OAAO,GAAG,IAAd;;AAEA,cAAQ,WAAR;AACI,aAAK,eAAL;AACI,UAAA,OAAO,GAAG,aAAa,CAClB,YADK,CACQ,QADR,EAEL,iBAFK,CAEa;AAAC,YAAA,EAAE,EAAE;AAAL,WAFb,CAAV;AAGA;;AAEJ,aAAK,qBAAL;AACI,UAAA,OAAO,GAAG,aAAa,CAClB,YADK,CACQ,QADR,EAEL,uBAFK,CAEmB,SAFnB,CAAV;AAGA;;AAEJ,aAAK,0BAAL;AACI,UAAA,OAAO,GAAG,aAAa,CAClB,YADK,CACQ,QADR,EAEL,2BAFK,CAEuB,SAFvB,CAAV;AAGA;;AAEJ,aAAK,kBAAL;AACI,UAAA,OAAO,GAAG,aAAa,CAClB,YADK,CACQ,QADR,EAEL,oBAFK,CAEgB,SAFhB,CAAV;AAGA;;AAEJ;AACI,UAAA,OAAO,CAAC,KAAR,CACI,kDADJ,EAEI,WAFJ;AA1BR;;AA+BA,WAAK,SAAL,CAAe,SAAf,IAA4B,OAA5B;AACH;;AAED,WAAO,KAAK,SAAL,CAAe,SAAf,CAAP;AACH,GA/F0C;;AAiG3C;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACI,EAAA,aA3G2C,yBA2G7B,OA3G6B,EA2GpB,KA3GoB,EA2Gb;AAAA;;AAC1B,IAAA,OAAO,CAAC,KAAR,CAAc;AACV,MAAA,KAAK,EAAE,iBAAM;AACT,YAAM,cAAc,GAAG,OAAO,CAAC,GAAR,CAAY,aAAZ,CAAvB;AAEA,QAAA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAA2B,KAA3B;AACA,QAAA,OAAO,CAAC,IAAR,CAAa;AACT,UAAA,KAAK,EAAE,CAAC,aAAD,CADE;AAET,UAAA,OAAO,EAAE,iBAAC,OAAD,EAAU,GAAV,EAAkB;AACvB,gBAAM,UAAU,GAAI,GAAG,CAAC,YAAJ,IACA,GAAG,CAAC,uBADJ,IAEA,GAAG,CAAC,kBAFJ,IAGA,GAAG,CAAC,eAHxB;;AAIA,YAAA,KAAI,CAAC,OAAL,CAAa,oBAAb,EAAmC,OAAnC,EACa,cADb,EAC6B,UAAU,CAAC,SADxC;AAEH;AATQ,SAAb;AAWH;AAhBS,KAAd;AAkBH;AA9H0C,CAAtB,CAAzB","file":"commentIssueManagerModel.js","sourcesContent":["/**\n * CommentIssueManager takes care of setting the state of a particular\n * comment issue, and also takes care of notifying callbacks whenever\n * the state is successfully changed.\n */\nRB.CommentIssueManager = Backbone.Model.extend({\n    defaults: {\n        reviewRequest: null,\n    },\n\n    /**\n     * Initialize the model.\n     */\n    initialize() {\n        this._comments = {};\n    },\n\n    /**\n     * Set the state for a comment.\n     *\n     * Args:\n     *     reviewID (number):\n     *         The ID of the review the comment belongs to.\n     *\n     *     commentID (number):\n     *         The ID of the comment.\n     *\n     *     commentType (string):\n     *         The type of the comment.\n     *\n     *     state (string):\n     *          The new state for the comment's issue. This will be one of\n     *          ``open``, ``resolved``, ``dropped``, or ``verify``.\n     */\n    setCommentState(reviewID, commentID, commentType, state) {\n        const comment = this.getComment(reviewID, commentID, commentType);\n        this._requestState(comment, state);\n    },\n\n    /**\n     * Retrieve the model for a given comment.\n     *\n     * This will either generate the appropriate comment object based on\n     * ``commentType``, or grab the comment from a cache if it's been generated\n     * before.\n     *\n     * Args:\n     *     reviewID (number):\n     *         The ID of the review the comment belongs to.\n     *\n     *     commentID (number):\n     *         The ID of the comment.\n     *\n     *     commentType (string):\n     *         The type of the comment.\n     *\n     * Returns:\n     *     RB.BaseComment:\n     *     The comment model.\n     */\n    getComment(reviewID, commentID, commentType) {\n        if (!this._comments[commentID]) {\n            const reviewRequest = this.get('reviewRequest');\n            let comment = null;\n\n            switch (commentType) {\n                case 'diff_comments':\n                    comment = reviewRequest\n                        .createReview(reviewID)\n                        .createDiffComment({id: commentID});\n                    break;\n\n                case 'screenshot_comments':\n                    comment = reviewRequest\n                        .createReview(reviewID)\n                        .createScreenshotComment(commentID);\n                    break;\n\n                case 'file_attachment_comments':\n                    comment = reviewRequest\n                        .createReview(reviewID)\n                        .createFileAttachmentComment(commentID);\n                    break;\n\n                case 'general_comments':\n                    comment = reviewRequest\n                        .createReview(reviewID)\n                        .createGeneralComment(commentID);\n                    break;\n\n                default:\n                    console.error(\n                        'getComment received unexpected comment type \"%s\"',\n                        commentType);\n            }\n\n            this._comments[commentID] = comment;\n        }\n\n        return this._comments[commentID];\n    },\n\n    /**\n     * Set the state of a comment.\n     *\n     * Args:\n     *     comment (RB.BaseComment):\n     *         The comment to set the state of.\n     *\n     *     state (string):\n     *         The new issue state for the comment.\n     */\n    _requestState(comment, state) {\n        comment.ready({\n            ready: () => {\n                const oldIssueStatus = comment.get('issueStatus');\n\n                comment.set('issueStatus', state);\n                comment.save({\n                    attrs: ['issueStatus'],\n                    success: (comment, rsp) => {\n                        const rspComment = (rsp.diff_comment ||\n                                            rsp.file_attachment_comment ||\n                                            rsp.screenshot_comment ||\n                                            rsp.general_comment);\n                        this.trigger('issueStatusUpdated', comment,\n                                     oldIssueStatus, rspComment.timestamp);\n                    },\n                });\n            },\n        });\n    },\n});\n"]}