{"version":3,"sources":["changeEntryView.es6.js"],"names":[],"mappings":"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","file":"changeEntryView.js","sourcesContent":["(function() {\n\n\nconst ParentView = RB.ReviewRequestPage.BaseStatusUpdatesEntryView;\n\n\n/**\n * Displays the \"Review request changed\" entry on the review request page.\n *\n * This handles any rendering needed for special contents in the box,\n * such as the diff complexity icons and the file attachment thumbnails.\n */\nRB.ReviewRequestPage.ChangeEntryView = ParentView.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *          Options for the view.\n     *\n     * Option Args:\n     *     reviewRequestEditorView (RB.ReviewRequestEditorView):\n     *         The review request editor.\n     */\n    initialize(options) {\n        ParentView.prototype.initialize.apply(this, arguments);\n\n        const reviewRequestEditor = this.model.get('reviewRequestEditor');\n\n        this.reviewRequest = reviewRequestEditor.get('reviewRequest');\n        this.reviewRequestEditorView = options.reviewRequestEditorView;\n\n        this._commitListView = null;\n\n        this._$boxStatus = null;\n        this._$fixItLabel = null;\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     RB.ReviewRequestPage.ChangeEntryView:\n     *     This object, for chaining.\n     */\n    render() {\n        ParentView.prototype.render.call(this);\n\n        this._$boxStatus = this.$('.box-status');\n        this._$fixItLabel = $('<label class=\"fix-it-label\">')\n            .hide()\n            .appendTo(this.$('.labels-container'));\n\n        RB.formatText(this.$('.changedesc-text'), {\n            bugTrackerURL: this.reviewRequest.get('bugTrackerURL'),\n            isHTMLEncoded: true,\n        });\n\n        this._updateLabels();\n\n        _.each(this.$('.diff-index tr'), rowEl => {\n            const $row = $(rowEl);\n            const iconView = new RB.DiffComplexityIconView({\n                numInserts: $row.data('insert-count'),\n                numDeletes: $row.data('delete-count'),\n                numReplaces: $row.data('replace-count'),\n                totalLines: $row.data('total-line-count'),\n            });\n\n            $row.find('.diff-file-icon')\n                .empty()\n                .append(iconView.$el);\n\n            iconView.render();\n        });\n\n        _.each(this.$('.file-container'), thumbnailEl => {\n            const $thumbnail = $(thumbnailEl);\n            const $caption = $thumbnail.find('.file-caption .edit');\n            const model = this.reviewRequest.draft.createFileAttachment({\n                id: $thumbnail.data('file-id')\n            });\n\n            if (!$caption.hasClass('empty-caption')) {\n                model.set('caption', $caption.text());\n            }\n\n            this.reviewRequestEditorView.buildFileAttachmentThumbnail(\n                model, null,\n                {\n                    $el: $thumbnail,\n                    canEdit: false,\n                });\n        });\n\n        const commits = this.model.get('commits');\n\n        if (commits) {\n            this._commitListView = new RB.DiffCommitListView({\n                el: this.$('.commit-list-container'),\n                model: new RB.DiffCommitList({\n                    commits: commits,\n                    diffHistory: new RB.CommitHistoryDiffEntryCollection(),\n                }),\n            });\n        }\n\n        return this;\n    },\n\n    /**\n     * Set up a review view.\n     *\n     * This will begin listening for changes to the issue counts and\n     * update the labels on the box.\n     *\n     * Args:\n     *     view (RB.ReviewRequestPage.ReviewView):\n     *         The review view being set up.\n     */\n    setupReviewView(view) {\n        this.listenTo(view, 'openIssuesChanged', this._updateLabels);\n    },\n\n    /**\n     * Update the \"Fix It\" label based on the open issue counts.\n     *\n     * If there are open issues, there will be a \"Fix it!\" label.\n     */\n    _updateLabels() {\n        if (this._reviewViews.some(view => view.hasOpenIssues())) {\n            const openIssueCount = this._reviewViews.reduce(\n                (sum, view) => sum + view.getOpenIssueCount(),\n                0);\n\n            this._$boxStatus.addClass('has-issues');\n            this._$fixItLabel\n                .empty()\n                .append(\n                    $('<span class=\"open-issue-count\">')\n                        .text(interpolate(gettext('%s failed'),\n                                          [openIssueCount]))\n                )\n                .append(document.createTextNode(gettext('Fix it!')))\n                .show()\n                .css({\n                    opacity: 1,\n                    left: 0,\n                });\n        } else {\n            this._$fixItLabel.css({\n                opacity: 0,\n                left: '-100px',\n            });\n            this._$boxStatus.removeClass('has-issues');\n        }\n    }\n});\n\n\n})();\n"]}