{"version":3,"sources":["reviewablePageViewTests.es6.js"],"names":[],"mappings":"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","file":"reviewablePageViewTests.js","sourcesContent":["suite('rb/pages/views/ReviewablePageView', function() {\n    const pageTemplate = dedent`\n        <div id=\"review-banner\"></div>\n        <a href=\"#\" id=\"review-action\">Edit Review</a>\n        <a href=\"#\" id=\"ship-it-action\">Ship It</a>\n    `;\n\n    let $editReview;\n    let $shipIt;\n    let page;\n    let pageView;\n\n    beforeEach(function() {\n        const $container = $('<div/>')\n            .html(pageTemplate)\n            .appendTo($testsScratch);\n\n        RB.DnDUploader.instance = null;\n\n        $editReview = $container.find('#review-action');\n        $shipIt = $container.find('#ship-it-action');\n\n        page = new RB.ReviewablePage({\n            checkForUpdates: false,\n            reviewRequestData: {\n                id: 123,\n                loaded: true,\n                state: RB.ReviewRequest.PENDING,\n            },\n            editorData: {\n                mutableByUser: true,\n                statusMutableByUser: true,\n            },\n        }, {\n            parse: true,\n        });\n\n        pageView = new RB.ReviewablePageView({\n            el: $container,\n            model: page,\n        });\n\n        const reviewRequest = page.get('reviewRequest');\n\n        spyOn(reviewRequest, 'ready').and.callFake(\n            (options, context) => options.ready.call(context));\n\n        pageView.render();\n    });\n\n    afterEach(function() {\n        RB.DnDUploader.instance = null;\n\n        pageView.remove();\n    });\n\n    describe('Public objects', function() {\n        it('reviewRequest', function() {\n            expect(page.get('reviewRequest')).not.toBe(undefined);\n        });\n\n        it('pendingReview', function() {\n            const pendingReview = page.get('pendingReview');\n\n            expect(pendingReview).not.toBe(undefined);\n            expect(pendingReview.get('parentObject'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('commentIssueManager', function() {\n            expect(page.commentIssueManager).not.toBe(undefined);\n            expect(page.commentIssueManager.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n        });\n\n        it('reviewRequestEditor', function() {\n            const reviewRequestEditor = page.reviewRequestEditor;\n\n            expect(reviewRequestEditor).not.toBe(undefined);\n            expect(reviewRequestEditor.get('reviewRequest'))\n                .toBe(page.get('reviewRequest'));\n            expect(reviewRequestEditor.get('commentIssueManager'))\n                .toBe(page.commentIssueManager);\n            expect(reviewRequestEditor.get('editable')).toBe(true);\n        });\n\n        it('reviewRequestEditorView', function() {\n            expect(pageView.reviewRequestEditorView).not.toBe(undefined);\n            expect(pageView.reviewRequestEditorView.model)\n                .toBe(page.reviewRequestEditor);\n        });\n    });\n\n    describe('Actions', function() {\n        it('Edit Review', function() {\n            spyOn(RB.ReviewDialogView, 'create');\n\n            $editReview.click();\n\n            expect(RB.ReviewDialogView.create).toHaveBeenCalled();\n\n            const options = RB.ReviewDialogView.create.calls.argsFor(0)[0];\n            expect(options.review).toBe(page.get('pendingReview'));\n            expect(options.reviewRequestEditor).toBe(page.reviewRequestEditor);\n        });\n\n        describe('Ship It', function() {\n            let pendingReview;\n\n            beforeEach(function() {\n                pendingReview = page.get('pendingReview');\n            });\n\n            it('Confirmed', function() {\n                spyOn(window, 'confirm').and.returnValue(true);\n                spyOn(pendingReview, 'ready').and.callFake(\n                    (options, context) => options.ready.call(context));\n                spyOn(pendingReview, 'save').and.callFake(\n                    (options, context) => options.success.call(context));\n                spyOn(pendingReview, 'publish').and.callThrough();\n                spyOn(pageView.draftReviewBanner, 'hideAndReload');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).toHaveBeenCalled();\n                expect(pendingReview.publish).toHaveBeenCalled();\n                expect(pendingReview.save).toHaveBeenCalled();\n                expect(pageView.draftReviewBanner.hideAndReload)\n                    .toHaveBeenCalled();\n                expect(pendingReview.get('shipIt')).toBe(true);\n                expect(pendingReview.get('bodyTop')).toBe('Ship It!');\n            });\n\n            it('Canceled', function() {\n                spyOn(window, 'confirm').and.returnValue(false);\n                spyOn(pendingReview, 'ready');\n\n                $shipIt.click();\n\n                expect(window.confirm).toHaveBeenCalled();\n                expect(pendingReview.ready).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Update bubble', function() {\n        const summary = 'My summary';\n        const user = {\n            url: '/users/foo/',\n            fullname: 'Mr. User',\n            username: 'user',\n        };\n        let $bubble;\n        let bubbleView;\n\n        beforeEach(function() {\n            page.get('reviewRequest').trigger('updated', {\n                summary: summary,\n                user: user,\n            });\n\n            $bubble = $('#updates-bubble');\n            bubbleView = pageView._updatesBubble;\n        });\n\n        it('Displays', function() {\n            expect($bubble.length).toBe(1);\n            expect(bubbleView.$el[0]).toBe($bubble[0]);\n            expect($bubble.is(':visible')).toBe(true);\n            expect($bubble.find('#updates-bubble-summary').text())\n                .toBe(summary);\n            expect($bubble.find('#updates-bubble-user').text())\n                .toBe(user.fullname);\n            expect($bubble.find('#updates-bubble-user').attr('href'))\n                .toBe(user.url);\n        });\n\n        describe('Actions', function() {\n            it('Ignore', function() {\n                spyOn(bubbleView, 'close').and.callThrough();\n                spyOn(bubbleView, 'trigger').and.callThrough();\n                spyOn(bubbleView, 'remove').and.callThrough();\n\n                $bubble.find('.ignore').click();\n\n                expect(bubbleView.close).toHaveBeenCalled();\n                expect(bubbleView.remove).toHaveBeenCalled();\n                expect(bubbleView.trigger).toHaveBeenCalledWith('closed');\n            });\n\n            it('Update Page displays Updates Bubble', function() {\n                spyOn(bubbleView, 'trigger');\n\n                $bubble.find('.update-page').click();\n\n                expect(bubbleView.trigger).toHaveBeenCalledWith('updatePage');\n            });\n\n            it('Update Page calls notify if shouldNotify', function() {\n                const info = {\n                    user: {\n                        fullname: 'Hello',\n                    },\n                };\n\n                RB.NotificationManager.instance._canNotify = true;\n                spyOn(RB.NotificationManager.instance, 'notify');\n                spyOn(RB.NotificationManager.instance,\n                      '_haveNotificationPermissions').and.returnValue(true);\n                spyOn(pageView, '_showUpdatesBubble');\n\n                pageView._onReviewRequestUpdated(info);\n\n                expect(RB.NotificationManager.instance.notify)\n                    .toHaveBeenCalled();\n                expect(pageView._showUpdatesBubble).toHaveBeenCalled();\n            });\n        });\n    });\n});\n"]}