{"version":3,"sources":["scrollManagerViewTests.es6.js"],"names":[],"mappings":"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","file":"scrollManagerViewTests.js","sourcesContent":["suite('rb/ui/views/ScrollManagerView', function() {\n    function makeElement(dimensions={}) {\n        const scratchOffset = $testsScratch.offset();\n\n        return $('<div/>')\n            .css({\n                position: 'absolute',\n                left: -scratchOffset.left + (dimensions.left || 0),\n                top: -scratchOffset.top + (dimensions.top || 0),\n                width: dimensions.width || 20,\n                height: dimensions.height || 20,\n            })\n            .appendTo($testsScratch);\n    }\n\n    let scrollManager;\n\n    beforeEach(function() {\n        scrollManager = new RB.ScrollManagerView();\n        scrollManager.window = {\n            pageXOffset: 0,\n            pageYOffset: 0,\n\n            scrollTo(x, y) {\n                this.pageXOffset = x;\n                this.pageYOffset = y;\n            },\n\n            requestAnimationFrame(cb) {\n                cb();\n            },\n        };\n    });\n\n    describe('scrollToPosition', function() {\n        it('Without scroll offset', function() {\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(100);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToPosition(100);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(60);\n        });\n    });\n\n    describe('scrollToElement', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Without scroll offset', function() {\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(50);\n        });\n\n        it('With scroll offset', function() {\n            scrollManager.scrollYOffset = 40;\n            scrollManager.scrollToElement($el);\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(10);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('First in a batch', function() {\n            scrollManager.window.pageYOffset = 100;\n\n            expect(scrollManager._oldScrollY).toBe(null);\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n\n        it('Subsequent entries', function() {\n            scrollManager._oldScrollY = 100;\n            scrollManager.window.pageYOffset = 200;\n\n            scrollManager.markForUpdate($el);\n\n            const pendingElement = scrollManager._pendingElements.get($el[0]);\n            expect(Math.round(pendingElement.oldHeight)).toEqual(20);\n            expect(Math.round(pendingElement.oldOffset.top)).toEqual(50);\n            expect(Math.round(pendingElement.oldOffset.left)).toEqual(0);\n            expect(scrollManager._oldScrollY).toBe(100);\n        });\n    });\n\n    describe('markUpdated', function() {\n        let $el;\n\n        beforeEach(function() {\n            $el = makeElement({top: 50});\n        });\n\n        it('Stores correct state', function() {\n            /* Disable the actual updates for this test. */\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.markForUpdate($el);\n            $el.height(40);\n            $el.css('top', parseInt($el.css('top'), 10) - 10);\n            scrollManager.markUpdated($el);\n\n            const el = $el[0];\n\n            expect(scrollManager._pendingElements.get(el)).toBe(undefined);\n\n            const element = scrollManager._elements.get(el);\n            expect(Math.round(element.oldHeight)).toEqual(20);\n            expect(Math.round(element.oldOffset.top)).toEqual(50);\n            expect(Math.round(element.oldOffset.left)).toEqual(0);\n            expect(Math.round(element.newHeight)).toEqual(40);\n            expect(Math.round(element.newOffset.top)).toEqual(40);\n            expect(Math.round(element.newOffset.left)).toEqual(0);\n\n            expect(scrollManager.window.requestAnimationFrame)\n                .toHaveBeenCalled();\n        });\n    });\n\n    describe('Scroll updates', function() {\n        beforeEach(function() {\n            spyOn(scrollManager.window, 'requestAnimationFrame');\n\n            scrollManager.window.pageYOffset = 200;\n        });\n\n        it('Includes updates before scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: 60});\n            const $el3 = makeElement({top: 70});\n\n            /* Grow by 50px. */\n            scrollManager.markForUpdate($el1);\n            $el1.height(70);\n            scrollManager.markUpdated($el1);\n\n            /* Shrink by 10px. */\n            scrollManager.markForUpdate($el2);\n            $el2.height(10);\n            scrollManager.markUpdated($el2);\n\n            /* Move up 5px. */\n            scrollManager.markForUpdate($el3);\n            $el3.css('top', parseInt($el3.css('top'), 10) - 5);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(Math.round(scrollManager.window.pageYOffset)).toBe(235);\n        });\n\n        it('Ignores updates after scroll position', function() {\n            const $el1 = makeElement({top: 10});\n            const $el2 = makeElement({top: scrollManager.window.pageYOffset});\n            const $el3 = makeElement({top: 500});\n\n            scrollManager.markForUpdate($el1);\n            $el1.height(30);\n            scrollManager.markUpdated($el1);\n\n            scrollManager.markForUpdate($el2);\n            $el2.height(90);\n            scrollManager.markUpdated($el2);\n\n            scrollManager.markForUpdate($el3);\n            $el3.height(1000);\n            scrollManager.markUpdated($el3);\n\n            scrollManager._updateScrollPos();\n\n            expect(scrollManager.window.pageYOffset).toBe(210);\n        });\n    });\n});\n"]}