{"version":3,"sources":["supportBannerView.es6.js"],"names":[],"mappings":"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","file":"supportBannerView.js","sourcesContent":["/**\n * Show the current support status for the Review Board install.\n */\nRB.SupportBannerView = Backbone.View.extend({\n    _loadingHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><span class=\"fa fa-spin fa-spinner\"></span></p>\n    `)({\n        titleText: gettext('Retrieving support information...'),\n    }),\n\n    _errorHTML: _.template(dedent`\n        <h2><%- titleText %></h2>\n        <p><%- bodyText %></p>\n        <p><%= fileText %></p>\n    `)({\n        titleText: gettext('Failed to retrieve support information'),\n        bodyText: gettext('We could not communicate with the Beanbag, Inc. server to retrieve your support information. You may be behind a firewall or have no Internet access.'),\n        fileText: gettext('You may file an issue on our <a href=\"https://reviewboard.googlegroups.com\">community support tracker.</a>'),\n    }),\n\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object):\n     *         Options passed to the view.\n     *\n     * Option Args:\n     *     supportData (string):\n     *         An encoded payload containing information used to look up\n     *         information on an active support contract for the server.\n     */\n    initialize(options) {\n        const now = new Date();\n\n        console.assert(RB.SupportBannerView.instance === null);\n        RB.SupportBannerView.instance = this;\n\n        _.bindAll(this, '_onError');\n\n        window.addEventListener('error', this._onError, true);\n\n        this._script = $('<script />')\n            .attr('src', RB.SupportBannerView.supportURL + '?' + $.param({\n                'support-data': options.supportData,\n                callback: 'RB.SupportBannerView.instance.receive',\n                _: now.valueOf(),  // Cache bust.\n            }))\n            .get(0);\n\n        /*\n         * If we use jQuery's appendTo, we end up with two <script> tags being\n         * added to the document.\n         */\n        document.body.appendChild(this._script);\n\n    },\n\n    /**\n     * Handle a DOM error.\n     *\n     * If the specified error targets the script tag (e.g., if it could not\n     * be loaded), then an error will be displayed in the banner\n     *\n     * Args:\n     *     e (Event):\n     *         The event that triggered this function.\n     */\n    _onError(e) {\n        if (e.target === this._script) {\n            this.render({\n                html: this._errorHTML,\n                className: 'error',\n            });\n\n            window.removeEventListener('error', this._onError, true);\n        }\n    },\n\n    /**\n     * Render the view\n     *\n     * Args:\n     *     options (object):\n     *         The rendering options.\n     *\n     * Option Args:\n     *     html (string)\n     *         The html to render in the banner.\n     *\n     *     className (string):\n     *         The name of the class to add to the banner.\n     */\n    render(options) {\n        options = _.extend({\n            className: 'loading',\n            html: this._loadingHTML,\n        }, options);\n\n        this.$el\n            .empty()\n            .html(options.html)\n            .attr('class', options.className);\n\n        return this;\n    },\n\n    /**\n     * Receive the data from the server.\n     *\n     * This is invoked via a JSONP callback.\n     *\n     * Args:\n     *     options (object):\n     *         The options received from the server.\n     *\n     * Option Args:\n     *     supportLevel (string):\n     *         The level of support the server has.\n     *\n     *     html (string):\n     *         The HTML to render in the banner.\n     */\n    receive(options) {\n        window.removeEventListener('error', this._onError, true);\n\n        this.render({\n            className: options.supportLevel + '-support',\n            html: options.html,\n        });\n    },\n}, {\n    instance: null,\n    supportURL: 'https://www.beanbaginc.com/support/reviewboard/_status/',\n});\n"]}