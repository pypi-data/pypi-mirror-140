{"version":3,"sources":["starManagerView.es6.js"],"names":[],"mappings":"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","file":"starManagerView.js","sourcesContent":["/**\n * A manager for star buttons, for both datagrids and individual buttons.\n *\n * This view manages the state of review request and review group star status\n * in datagrids, as well as the star status for review requests on their\n * individual pages.\n */\nRB.StarManagerView = Backbone.View.extend({\n    /**\n     * Initialize the view.\n     *\n     * Args:\n     *     options (object, optional):\n     *         View initialization options.\n     *\n     * Option Args:\n     *     datagridMode (boolean):\n     *         Whether or not the manager is managing a datagrid.\n     */\n    initialize(options={}) {\n        const objects = this.model.get('objects');\n        const starred = this.model.get('starred');\n\n        this._datagridMode = options.datagridMode;\n\n        /*\n         * This doesn't use the view's events object to bind to _toggleStar\n         * because doing so interferes with event bubbling and handler order.\n         * We need the datagrid's click handler to run after this one, so we\n         * bind directly to the element rather than on the parent view.\n         */\n        this.$('div.star')\n            .on('click', this._toggleStar.bind(this))\n            .each((idx, el) => {\n            const $el = $(el);\n            const objType = $el.attr('data-object-type');\n            const objID = $el.attr('data-object-id');\n            const objStarred = (parseInt($el.attr('data-starred'), 10) === 1);\n            let obj;\n\n            if (objType === 'reviewrequests') {\n                obj = new RB.ReviewRequest({ id: objID });\n            } else if (objType === 'groups') {\n                obj = new RB.ReviewGroup({ id: objID });\n            } else if (objType !== undefined) {\n                console.assert('Unknown star object type: %s', objType);\n            } else {\n                /* Skip any stars that don't have an object type. */\n                return;\n            }\n\n            objects[objID] = obj;\n            starred[objID] = objStarred;\n        });\n\n        /*\n         * When the datagrid is in mobile mode, we have to keep track of any\n         * objects whose star status changes so that we can update the datagrid\n         * if it switches back to desktop mode.\n         */\n        this._watchUpdates = false;\n        this._toUpdate = {};\n\n        if (this._datagridMode) {\n            this.$el.on('datagridDisplayModeChanged', ($grid, options) => {\n                if (options.mode === 'desktop') {\n                    for (let objID in this._toUpdate) {\n                        if (this._toUpdate.hasOwnProperty(objID)) {\n                            this._updateStarColumn(objID);\n                        }\n                    }\n\n                    this._watchUpdates = false;\n                    this._toUpdate = {};\n                } else if (options.mode === 'mobile') {\n                    this._watchUpdates = true;\n                }\n            });\n\n            if (this.$el.attr('data-datagrid-display-mode') === 'mobile') {\n                this._watchUpdates = true;\n            }\n        }\n    },\n\n    /**\n     * Update a star column.\n     *\n     * This function is called when the datagrid changes from mobile to desktop\n     * model. Since datagrids copy the original DOM over the new one when the\n     * mode is changed to desktop, we must copy over relevant star attributes\n     * and classes when this happens.\n     *\n     * Args:\n     *     objID (string):\n     *         The object's unique ID, as a string.\n     */\n    _updateStarColumn(objID) {\n        const $el = this.$(`.star[data-object-id=\"${objID}\"]`);\n        const starred = this.model.get('starred')[objID];\n\n        $el\n            .toggleClass('rb-icon-star-on', starred)\n            .toggleClass('rb-icon-star-off', !starred)\n            .attr('title',\n                  starred ? gettext('Starred')\n                          : gettext('Click to star'));\n    },\n\n    /**\n     * Toggle an object being starred or unstarred.\n     *\n     * This function is called when a star icon is clicked.\n     *\n     * Args:\n     *     e (Event):\n     *         The click event.\n     */\n    _toggleStar(e) {\n        const $target = $(e.target);\n        const objID = $target.attr('data-object-id');\n        const obj = this.model.get('objects')[objID];\n        const starred = this.model.get('starred');\n        const objStarred = !starred[objID];\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (RB.UserSession.instance.get('readOnly')) {\n            return;\n        }\n\n        obj.setStarred(objStarred);\n        starred[objID] = objStarred;\n\n        if (this._watchUpdates) {\n            if (this._toUpdate.hasOwnProperty(objID)) {\n                delete this._toUpdate[objID];\n            } else {\n                this._toUpdate[objID] = true;\n            }\n        }\n\n        $target\n            .toggleClass('rb-icon-star-on', objStarred)\n            .toggleClass('rb-icon-star-off', !objStarred)\n            .attr('title',\n                  objStarred ? gettext('Starred')\n                             : gettext('Click to star'));\n    },\n});\n"]}