{"version":3,"sources":["dashboardPageView.es6.js"],"names":[],"mappings":"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","file":"dashboardPageView.js","sourcesContent":["/**\n * The administration UI's main dashboard page.\n *\n * This displays all the widgets rendered on the dashboard, allowing users to\n * see important details about their install from one place.\n */\nRB.Admin.DashboardPageView = RB.Admin.PageView.extend({\n    events: {\n        'click .js-action-remove-widget': '_onRemoveWidgetClicked',\n    },\n\n    /**\n     * Initialize the page.\n     */\n    initialize() {\n        RB.Admin.PageView.prototype.initialize.apply(this, arguments);\n\n        this._widgetViews = {};\n        this._widgetWidths = {};\n        this._orderedWidgets = [];\n        this._$dashboardView = null;\n        this._$widgetsContainer = null;\n        this._$widgetsMain = null;\n        this._$widgets = null;\n        this._masonry = null;\n    },\n\n    /**\n     * Render the page.\n     *\n     * This will set up the support banner and the dashboard widgets.\n     */\n    renderPage() {\n        RB.Admin.PageView.prototype.renderPage.call(this);\n\n        /* Set up the main dashboard widgets area. */\n        this._$dashboardView = this.$('#admin-dashboard');\n        this._$widgetsContainer = this._$dashboardView.find(\n            '.rb-c-admin-widgets');\n        this._$widgetsMain = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__main');\n        this._$widgets = this._$widgetsMain.children('.rb-c-admin-widget');\n\n        const $sizerGutter = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__sizer-gutter');\n        const $sizerColumn = this._$widgetsContainer.children(\n            '.rb-c-admin-widgets__sizer-column');\n\n        this._masonry = new Masonry(this._$widgetsMain[0], {\n            columnWidth: $sizerColumn[0],\n            gutter: $sizerGutter[0],\n            transitionDuration: 0,\n            initLayout: false,\n        });\n\n        /* Show a banner detailing the support coverage for the server. */\n        const supportData = this.model.get('supportData');\n\n        if (supportData) {\n            const supportBanner = new RB.SupportBannerView({\n                el: $('#support-banner'),\n                supportData: this.model.get('supportData'),\n            });\n            supportBanner.render();\n        }\n\n        this._loadWidgets();\n\n        this._masonry.on('layoutComplete', this._onLayoutComplete.bind(this));\n\n        /* Now that everything is in place, show the dashboard. */\n        this._$dashboardView.css('visibility', 'visible');\n    },\n\n    /**\n     * Load all widgets for the view.\n     *\n     * The widgets will be loaded based on the data passed to the model,\n     * and will then be added to Masonry in order of largest to smallest\n     * widget.\n     */\n    _loadWidgets() {\n        const sortableWidgets = [];\n        let index = 0;\n\n        /* Render all the widgets. */\n        this.model.loadWidgets(widgetOptions => {\n            const widgetModel = widgetOptions.widgetModel;\n            const widgetView = new widgetOptions.ViewType(_.defaults(\n                {\n                    el: $(`#${widgetOptions.domID}`),\n                    model: widgetModel,\n                },\n                widgetOptions.viewOptions));\n\n            widgetView.$el.addClass('js-masonry-item');\n            widgetView.render();\n\n            this.listenTo(widgetView, 'sizeChanged',\n                          () => this._onWidgetSizeChanged(widgetModel.id,\n                                                          widgetView.$el));\n\n            const widgetEl = widgetView.el;\n            const width = widgetEl.offsetWidth;\n\n            this._widgetViews[widgetModel.id] = widgetView;\n            this._widgetWidths[widgetModel.id] = width;\n            sortableWidgets.push({\n                el: widgetEl,\n                index: index,\n                isFullWidth: widgetView.$el.hasClass('-is-full-size'),\n                width: width,\n            });\n        });\n\n        /*\n         * Force a specific sort order for the widgets to ensure the most\n         * compact layout, ideally keeping everything on screen.\n         *\n         * We require a stable order (widgets of the same size should be in a\n         * predictable order), and we have to account for full-width widgets,\n         * so our comparator is a little bit more complex. We use the\n         * following rules:\n         *\n         * 1) Full-size widgets are positioned at the top.\n         * 2) Column-based widgets are then ordered from largest to smallest.\n         * 3) Any widgets of the same size are sorted according to their\n         *    registration index.\n         */\n        sortableWidgets.sort((a, b) => {\n            if (a.isFullWidth && !b.isFullWidth) {\n                return -1;\n            } else if (!a.isFullWidth && b.isFullWidth) {\n                return 1;\n            } else if (!a.isFullWidth && !b.isFullWidth &&\n                       a.width !== b.width) {\n                if (a.width > b.width) {\n                    return -1;\n                } else if (a.width < b.width) {\n                    return 1;\n                }\n            }\n\n            /* The widths are equal. Keep the widgets in index order. */\n            return a.index - b.index;\n        });\n\n        this._masonry.items = [];\n        this._masonry.addItems(_.pluck(sortableWidgets, 'el'));\n        this._masonry.layout();\n    },\n\n    /**\n     * Handle a completed widget re-layout.\n     *\n     * This will go through all the widgets and determine if any have changed\n     * their sizes (widths). If so, their\n     * :js:func:`RB.Admin.WidgetView.updateSize` method will be called.\n     */\n    _onLayoutComplete() {\n        this.model.widgets.each(widget => {\n            const widgetView = this._widgetViews[widget.id];\n            const newWidth = widgetView.$el.width();\n\n            if (newWidth !== this._widgetWidths[widget.id]) {\n                widgetView.updateSize();\n                this._widgetWidths[widget.id] = newWidth;\n            }\n        });\n    },\n\n    /**\n     * Handle changes to widget sizes.\n     *\n     * This is called in response to the ``sizeChanged`` events on widgets. If\n     * the size of the widget has actually changed, this will record the new\n     * width and then update the positions of widgets accordingly.\n     *\n     * Args:\n     *     widgetID (string):\n     *         The ID of the widget that changed size.\n     *\n     *     $widget (jQuery):\n     *         The widget's jQuery-wrapped element.\n     */\n    _onWidgetSizeChanged(widgetID, $widget) {\n        const newWidth = $widget.width();\n\n        if (newWidth !== this._widgetWidths[widgetID]) {\n            this._widgetWidths[widgetID] = newWidth;\n            this._masonry.layout();\n        }\n    },\n});\n"]}